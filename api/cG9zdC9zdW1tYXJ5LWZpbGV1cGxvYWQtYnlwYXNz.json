{"title":"文件上传绕过的各种姿势","date":"2018-09-18T09:52:50.000Z","slug":"summary-fileupload-bypass","tags":["Web"],"updated":"2018-09-19T11:23:35.710Z","content":"<ol>\n<li><p>JS前端检测</p>\n<ul>\n<li><p>浏览器审核元素，修改代码</p>\n</li>\n<li><p>BP抓包，修改后缀</p>\n</li>\n</ul>\n</li>\n<li><p>文件后缀绕过</p>\n<p> Apache 的配置文件 <code>httpd.conf</code>,配置了哪些后缀会当作 <code>php</code> 脚本来解析，只要上传支持的后缀就行。</p>\n   <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">AddType application/x-httpd-php .php .phtml</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Content-Type 绕过</p>\n<p> 如果后台是通过 <code>Content-Type</code> 判断文件类型的，可以通过抓包修改 <code>Content-Type</code> 绕过，如 <code>image/jpeg</code>,<code>image/gif</code>。</p>\n</li>\n<li><p>getimagesize() 绕过</p>\n<p> PHP函数 <code>getimagesize()</code> 可以获取图片信息，以此来判断是不是图片。</p>\n<p> 可以将图片和 <code>webshell</code> 合并绕过。</p>\n<blockquote>\n<p>copy img.jpg /a + webshell.php /b &gt; webhsell.php </p>\n</blockquote>\n</li>\n<li><p>文件截断绕过</p>\n<p> 参数值中包含 <code>%00</code>，字符串后面的内容会被截断。</p>\n<p> 如参数 <code>a=1.php%00.jpg</code>，截断后就变为 <code>a=1.php</code>。</p>\n<p> 此方法在 <code>PHP 5.3.4</code> ，且关闭了 <code>GPC</code> 的情况下有效。</p>\n</li>\n<li><p>条件竞争</p>\n<p> 有些程序在上传时，会先将文件上传到服务器，再判断文件是否是 <code>webshell</code>，如果是 <code>webshell</code> 再删除。</p>\n<p> 这个过程是需要时间的，如果在文件被删除前访问 <code>webshell</code>，再写一个 <code>webshell</code>，就可以绕过该限制。</p>\n</li>\n</ol>\n","prev":{"title":"PHP中的命令执行","slug":"summary-command-execution"},"next":{"title":"i春秋-Web-BLOG","slug":"ichunqiu-web-BLOG"},"link":"http://Jayl1n.github.io/post/summary-fileupload-bypass/"}